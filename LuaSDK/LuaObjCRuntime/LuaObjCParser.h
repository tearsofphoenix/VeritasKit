//
//  LuaObjCParser.h
//  LuaIOS
//
//  Created by LeixSnake on 9/19/12.
//
//

#define kLuaObjCParserString @"LS0KbG9jYWwgdW5wYWNrID0gdGFibGUudW5wYWNrCgpsb2NhbCBnX0VuZ2luZQoKbG9jYWwgbHBlZyA9IHJlcXVpcmUgJ2xwZWcnCmxvY2FsIFAsIFIsIFMsIEMsIENjLCBDdCA9IGxwZWcuUCwgbHBlZy5SLCBscGVnLlMsIGxwZWcuQywgbHBlZy5DYywgbHBlZy5DdAoKLS0gY3JlYXRlIGEgcGF0dGVybiB3aGljaCBjYXB0dXJlcyB0aGUgbHVhIHZhbHVlIFtpZF0gYW5kIHRoZSBpbnB1dCBtYXRjaGluZwotLSBbcGF0dF0gaW4gYSB0YWJsZQpsb2NhbCBmdW5jdGlvbiB0b2tlbihpZCwgcGF0dCkgCiAgICAgICAgICAgICAgICByZXR1cm4gQ3QoQ2MoaWQpICogQyhwYXR0KSkgCiAgICAgICAgICAgICAgIGVuZAoKbG9jYWwgZGlnaXQgPSBSKCcwOScpCgotLSByYW5nZSBvZiB2YWxpZCBjaGFyYWN0ZXJzIGFmdGVyIGZpcnN0IGNoYXJhY3RlciBvZiBpZGVudGlmaWVyCmxvY2FsIGlkc2FmZSA9IFIoJ0FaJywgJ2F6JywgJ1wxMjdcMjU1JykgKyBQICdfJwoKLS0gb3BlcmF0b3JzCmxvY2FsIG9wZXJhdG9yID0gdG9rZW4oJ29wZXJhdG9yJywgUCAnPT0nICsgUCAnfj0nICsgUCAnPD0nICsgUCAnPj0nICsgUCAnLi4uJyArIFAnIT0nCiAgICAgICAgICAgICAgICAgICAgICAgKyBQICcuLicgKyBTICcrLSovJV4jPTw+OzosLnt9W10oKScpCi0tIGlkZW50aWZpZXJzCmxvY2FsIGlkZW50ID0gdG9rZW4oJ2lkZW50aWZpZXInLCBpZHNhZmUgKiAoaWRzYWZlICsgZGlnaXQgKyBQICcuJykgXiAwKQoKLS0ga2V5d29yZHMKbG9jYWwgb2x1YV9rZXl3b3JkcyA9IFAgJ0BpbXBsZW1lbnRhdGlvbicgKyBQICdAcHJvcGVydHknICsgUCAnQGVuZCcKICAgICAgICAgICAgICAgICAgICArIFAgJ0BzZWxlY3RvcicgKyBQICdAcHJvdG9jb2wnICsgUCAnQGF1dG9yZWxlYXNlcG9vbCcgCiAgICAgICAgICAgICAgICAgICAgKyBQICdAdHJ5JyArIFAgJ0BjYXRjaCcgKyBQICdAdGhyb3cnICsgUCAnQGZpbmFsbHknCiAgICAgICAgICAgICAgICAgICAgKyBQICcjaW1wb3J0JyArIFAnQGVudW1lcmF0ZScgKyBQJ0B0eXBlZGVmJyArIFAgJ0BjbGFzcycKICAgICAgICAgICAgICAgICAgICArIFAgJ0BbJyArIFAgJ0B7JyArIFAnWUVTJyArIFAnTk8nCiAgICAgICAgICAgICAgICAgICAgCgpsb2NhbCBrZXl3b3JkID0gdG9rZW4oJ2tleXdvcmQnLCAoUCAnYW5kJyArIFAgJ2JyZWFrJyArIFAgJ2RvJyArIFAgJ2Vsc2VpZicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUCAnZWxzZScgKyBQICdlbmQnICsgUCAnZmFsc2UnICsgUCAnZm9yJyArIFAgJ2Z1bmN0aW9uJyArIFAgJ2lmJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQICdpbicgKyBQICdsb2NhbCcgKyBQICduaWwnICsgUCAnbm90JyArIFAgJ29yJyArIFAgJ3JlcGVhdCcgKyBQICdyZXR1cm4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFAgJ3RoZW4nICsgUCAndHJ1ZScgKyBQICd1bnRpbCcgKyBQICd3aGlsZScgKyBvbHVhX2tleXdvcmRzICkgKiAKICAgICAgICAgICAgICAgICAgICAgIC0oaWRzYWZlICsgZGlnaXQpKQoKLS0gbnVtYmVycwpsb2NhbCBudW1iZXJfc2lnbiA9IFMnKy0nXi0xCmxvY2FsIG51bWJlcl9kZWNpbWFsID0gZGlnaXQgXiAxCmxvY2FsIG51bWJlcl9oZXhhZGVjaW1hbCA9IFAgJzAnICogUyAneFgnICogUignMDknLCAnQUYnLCAnYWYnKSBeIDEKbG9jYWwgbnVtYmVyX2Zsb2F0ID0gKGRpZ2l0XjEgKiBQJy4nICogZGlnaXReMCArIFAnLicgKiBkaWdpdF4xKSAqIChTJ2VFJyAqIG51bWJlcl9zaWduICogZGlnaXReMSleLTEKbG9jYWwgbnVtYmVyX2luX2x1YSA9IG51bWJlcl9oZXhhZGVjaW1hbCArIG51bWJlcl9mbG9hdCArIG51bWJlcl9kZWNpbWFsCmxvY2FsIG9sdWFfbnVtYmVyID0gUCAnQCcgKiBudW1iZXJfaW5fbHVhCmxvY2FsIG51bWJlciA9IHRva2VuKCdudW1iZXInLCBudW1iZXJfaW5fbHVhICsgb2x1YV9udW1iZXIpCgotLSBjYWxsYmFjayBmb3IgWz1bIGxvbmcgc3RyaW5ncyBdPV0KCmxvY2FsIGxvbmdzdHJpbmdwcmVkaWNhdGUgPSBQKGZ1bmN0aW9uKGlucHV0LCBpbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbGV2ZWwgPSBpbnB1dDptYXRjaCgnXiVbKD0qKSVbJywgaW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxldmVsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIF8sIHN0b3AgPSBpbnB1dDpmaW5kKCddJyAuLiBsZXZlbCAuLiAnXScsIGluZGV4LCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RvcCB0aGVuIHJldHVybiBzdG9wICsgMSBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKCmxvY2FsIGxvbmdzdHJpbmcgPSAjKFAnWycgKiBQJz0nXjEgKiBQJ1snKSAqIGxvbmdzdHJpbmdwcmVkaWNhdGUKCi0tIHN0cmluZ3MKbG9jYWwgc2luZ2xlX3V0ZjggPSAoKDEgLSBTICInXHJcblxmXFwiKSArIChQICdcXCcgKiAxKSkKbG9jYWwgZG91YmxlX3V0ZjggPSAoKDEgLSBTICciXHJcblxmXFwnKSArIChQICdcXCcgKiAxKSkKbG9jYWwgc2luZ2xlcXVvdGVkX3N0cmluZyA9IFAgIiciICogc2luZ2xlX3V0ZjggXiAwICogIiciCmxvY2FsIGRvdWJsZXF1b3RlZF9zdHJpbmcgPSBQICciJyAqIGRvdWJsZV91dGY4IF4gMCAqICciJwpsb2NhbCBvbHVhX3NpbmdsZXF1b3RlZF9zdHJpbmcgPSBQICJAJyIgKiBzaW5nbGVfdXRmOCBeIDAgKiAiJyIKbG9jYWwgb2x1YV9kb3VibGVxdW90ZWRfc3RyaW5nID0gUCAnQCInICogZG91YmxlX3V0ZjggXiAwICogJyInCmxvY2FsIGx1YV9zdHJpbmcgPSB0b2tlbignc3RyaW5nJywgc2luZ2xlcXVvdGVkX3N0cmluZyArIGRvdWJsZXF1b3RlZF9zdHJpbmcgKyBsb25nc3RyaW5nICsgb2x1YV9zaW5nbGVxdW90ZWRfc3RyaW5nICsgb2x1YV9kb3VibGVxdW90ZWRfc3RyaW5nKQoKLS0gY29tbWVudHMKbG9jYWwgc2luZ2xlbGluZV9jb21tZW50ID0gUCAnLS0nICogKDEgLSBTICdcclxuXGYnKSBeIDAKbG9jYWwgbXVsdGlsaW5lX2NvbW1lbnQgPSBQICctLScgKiAoIyhQJ1snICogUCc9J14wICogUCdbJykgKiBsb25nc3RyaW5ncHJlZGljYXRlKQpsb2NhbCBvbHVhX3NpbmdsZWxpbmVfY29tbWVudCA9IFAgJy8vJyAqICggMSAtIFMgJ1xyXG5cZicpIF4gMApsb2NhbCBvbHVhX211bHRpbGluZV9jb21tZW50ID0gUCAnLyonICogbG9uZ3N0cmluZ3ByZWRpY2F0ZSAqIFAgJyovJwpsb2NhbCBjb21tZW50ID0gdG9rZW4oJ2NvbW1lbnQnLCBtdWx0aWxpbmVfY29tbWVudCArIHNpbmdsZWxpbmVfY29tbWVudCArIG9sdWFfc2luZ2xlbGluZV9jb21tZW50KQoKLS0gd2hpdGVzcGFjZQpsb2NhbCB3aGl0ZXNwYWNlID0gdG9rZW4oJ3doaXRlc3BhY2UnLCBTKCdcclxuXGZcdCAnKV4xKQoKLS0gb3JkZXJlZCBjaG9pY2Ugb2YgYWxsIHRva2VucyBhbmQgbGFzdC1yZXNvcnQgZXJyb3Igd2hpY2ggY29uc3VtZXMgb25lIGNoYXJhY3Rlcgpsb2NhbCBhbnlfdG9rZW4gPSB3aGl0ZXNwYWNlICsgbnVtYmVyICsga2V5d29yZCArIGlkZW50ICsKbHVhX3N0cmluZyArIGNvbW1lbnQgKyBvcGVyYXRvciArIHRva2VuKCdlcnJvcicsIDEpCgotLSBwcml2YXRlIGludGVyZmFjZQpsb2NhbCB0YWJsZV9vZl90b2tlbnMgPSBDdChhbnlfdG9rZW4gXiAwKQoKLS0gaW5jcmVtZW50IFtsaW5lXSBieSB0aGUgbnVtYmVyIG9mIGxpbmUtZW5kcyBpbiBbdGV4dF0KbG9jYWwgZnVuY3Rpb24gc3luYyhsaW5lLCB0ZXh0KQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGluZGV4LCBsaW1pdCA9IDEsICN0ZXh0CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgaW5kZXggPD0gbGltaXQgZG8KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3RhcnQsIHN0b3AgPSB0ZXh0OmZpbmQoJ1xyXG4nLCBpbmRleCwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0YXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0LCBzdG9wID0gdGV4dDpmaW5kKCdbXHJcblxmXScsIGluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0YXJ0IHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA9IHN0b3AgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgPSBsaW5lICsgMQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHJldHVybiBsaW5lCiAgICAgICAgICAgICAgICBlbmQKCi0tIHdlIG9ubHkgbmVlZCB0byBzeW5jaHJvbml6ZSB0aGUgbGluZS1jb3VudGVyIGZvciB0aGVzZSB0b2tlbiB0eXBlcwpsb2NhbCBtdWx0aWxpbmVfdG9rZW5zID0geyBjb21tZW50ID0gdHJ1ZSwgc3RyaW5nID0gdHJ1ZSwgd2hpdGVzcGFjZSA9IHRydWUgfQoKLS0gcHVibGljIGludGVyZmFjZQpmdW5jdGlvbiBnZXRyYXd0b2tlbnMoaW5wdXQpCiAgICAgICAgICAgICAgICBhc3NlcnQodHlwZShpbnB1dCkgPT0gJ3N0cmluZycsICdiYWQgYXJndW1lbnQgIzEgKGV4cGVjdGVkIHN0cmluZyknKQogICAgICAgICAgICAgICAgbG9jYWwgbGluZSA9IDEKICAgICAgICAgICAgICAgIGxvY2FsIHRva2VucyA9IGxwZWcubWF0Y2godGFibGVfb2ZfdG9rZW5zLCBpbnB1dCkKICAgICAgICAgICAgICAgIGZvciBpLCB0b2tlbiBpbiBwYWlycyh0b2tlbnMpIGRvCiAgICAgICAgICAgICAgICAgICAgdG9rZW5bM10gPSBsaW5lCiAgICAgICAgICAgICAgICAgICAgaWYgbXVsdGlsaW5lX3Rva2Vuc1t0b2tlblsxXV0gdGhlbiAKICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IHN5bmMobGluZSwgdG9rZW5bMl0pIAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW5zCiAgICAgICAgIGVuZAoKZnVuY3Rpb24gZ2V0dG9rZW5zKCBpbnB1dCkKICAgICAgICAgICAgbG9jYWwgcmF3dG9rZW5zID0gZ2V0cmF3dG9rZW5zKGlucHV0KQogICAgICAgICAgICBsb2NhbCB0b2tlbnMgPSB7fQoKICAgICAgICAgICAgbG9jYWwgbGFzdHJhd3Rva2VuID0gbmlsCgogICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiBwdXNodG9rZW4ocmF3dG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGFzdHJhd3Rva2VuIGFuZCAobGFzdHJhd3Rva2VuWzFdIH49ICd3aGl0ZXNwYWNlJykgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGxhc3RyYXd0b2tlblsxXSB+PSAnY29tbWVudCcpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBsYXN0cmF3dG9rZW5bMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gbGFzdHJhd3Rva2VuWzJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IGxhc3RyYXd0b2tlblszXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5sYWZ0ZXIgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tRGVhbCBvbHVhX3N0cmluZyogaGVyZSwganVzdCByZW1vdmUgdGhlIGBAJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tdHJlYXQgaXQgYXMgbm9ybWFsIGx1YSBzdHJpbmcgKGBAJyA9PSA2NCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQudHlwZSA9PSAic3RyaW5nIikgYW5kICh0LnRleHQ6Ynl0ZSgxKSA9PSA2NCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50ZXh0ID0gdC50ZXh0OnN1YigyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50eXBlID0gIk5TQ29uc3RhbnRTdHJpbmciOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQudHlwZSA9PSAibnVtYmVyIikgYW5kICh0LnRleHQ6Ynl0ZSgxKSA9PSA2NCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50ZXh0ID0gdC50ZXh0OnN1YigyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdC50eXBlID0gIk5TQ29uc3RhbnROdW1iZXIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQudHlwZSA9PSAiaWRlbnRpZmllciIpIGFuZCAodC50ZXh0ID09ICJfX0xJTkVfXyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudHlwZSA9ICJudW1iZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRleHQgPSByYXd0b2tlblszXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQudHlwZSA9PSAia2V5d29yZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnRleHQgPT0gIllFUyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRleHQgPSAidHJ1ZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJOTyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LnRleHQgPSAiTk8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC50eXBlID09ICJvcGVyYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnRleHQgPT0gIiE9IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQudGV4dCA9ICJ+PSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJhd3Rva2VuIGFuZCByYXd0b2tlblsyXTpmaW5kKCdcbicpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQubmxhZnRlciA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnNbI3Rva2VucysxXSA9IHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdHJhd3Rva2VuID0gcmF3dG9rZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZm9yIF8sIHJhd3Rva2VuIGluIGlwYWlycyhyYXd0b2tlbnMpIGRvCiAgICAgICAgICAgICAgICBwdXNodG9rZW4ocmF3dG9rZW4pCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgcHVzaHRva2VuKG5pbCkKCiAgICAgICAgICAgIHJldHVybiB0b2tlbnMKICAgICAgICBlbmQKCmxvY2FsIGZ1bmN0aW9uIHN0cmluZ2lmeShzKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzOmZpbmQoJyInKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnIicuLnMuLiciJwogICAgICAgICAgICAgICAgICAgIGVsc2VpZiBub3QgczpmaW5kKCInIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiciLi5zLi4iJyIKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaSA9IDAKICAgICAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGUgPSBzdHJpbmcucmVwKCc9JywgaSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHM6ZmluZCgiJVsiLi5lLi4iJV0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlsiLi5lLi4iWyIuLnMuLiJdIi4uZS4uIl0iCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpID0gaSArIDEKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKbG9jYWwgZnVuY3Rpb24gbGVhZih0KQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7dHlwZT0ibGVhZiIsIHZhbHVlPXR9CiAgICAgICAgICAgICAgICBlbmQKCmxvY2FsIGZ1bmN0aW9uIGlkZW50aWZpZXJsZWFmKHMpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxlYWYoe3R5cGU9ImlkZW50aWZpZXIiLCB0ZXh0PXN9KQogICAgICAgICAgICAgICBlbmQKCmxvY2FsIGZ1bmN0aW9uIHN0cmluZ2xlYWYocykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGVhZih7dHlwZT0ic3RyaW5nIiwgdGV4dD1zdHJpbmdpZnkocyl9KQogICAgICAgICAgICAgICAgZW5kCgpmdW5jdGlvbiBtZXRob2RjYWxsKGFzdCkKICAgICAgICAgICAgbG9jYWwgb2JqZWN0ID0gYXN0Lm9iamVjdAogICAgICAgICAgICBsb2NhbCBzZWxlY3RvciA9IGFzdC5zZWxlY3RvcgogICAgICAgICAgICBsb2NhbCBhcmdzID0gYXN0LmFyZ3MKCiAgICAgICAgICAgIGlmIG9iamVjdCB0aGVuCiAgICAgICAgICAgICAgICAtLSBOb3JtYWwgbWV0aG9kIGNhbGwuCiAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHlwZT0ib2x1YV9tZXRob2RfaW5uZXJfY2FsbCIsCiAgICAgICAgICAgICAgICAgICAgb2JqZWN0PW9iamVjdCwKICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvcj1zdHJpbmdpZnkoc2VsZWN0b3IpLAogICAgICAgICAgICAgICAgICAgIGFyZ3M9CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJsaXN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgdW5wYWNrKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAtLSBzdXBlciBjYWxsLgogICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHR5cGU9Im9sdWFfbWV0aG9kX3N1cGVyX2NhbGwiLAogICAgICAgICAgICAgICAgICAgIGFyZ3M9CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJsaXN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nbGVhZihzZWxlY3RvciksCiAgICAgICAgICAgICAgICAgICAgICAgIHVucGFjayhhcmdzKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgpsb2NhbCBmdW5jdGlvbiBtZXRob2RkZWZpbml0aW9uKGFzdCwgY2xhc3MsIG1ldGhvZFR5cGUpCiAgICAgICAgICAgIC0taW1wbGljaXQgJ3NlbGYnIGFyZ3VtZW50IGZvciBjbGFzcyBtZXRob2QKICAgICAgICAgICAgbG9jYWwgYXJncyA9IHtsZWFmKCJzZWxmIiksIGxlYWYoIl9jbWQiKX0KICAgICAgICAgICAgaWYgYXN0LmFyZ3MgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKGFzdC5hcmdzKSBkbwogICAgICAgICAgICAgICAgICAgIGFyZ3NbI2FyZ3MrMV0gPSB2CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGFzdC5leHRyYWFyZ3MgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKGFzdC5leHRyYWFyZ3MpIGRvCiAgICAgICAgICAgICAgICAgICAgYXJnc1sjYXJncysxXSA9IHYKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0eXBlPSJsdWFDbGFzc19hZGRNZXRob2QiLAogICAgICAgICAgICAgICAgbWV0aG9kVHlwZT1tZXRob2RUeXBlLAogICAgICAgICAgICAgICAgY2xhc3M9IGNsYXNzLAogICAgICAgICAgICAgICAgc2VsZWN0b3I9IHN0cmluZ2lmeShhc3Quc2VsZWN0b3IpLAogICAgICAgICAgICAgICAgYXJndHlwZXM9IGFzdC5hcmd0eXBlcywKICAgICAgICAgICAgICAgIHJldHR5cGU9YXN0LnJldHR5cGUsCiAgICAgICAgICAgICAgICBpbXA9CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHlwZT0iZnVuY3Rpb25kZWYiLAogICAgICAgICAgICAgICAgICAgIGFyZ3M9CiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJsaXN0IiwKICAgICAgICAgICAgICAgICAgICAgICAgdW5wYWNrKGFyZ3MpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBjaHVuaz1hc3QuY2h1bmsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGVuZAoKZnVuY3Rpb24gaW1wbGVtZW50YXRpb24oYXN0KQogICAgbG9jYWwgY2F0ZWdvcnkgPSBpZGVudGlmaWVybGVhZigibmlsIikKICAgIGlmIGFzdC5jYXRlZ29yeSB0aGVuCiAgICAgICAgY2F0ZWdvcnkgPSBzdHJpbmdsZWFmKGFzdC5jYXRlZ29yeS50ZXh0KQogICAgZW5kCgogICAgbG9jYWwgbmV3YXN0ID0gCiAgICB7CiAgICAgICAgdHlwZT0iY2xhc3NfaW1wbGVtZW50YXRpb24iLAogICAgICAgIGNsYXNzPWFzdC5jbGFzcywKICAgICAgICBjaHVuaz0KICAgICAgICB7CiAgICAgICAgICAgIHR5cGU9ImNodW5rIgogICAgICAgIH0sCiAgICAgICAgY2xhc3NNZXRob2RzQ2h1bms9CiAgICAgICAgewogICAgICAgICAgICB0eXBlPSJjaHVuayIKICAgICAgICB9LAogICAgfQoKICAgIC0tIEVtaXQgY29kZSB0byBjcmVhdGUgdGhlIHN1YmNsYXNzLCBpZiBuZWNlc3NhcnkuCgogICAgaWYgYXN0LnN1cGVyY2xhc3MgdGhlbgogICAgICAgIG5ld2FzdC5jaHVua1sjbmV3YXN0LmNodW5rKzFdID0gewogICAgICAgICAgICB0eXBlPSJhc3NpZ25tZW50IiwKICAgICAgICAgICAgbGVmdD1sZWFmKGFzdC5jbGFzcyksCiAgICAgICAgICAgIHJpZ2h0PQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0eXBlPSJvYmpjX2FsbG9jYXRlQ2xhc3NQYWlyIiwKICAgICAgICAgICAgICAgIGFyZ3M9CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHlwZT0ibGlzdCIsCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nbGVhZihhc3QuY2xhc3MudGV4dCksCiAgICAgICAgICAgICAgICAgICAgc3RyaW5nbGVhZihhc3Quc3VwZXJjbGFzcykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIGVuZAoKLS0gQ29sbGVjdCB0aGUgY29udGVudHMgb2YgdGhlIGltcGxlbWVudGF0aW9uIGNodW5rIGludG8gbG9jYWwgZGVmaW5pdGlvbnMsCi0tIG9iamVjdCBtZXRob2RzIGFuZCBjbGFzcyBtZXRob2RzLiBBbHNvIGNvbnN0cnVjdCB0aGUgbWV0YWRhdGEgdGFibGUuCgogICAgbG9jYWwgbG9jYWxzID0ge30KICAgIGxvY2FsIG9iamVjdG1ldGhvZHMgPSB7fQogICAgbG9jYWwgY2xhc3NtZXRob2RzID0ge30KICAgIGxvY2FsIG1ldGFkYXRhID0ge30KICAgIGZvciBfLCBrIGluIGlwYWlycyhhc3QpIGRvCiAgICAgICAgaWYgKGsudHlwZSA9PSAib2x1YV9tZXRob2RkZWZpbml0aW9uIikgdGhlbgogICAgICAgICAgICBsb2NhbCBtID0ge30KICAgICAgICAgICAgbG9jYWwgcwogICAgICAgICAgICBpZiBrLmNsYXNzbWV0aG9kIHRoZW4KICAgICAgICAgICAgICAgIGNsYXNzbWV0aG9kc1sjY2xhc3NtZXRob2RzICsgMV0gPSBrCiAgICAgICAgICAgICAgICBzID0gIisiIC4uIGsuc2VsZWN0b3IKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgb2JqZWN0bWV0aG9kc1sjb2JqZWN0bWV0aG9kcyArIDFdID0gawogICAgICAgICAgICAgICAgcyA9ICItIiAuLiBrLnNlbGVjdG9yCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBtLmFyZ3R5cGVzID0gay5hcmd0eXBlcwogICAgICAgICAgICBtLnJldHR5cGUgPSBrLnJldHR5cGUKICAgICAgICAgICAgbWV0YWRhdGFbc10gPSBtCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbHNbI2xvY2FscyArIDFdID0gawogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgKCNvYmplY3RtZXRob2RzID09IDApIGFuZCAoI2NsYXNzbWV0aG9kcyA9PSAwKSB0aGVuCiAgICAgICAgcmV0dXJuIG5ld2FzdAogICAgZW5kCgogICAgLS0gRW1pdCBjYXRlZ29yeSB0ZW1wbGF0ZS4KCiAgICBsb2NhbCBjaHVuayA9IHt0eXBlPSJjaHVuayJ9CiAgICBmb3IgXywgayBpbiBpcGFpcnMobG9jYWxzKSBkbwogICAgICAgIGNodW5rWyNjaHVuaysxXSA9IGsKICAgIGVuZAoKICAgIGxvY2FsIGNsYXNzTWV0aG9kc0NodW5rID0ge3R5cGU9ImNodW5rIn0KICAgIGZvciBfLCBrIGluIGlwYWlycyhjbGFzc21ldGhvZHMpIGRvCiAgICAgICAgY2xhc3NNZXRob2RzQ2h1bmtbI2NsYXNzTWV0aG9kc0NodW5rKzFdID0gbWV0aG9kZGVmaW5pdGlvbihrLCBhc3QuY2xhc3MsICJjbGFzc21ldGhvZCIpCiAgICBlbmQKCiAgICBuZXdhc3QuY2xhc3NNZXRob2RzQ2h1bmtbI25ld2FzdC5jbGFzc01ldGhvZHNDaHVuaysxXSA9ICAgICAKICAgIHsgICAKICAgICAgICB0eXBlPSJvbHVhX2NsYXNzX21ldGhvZF9pbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgY2h1bmsgPSBjbGFzc01ldGhvZHNDaHVuaywKICAgIH0KCiAgICBmb3IgXywgayBpbiBpcGFpcnMob2JqZWN0bWV0aG9kcykgZG8KICAgICAgICBjaHVua1sjY2h1bmsrMV0gPSBtZXRob2RkZWZpbml0aW9uKGssIGFzdC5jbGFzcywgIm9iamVjdG1ldGhvZCIpCiAgICBlbmQKCiAgICBuZXdhc3QuY2h1bmtbI25ld2FzdC5jaHVuaysxXSA9ICAgICAKICAgIHsgICAKICAgICAgICB0eXBlPSJvbHVhX2NsYXNzX21ldGhvZF9pbXBsZW1lbnRhdGlvbiIsCiAgICAgICAgY2h1bmsgPSBjaHVuaywKICAgIH0KICAgIHJldHVybiBuZXdhc3QKZW5kCgoKbG9jYWwgc291cmNlCmxvY2FsIHRva2Vucwpsb2NhbCBwb3MKCmxvY2FsIHBlZWsKbG9jYWwgZXhwZWN0CmxvY2FsIG9wdGlvbmFsZXhwZWN0Cgpsb2NhbCBjaHVuawpsb2NhbCBzdGF0CmxvY2FsIGxhc3RzdGF0CmxvY2FsIGRvZW5kCmxvY2FsIGlmZWxzZWVuZApsb2NhbCB3aGlsZWRvZW5kCmxvY2FsIHJlcGVhdHVudGlsCmxvY2FsIGZvcmVuZApsb2NhbCBmdW5jdGlvbmRlZgpsb2NhbCBhc3NpZ25tZW50CmxvY2FsIGxvY2FsZGVmCmxvY2FsIHJ2YWx1ZWxpc3QKbG9jYWwgcnZhbHVlCmxvY2FsIHJ2YWx1ZTIKbG9jYWwgcnZhbHVlMwpsb2NhbCBydmFsdWU0CmxvY2FsIHJ2YWx1ZTUKbG9jYWwgcnZhbHVlNgpsb2NhbCBydmFsdWU3CmxvY2FsIHJ2YWx1ZTgKbG9jYWwgcnZhbHVlOQpsb2NhbCBydmFsdWVsZWFmCmxvY2FsIGx2YWx1ZWxpc3QKbG9jYWwgbHZhbHVlCmxvY2FsIGx2YWx1ZWxlYWYKbG9jYWwgbHZhbHVlaWRlbnRpZmllcgpsb2NhbCBmdW5jdGlvbmNhbGwKbG9jYWwgdGFibGVsaXRlcmFsCgpsb2NhbCBvbHVhX21ldGhvZGNhbGwKbG9jYWwgb2x1YV9pbXBsZW1lbnRhdGlvbgpsb2NhbCBvbHVhX3R5cGVhbm5vdGF0aW9uCmxvY2FsIG9sdWFfbWV0aG9kZGVmaW5pdGlvbgpsb2NhbCBvbHVhX2NyZWF0ZVNlbGVjdG9yCmxvY2FsIG9sdWFfZ2V0UHJvdG9jb2wKbG9jYWwgb2x1YV9pbXBvcnRfZmlsZQpsb2NhbCBvbHVhX3Rocm93CmxvY2FsIG9sdWFfb2JqY19ibG9ja09iamVjdApsb2NhbCBvbHVhX29iamNfZW51bWVyYXRvcgpsb2NhbCBvbHVhX29iamNfY2xhc3NQcmVkZWNsZWFyYXRpb24KbG9jYWwgb2x1YV9vYmpjX2xpdGVyYWxBcnJheQpsb2NhbCBvbHVhX29iamNfbGl0ZXJhbERpY3Rpb25hcnkKCmZ1bmN0aW9uIHBhcnNlZXJyb3IobWVzc2FnZSkKICAgIGxvY2FsIHQgPSB0b2tlbnNbcG9zXQogICAgbG9jYWwgbGluZSA9ICJ1bmtub3duIGxvY2F0aW9uIgogICAgaWYgdCBhbmQgdC5saW5lIHRoZW4KICAgICAgICBsaW5lID0gdC5saW5lCiAgICBlbmQKCiAgICBlcnJvcigiUGFyc2UgZXJyb3IgYXQgIi4ubGluZS4uIiBvZiAiLi5zb3VyY2UuLiI6ICIuLm1lc3NhZ2UpCmVuZAoKbG9jYWwgZXhwZWN0ZWRlcnJvciA9IGZ1bmN0aW9uKHR5cGUsIHRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdG9rZW5zW3Bvc10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ID0ge3R5cGU9ImVvZiIsIHRleHQ9IiJ9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dCBvciAiKGFueXRoaW5nKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZXJyb3IoImV4cGVjdGVkIGEgIi4udHlwZS4uIiwgJyIuLnRleHQuLiInLCBidXQgZ290IGEgIi4udC50eXBlLi4iLCAnIi4udC50ZXh0Li4iJyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKbG9jYWwgdW5leHBlY3RlZGVycm9yID0gZnVuY3Rpb24odG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZWVycm9yKCJ1bmV4cGVjdGVkICIuLnRva2VuLnR5cGUuLiIsICciLi50b2tlbi50ZXh0Li4iJyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKbG9jYWwgc3RhdGVtZW50ZXJyb3IgPSBmdW5jdGlvbih0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZXJyb3IoImV4cGVjdGVkIGEgc3RhdGVtZW50LCBnb3QgYSAiLi50b2tlbi50eXBlLi4iLCAnIi4udG9rZW4udGV4dC4uIiciKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCmxvY2FsIGludGVybmFsZXJyb3IgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZWVycm9yKCJpbnRlcm5hbCBlcnJvciIpCiAgICAgICAgICAgICAgICAgICAgICBlbmQKCnBlZWsgPSBmdW5jdGlvbih0eXBlLCAuLi4pCiAgICAgICAgICAgIGxvY2FsIHQgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICBpZiBub3QgdCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgKHQudHlwZSB+PSB0eXBlKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBsb2NhbCBsaXN0ID0gey4uLn0KICAgICAgICAgICAgaWYgKCNsaXN0ID09IDApIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmb3IgXywgcyBpbiBpcGFpcnMobGlzdCkgZG8KICAgICAgICAgICAgICAgIGlmICh0LnRleHQgPT0gcykgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAoKb3B0aW9uYWxleHBlY3QgPSBmdW5jdGlvbih0eXBlLCAuLi4pCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGxpc3QgPSB7Li4ufQogICAgICAgICAgICAgICAgICAgIGlmICgjbGlzdCA9PSAwKSBhbmQgKHQudHlwZSA9PSB0eXBlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHMgaW4gaXBhaXJzKGxpc3QpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnRleHQgPT0gcykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuaWwKICAgICAgICAgICAgICAgIGVuZAoKZXhwZWN0ID0gZnVuY3Rpb24odHlwZSwgLi4uKQogICAgICAgICAgICBsb2NhbCB0ID0gb3B0aW9uYWxleHBlY3QodHlwZSwgLi4uKQogICAgICAgICAgICBpZiBub3QgdCB0aGVuCiAgICAgICAgICAgICAgICBleHBlY3RlZGVycm9yKHR5cGUsIC4uLikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiB0CiAgICAgICAgZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJORiBQUk9QRVIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKbG9jYWwgZnVuY3Rpb24gaXN0ZXJtaW5hdG9ya2V5d29yZChzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiAocyA9PSAiZW5kIikgb3IgKHMgPT0gImVsc2UiKSBvcgogICAgICAgICAgICAgICAgICAgIChzID09ICJlbHNlaWYiKSBvciAocyA9PSAidW50aWwiKSBvcgogICAgICAgICAgICAgICAgICAgIChzID09ICJAZW5kIikgCiAgICAgICAgICAgICAgICBlbmQKCmNodW5rID0gZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBhc3QgPSB7dHlwZT0iY2h1bmsifQoKICAgICAgICAgICAgd2hpbGUgdG9rZW5zW3Bvc10gZG8KICAgICAgICAgICAgICAgIGxvY2FsIHQgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICAgICAgaWYgKHQudHlwZSA9PSAia2V5d29yZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBpc3Rlcm1pbmF0b3JrZXl3b3JkKHQudGV4dCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiAodC50ZXh0ID09ICJyZXR1cm4iKSBvciAodC50ZXh0ID09ICJicmVhayIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYSA9IGxhc3RzdGF0KCkKICAgICAgICAgICAgICAgICAgICAgICAgYXN0WyNhc3QrMV0gPSBhCgogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiOyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCBhID0gc3RhdCgpCiAgICAgICAgICAgICAgICBhc3RbI2FzdCsxXSA9IGEKCiAgICAgICAgICAgICAgICBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiOyIpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIGFzdAogICAgICAgIGVuZAoKc3RhdCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgIGlmICh0LnR5cGUgPT0gImtleXdvcmQiKSB0aGVuCiAgICAgICAgICAgICAgICBpZiAodC50ZXh0ID09ICJkbyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9lbmQoKQogICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gIndoaWxlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiB3aGlsZWRvZW5kKCkKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJyZXBlYXQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcGVhdHVudGlsKCkKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJpZiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWZlbHNlZW5kKCkKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJmb3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcmVuZCgpCiAgICAgICAgICAgICAgICBlbHNlaWYgKHQudGV4dCA9PSAiZnVuY3Rpb24iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uZGVmKCkKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJsb2NhbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9jYWxkZWYoKQogICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gIkBpbXBsZW1lbnRhdGlvbiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2x1YV9pbXBsZW1lbnRhdGlvbigpCiAgICAgICAgICAgICAgICBlbHNlaWYgKHQudGV4dCA9PSAiQGF1dG9yZWxlYXNlcG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqY19hdXRvcmVsZWFzZXBvb2woKQogICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gIiNpbXBvcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvbHVhX2ltcG9ydF9maWxlKCkKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJAdGhyb3ciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvbHVhX3Rocm93KCkKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJAdHJ5IikgdGhlbgogICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2x1YV9vYmpjX3RyeWNhdGNoZmluYWxseSgpCiAgICAgICAgICAgICAgICBlbHNlaWYgKHQudGV4dCA9PSAiQGVudW1lcmF0ZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sdWFfb2JqY19lbnVtZXJhdG9yKCkKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJAY2xhc3MiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvbHVhX29iamNfY2xhc3NQcmVkZWNsZWFyYXRpb24oKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHN0YXRlbWVudGVycm9yKHQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9jYWwgZSA9IHJ2YWx1ZSgpCiAgICAgICAgICAgICAgICBpZiBwZWVrKCJvcGVyYXRvciIsICIsIikgb3IgcGVlaygib3BlcmF0b3IiLCAiPSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXNzaWdubWVudChlKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgpsYXN0c3RhdCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIHQgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICAgICAgaWYgKHQudHlwZSA9PSAia2V5d29yZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiAodC50ZXh0ID09ICJicmVhayIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge3R5cGU9ImJyZWFrIn0KICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHQudGV4dCA9PSAicmV0dXJuIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW5zW3Bvc10udHlwZSA9PSAia2V5d29yZCIpIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXN0ZXJtaW5hdG9ya2V5d29yZCh0b2tlbnNbcG9zXS50ZXh0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gcnZhbHVlbGlzdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt0eXBlPSJyZXR1cm4iLCB2YWx1ZT12YWx1ZX0KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgc3RhdGVtZW50ZXJyb3IodCkKICAgICAgICAgICAgZW5kCgpkb2VuZCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgImRvIikKICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgIGxvY2FsIGFzdCA9IHt9CiAgICAgICAgICAgIGlmIHQudHlwZSA9PSAib3BlcmF0b3IiIGFuZCB0LnRleHQgPT0gInsiIHRoZW4KICAgICAgICAgICAgICAgIGFzdC5jaHVuayA9IG9sdWFfYmxvY2soKQogICAgICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgIndoaWxlIikKICAgICAgICAgICAgICAgIGFzdC5jb25kaXRpb24gPSBydmFsdWUoKSAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFzdC50eXBlPSJkb3doaWxlIgogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhc3QudHlwZSA9ICJkb2VuZCIKICAgICAgICAgICAgICAgIGFzdC5jaHVuayA9Y2h1bmsoKQogICAgICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgImVuZCIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZXR1cm4gYXN0CiAgICAgICAgZW5kCgppZmVsc2VlbmQgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBleHBlY3QoImtleXdvcmQiLCAiaWYiKQogICAgICAgICAgICAgICAgbG9jYWwgYXN0ID0ge3R5cGU9ImlmZWxzZWVuZCJ9CiAgICAgICAgICAgICAgICBsb2NhbCBoYXNCcmFja2V0RmxhZyA9IGZhbHNlCiAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29uZGl0aW9uID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICAgICAgaWYgdC50eXBlID09ICJvcGVyYXRvciIgYW5kIHQudGV4dCA9PSAieyIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBoYXNCcmFja2V0RmxhZyA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgYyA9IG9sdWFfYmxvY2soKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgInRoZW4iKQogICAgICAgICAgICAgICAgICAgICAgICBjID0gY2h1bmsoKQogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBhc3RbI2FzdCsxXSA9IHtjb25kaXRpb249Y29uZGl0aW9uLCBjaHVuaz1jfQoKICAgICAgICAgICAgICAgICAgICB0ID0gb3B0aW9uYWxleHBlY3QoImtleXdvcmQiLCAiZWxzZWlmIiwgImVsc2UiLCAiZW5kIikKICAgICAgICAgICAgICAgICAgICBpZiAodC50ZXh0ID09ICJlbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gImVsc2UiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHQgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0LnR5cGUgPT0gIm9wZXJhdG9yIiBhbmQgdC50ZXh0ID09ICJ7IiB0aGVuICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzQnJhY2tldEZsYWcgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gb2x1YV9ibG9jaygpICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjID0gY2h1bmsoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgImVuZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBhc3RbI2FzdCsxXSA9IHtjaHVuaz1jfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBoYXNCcmFja2V0RmxhZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zIC0gMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICByZXR1cm4gYXN0CiAgICAgICAgICAgIGVuZAoKd2hpbGVkb2VuZCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJ3aGlsZSIpCiAgICAgICAgICAgICAgICBsb2NhbCBjID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgYgogICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICBpZiB0LnR5cGUgPT0gIm9wZXJhdG9yIiBhbmQgdC50ZXh0ID09ICJ7IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgYiA9IG9sdWFfYmxvY2soKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJkbyIpCiAgICAgICAgICAgICAgICAgICAgYiA9IGNodW5rKCkKICAgICAgICAgICAgICAgICAgICBleHBlY3QoImtleXdvcmQiLCAiZW5kIikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHR5cGU9IndoaWxlZG9lbmQiLCAKICAgICAgICAgICAgICAgICAgICBjb25kaXRpb249YywgCiAgICAgICAgICAgICAgICAgICAgY2h1bms9YgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBlbmQKCnJlcGVhdHVudGlsID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJyZXBlYXQiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGIgPSBjaHVuaygpCiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgInVudGlsIikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjID0gcnZhbHVlKCkKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt0eXBlPSJyZXBlYXR1bnRpbCIsIGNvbmRpdGlvbj1jLCBjaHVuaz1ifQogICAgICAgICAgICAgICAgZW5kCgpmb3JlbmQgPSBmdW5jdGlvbigpCiAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJmb3IiKQogICAgICAgICAgICBsb2NhbCBhc3QgPSB7fQoKICAgICAgICAgICAgaWYgcGVlaygib3BlcmF0b3IiLCAiKCIpIHRoZW4KICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgIGFzdC52YXIgPSBsdmFsdWUoKQogICAgICAgICAgICAgICAgYXN0LnZhciA9IGx2YWx1ZWxpc3QoYXN0LnZhcikKICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJpbiIpCiAgICAgICAgICAgICAgICBhc3QuaXRlcmF0b3IgPSBydmFsdWUoKQogICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICIpIikKICAgICAgICAgICAgICAgIGFzdC5jaHVuayA9IG9sdWFfYmxvY2soKQogICAgICAgICAgICAgICAgYXN0LnR5cGUgPSAib2x1YV9mb3JpbmVuZCIKICAgICAgICAgICAgZWxzZQoKICAgICAgICAgICAgICAgIGFzdC52YXIgPSBsdmFsdWUoKQogICAgICAgICAgICAgICAgaWYgcGVlaygib3BlcmF0b3IiLCAiPSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgYXN0LnR5cGUgPSAiZm9yZW5kIgoKICAgICAgICAgICAgICAgICAgICBhc3QubG93ID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIiwiKQogICAgICAgICAgICAgICAgICAgIGFzdC5oaWdoID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICBpZiBwZWVrKCJvcGVyYXRvciIsICIsIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIGFzdC5zdGVwID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBhc3QudmFyID0gbHZhbHVlbGlzdChhc3QudmFyKQogICAgICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJpbiIpCiAgICAgICAgICAgICAgICAgICAgYXN0LnR5cGUgPSAiZm9yaW5lbmQiCgogICAgICAgICAgICAgICAgICAgIGFzdC5pdGVyYXRvciA9IHJ2YWx1ZSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBleHBlY3QoImtleXdvcmQiLCAiZG8iKQogICAgICAgICAgICAgICAgYXN0LmNodW5rID0gY2h1bmsoKQogICAgICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgImVuZCIpIAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmV0dXJuIGFzdAogICAgICAgIGVuZAoKZnVuY3Rpb25kZWYgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBleHBlY3QoImtleXdvcmQiLCAiZnVuY3Rpb24iKQogICAgICAgICAgICAgICAgbG9jYWwgbmFtZQogICAgICAgICAgICAgICAgaWYgbm90IHBlZWsoIm9wZXJhdG9yIiwgIigiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IGx2YWx1ZSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIigiKQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IGx2YWx1ZWxpc3QoKQogICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICIpIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgYwogICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICBpZiB0LnR5cGUgPT0gIm9wZXJhdG9yIiBhbmQgdC50ZXh0ID09ICJ7IiB0aGVuCiAgICAgICAgICAgICAgICAgICAgYyA9IG9sdWFfYmxvY2soKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGMgPSBjaHVuaygpICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJlbmQiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHlwZT0iZnVuY3Rpb25kZWYiLCAKICAgICAgICAgICAgICAgICAgICBuYW1lPW5hbWUsIAogICAgICAgICAgICAgICAgICAgIGFyZ3M9YXJncywgCiAgICAgICAgICAgICAgICAgICAgY2h1bms9YywKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgZW5kCgphc3NpZ25tZW50ID0gZnVuY3Rpb24oZSkKaWYgbm90IGUgb3IgcGVlaygib3BlcmF0b3IiLCAiLCIpIHRoZW4KZSA9IGx2YWx1ZWxpc3QoZSkKZW5kCmV4cGVjdCgib3BlcmF0b3IiLCAiPSIpCmxvY2FsIGEgPSBydmFsdWVsaXN0KCkKcmV0dXJuIHt0eXBlPSJhc3NpZ25tZW50IiwgbGVmdD1lLCByaWdodD1hfQplbmQKCmxvY2FsZGVmID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgZXhwZWN0KCJrZXl3b3JkIiwgImxvY2FsIikKICAgICAgICAgICAgICAgIGxvY2FsIGFzdAogICAgICAgICAgICAgICAgaWYgcGVlaygia2V5d29yZCIsICJmdW5jdGlvbiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBhc3QgPSBmdW5jdGlvbmRlZigpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZSA9IGx2YWx1ZWxpc3QoKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGEgPSBuaWwKICAgICAgICAgICAgICAgIGlmIHBlZWsoIm9wZXJhdG9yIiwgIj0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgIGEgPSBydmFsdWVsaXN0KCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGFzdCA9IAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0iYXNzaWdubWVudCIsIAogICAgICAgICAgICAgICAgICAgICAgICBsZWZ0PWUsIAogICAgICAgICAgICAgICAgICAgICAgICByaWdodD1hCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHR5cGU9ImxvY2FsIiwgCiAgICAgICAgICAgICAgICAgICAgdmFsdWU9YXN0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgZW5kCgpydmFsdWVsaXN0ID0gZnVuY3Rpb24oZSkKbG9jYWwgYXN0ID0ge3R5cGU9Imxpc3QifQppZiBub3QgZSB0aGVuCmlmIHBlZWsoIm9wZXJhdG9yIiwgIikiKSB0aGVuCnJldHVybiBhc3QKZW5kCmUgPSBydmFsdWUoKQplbmQKCmFzdFsjYXN0KzFdID0gZQp3aGlsZSB0cnVlIGRvCmlmIG5vdCBwZWVrKCJvcGVyYXRvciIsICIsIikgdGhlbgpyZXR1cm4gYXN0CmVuZApwb3MgPSBwb3MgKyAxCmFzdFsjYXN0KzFdID0gcnZhbHVlKCkKZW5kCmVuZAkKCmxvY2FsIGZ1bmN0aW9uIGxlZnRhc3NvY2Jpbm9wKGxlZnQsIHByZWNlZGVuY2UsIHR5cGUsIC4uLikKICAgICAgICAgICAgbG9jYWwgZSA9IGxlZnQoKQogICAgICAgICAgICBpZiBwZWVrKHR5cGUsIC4uLikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCgogICAgICAgICAgICAgICAgbG9jYWwgYXN0ID0ge3R5cGU9ImJpbm9wIiwgb3BlcmF0b3I9dCwgcHJlY2VkZW5jZT1wcmVjZWRlbmNlLAogICAgICAgICAgICAgICAgICAgIGxlZnQ9ZSwgcmlnaHQ9bGVmdCgpfQogICAgICAgICAgICAgICAgd2hpbGUgcGVlayh0eXBlLCAuLi4pIGRvCiAgICAgICAgICAgICAgICAgICAgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQoKICAgICAgICAgICAgICAgICAgICBhc3QgPSB7dHlwZT0iYmlub3AiLCBvcGVyYXRvcj10LCBwcmVjZWRlbmNlPXByZWNlZGVuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ9YXN0LCByaWdodD1sZWZ0KCl9CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHJldHVybiBhc3QKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgpsb2NhbCBmdW5jdGlvbiByaWdodGFzc29jYmlub3AobGVmdCwgcHJlY2VkZW5jZSwgdHlwZSwgLi4uKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGUgPSBsZWZ0KCkKICAgICAgICAgICAgICAgICAgICBpZiBwZWVrKHR5cGUsIC4uLikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdG9rZW5zW3Bvc10KICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge3R5cGU9ImJpbm9wIiwgb3BlcmF0b3I9dCwgcHJlY2VkZW5jZT1wcmVjZWRlbmNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdD1lLCByaWdodD1ydmFsdWUoKX0KICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCi0tIG9yCnJ2YWx1ZSA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIGxlZnRhc3NvY2Jpbm9wKHJ2YWx1ZTIsIDEsICJrZXl3b3JkIiwgIm9yIikKICAgICAgICAgZW5kCgotLSBhbmQKcnZhbHVlMiA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0YXNzb2NiaW5vcChydmFsdWUzLCAyLCAia2V5d29yZCIsICJhbmQiKQogICAgICAgICAgICBlbmQKCi0tIDwgPiA8PSA+PSB+PSA9PQpydmFsdWUzID0gZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gbGVmdGFzc29jYmlub3AocnZhbHVlNCwgMywgIm9wZXJhdG9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI8IiwgIj4iLCAiPD0iLCAiPj0iLCAifj0iLCAiPT0iLCAiIT0iKQogICAgICAgICAgICBlbmQKCi0tIC4uCnJ2YWx1ZTQgPSBmdW5jdGlvbigpCiAgICAgICAgICAgIHJldHVybiByaWdodGFzc29jYmlub3AocnZhbHVlNSwgNCwgIm9wZXJhdG9yIiwgIi4uIikKICAgICAgICAgIGVuZAoKLS0gKyAtCnJ2YWx1ZTUgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdGFzc29jYmlub3AocnZhbHVlNiwgNSwgIm9wZXJhdG9yIiwgIisiLCAiLSIpCiAgICAgICAgICBlbmQKCi0tICogLyAlCnJ2YWx1ZTYgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICByZXR1cm4gbGVmdGFzc29jYmlub3AocnZhbHVlNywgNiwgIm9wZXJhdG9yIiwgIioiLCAiLyIsICIlIikKICAgICAgICAgIGVuZAoKLS0gbm90ICMgdW5hcnktCnJ2YWx1ZTcgPSBmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIHBlZWsoIm9wZXJhdG9yIiwgIi0iKSBvciAKICAgICAgICAgICAgICAgcGVlaygib3BlcmF0b3IiLCAiIyIpIG9yCiAgICAgICAgICAgICAgIHBlZWsoImtleXdvcmQiLCAibm90IikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICByZXR1cm4ge3R5cGU9InVub3AiLCBwcmVjZWRlbmNlPTcsIG9wZXJhdG9yPXQudGV4dCwgdmFsdWU9cnZhbHVlOCgpfQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBydmFsdWU4KCkKICAgICAgICAgIGVuZAoKLS0gXgpydmFsdWU4ID0gZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gcmlnaHRhc3NvY2Jpbm9wKHJ2YWx1ZTksIDgsICJvcGVyYXRvciIsICJeIikKICAgICAgICAgIGVuZAoKLS0gLiA6IFtdIGZ1bmN0aW9uY2FsbHMKcnZhbHVlOSA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgZSA9IHJ2YWx1ZWxlYWYoKQogICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICB0ID0gdG9rZW5zW3Bvc10KICAgICAgICAgICAgICAgIGlmIG5vdCB0IHRoZW4KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgKHQudHlwZSA9PSAib3BlcmF0b3IiKSB0aGVuCQkKICAgICAgICAgICAgICAgICAgICBpZiAodC50ZXh0ID09ICIuIikgb3IgKHQudGV4dCA9PSAiOiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICBybGVhZiA9IHJ2YWx1ZWxlYWYoKQoKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJiaW5vcCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I9dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWNlZGVuY2U9OSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0PWUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ9cmxlYWYKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJbIikgdGhlbgogICAgICAgICAgICAgICAgICAgIC0tIFRoaXMgbWlnaHQgYmUgZWl0aGVyIGEgZGVyZWZlcmVuY2Ugb3IgdGhlIGJlZ2lubmluZyBvZiBhbgogICAgICAgICAgICAgICAgICAgIC0tIE9iamVjdGl2ZSBMdWEgbWV0aG9kIGNhbGwgaW4gdGhlIG5leHQgc3RhdGVtZW50OyBzbyB3ZQogICAgICAgICAgICAgICAgICAgIC0tIG5lZWQgdG8gZGlzYW1iaWd1YXRlIGFuZCBwb3RlbnRpYWxseSBiYWNrdHJhY2suCiAgICAgICAgICAgICAgICAgICAgLS0KICAgICAgICAgICAgICAgICAgICAtLSBJdCBpcyBhbGwgcmlnaHQgZm9yIHJ2YWx1ZSgpIHRvIGJhaWwgd2l0aCBhbiBlcnJvciBiZWNhdXNlCiAgICAgICAgICAgICAgICAgICAgLS0gbWV0aG9kIGNhbGxzIHN0YXJ0IHdpdGggYW4gcnZhbHVlIGFzIHdlbGwuIEl0IGJlIG5pY2UgdG8KICAgICAgICAgICAgICAgICAgICAtLSBhdm9pZCBwYXJzaW5nIHRoZSBydmFsdWUgdHdpY2UsIGJ1dCBpdCBkb2VzIG5vIGhhcm0uCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBvbGRwb3MgPSBwb3MKICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBpbmRleCA9IHJ2YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9wdGlvbmFsZXhwZWN0KCJvcGVyYXRvciIsICJdIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gRGVyZWZlcmVuY2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0ge3R5cGU9ImRlcmVmIiwgbGVmdD1lLCByaWdodD1pbmRleH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAtLSBNZXRob2QgY2FsbC4gQmFja3RyYWNrLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gb2xkcG9zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHQudGV4dCA9PSAiKCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGZ1bmN0aW9uY2FsbChlKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50eXBlID09ICJzdHJpbmciKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZSA9IGZ1bmN0aW9uY2FsbChlKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZXR1cm4gZQogICAgICAgIGVuZAoKbG9jYWwgZnVuY3Rpb24gbGVhZih0KQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7dHlwZT0ibGVhZiIsIHZhbHVlPXR9CiAgICAgICAgICAgICAgICBlbmQKCnJ2YWx1ZWxlYWYgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdG9rZW5zW3Bvc10KICAgICAgICAgICAgICAgIGlmICh0LnR5cGUgPT0gImtleXdvcmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgKHQudGV4dCA9PSAibmlsIikgb3IgKHQudGV4dCA9PSAidHJ1ZSIpIG9yICh0LnRleHQgPT0gImZhbHNlIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsZWFmKHQpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gImZ1bmN0aW9uIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb25kZWYoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJAc2VsZWN0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sdWFfY3JlYXRlU2VsZWN0b3IoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJAcHJvdG9jb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sdWFfZ2V0UHJvdG9jb2woKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICIjaW1wb3J0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbHVhX2ltcG9ydF9maWxlKCkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHQudGV4dCA9PSAiQGVudW1lcmF0ZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2x1YV9vYmpjX2VudW1lcmF0b3IoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJAWyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2x1YV9vYmpjX2xpdGVyYWxBcnJheSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gIkB7IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbHVhX29iamNfbGl0ZXJhbERpY3Rpb25hcnkoKQogICAgICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50eXBlID09ICJudW1iZXIiKSBvciAodC50eXBlID09ICJzdHJpbmciKSBvciAodC50eXBlID09ICJpZGVudGlmaWVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGVhZih0KQogICAgICAgICAgICAgICAgZWxzZWlmICh0LnR5cGUgPT0gIm9wZXJhdG9yIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmICh0LnRleHQgPT0gIigiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZSA9IHJ2YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiKSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gInsiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0YWJsZWxpdGVyYWwoKQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJbIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2x1YV9tZXRob2RjYWxsKCkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHQudGV4dCA9PSAiLi4uIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsZWFmKHQpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh0LnRleHQgPT0gIl4iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sdWFfb2JqY19ibG9ja09iamVjdCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlaWYgKHQudHlwZSA9PSAiTlNDb25zdGFudFN0cmluZyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICAgICAgICAgIGVsc2VpZiAodC50eXBlID09ICJOU0NvbnN0YW50TnVtYmVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcHJpbnQoMTAyNSkKICAgICAgICAgICAgICAgIHVuZXhwZWN0ZWRlcnJvcih0KQkKICAgICAgICAgICAgZW5kCgpsdmFsdWVsaXN0ID0gZnVuY3Rpb24oZSkKICAgICAgICAgICAgICAgIGxvY2FsIGFzdCA9IHt0eXBlPSJsaXN0In0KICAgICAgICAgICAgICAgIGlmIG5vdCBlIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBwZWVrKCJvcGVyYXRvciIsICIpIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXN0CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZSA9IGx2YWx1ZSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBhc3RbI2FzdCsxXSA9IGUKICAgICAgICAgICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgICAgICAgICBpZiBub3QgcGVlaygib3BlcmF0b3IiLCAiLCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzdAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICBhc3RbI2FzdCsxXSA9IGx2YWx1ZSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCQoKbHZhbHVlID0gZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBhc3QgPSBsdmFsdWVsZWFmKCkKICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICBpZiAodC50eXBlID09ICJvcGVyYXRvciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiAodC50ZXh0ID09ICIuIikgb3IgKHQudGV4dCA9PSAiOiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgYXN0ID0gCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9ImJpbm9wIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcj10LnRleHQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlY2VkZW5jZT0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdD1hc3QsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQ9bHZhbHVlbGVhZigpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodC50ZXh0ID09ICJbIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGluZGV4ID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICJdIikKICAgICAgICAgICAgICAgICAgICAgICAgYXN0ID0gCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9ImRlcmVmIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0PWFzdCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodD1pbmRleAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBhc3QKICAgICAgICBlbmQKCmx2YWx1ZWxlYWYgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdG9rZW5zW3Bvc10KICAgICAgICAgICAgICAgIGlmICh0LnR5cGUgPT0gImlkZW50aWZpZXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgIHJldHVybiB7dHlwZT0ibGVhZiIsIHZhbHVlPXR9CiAgICAgICAgICAgICAgICBlbHNlaWYgKHQudHlwZSA9PSAib3BlcmF0b3IiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgKHQudGV4dCA9PSAiLi4uIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsZWFmKHQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHByaW50KCIxMDU1IikKICAgICAgICAgICAgICAgIHVuZXhwZWN0ZWRlcnJvcih0KQkKICAgICAgICAgICAgZW5kCgpsdmFsdWVpZGVudGlmaWVyID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ID0gZXhwZWN0KCJpZGVudGlmaWVyIikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxlYWYodCkKICAgICAgICAgICAgICAgICAgICBlbmQKCmZ1bmN0aW9uY2FsbCA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MKCiAgICAgICAgICAgICAgICAgICAgaWYgcGVlaygic3RyaW5nIikgb3IgcGVlaygib3BlcmF0b3IiLCAieyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIjExMDgiKQogICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gcnZhbHVlbGVhZigpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIigiKQogICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gcnZhbHVlbGlzdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiKSIpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHt0eXBlPSJmdW5jdGlvbmNhbGwiLCB2YWx1ZT12YWx1ZSwgYXJncz1hcmdzfQogICAgICAgICAgICAgICAgZW5kCgp0YWJsZWxpdGVyYWwgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXN0ID0ge3R5cGU9InRhYmxlbGl0ZXJhbCJ9CiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICJ7IikKICAgICAgICAgICAgICAgICAgICB3aGlsZSBub3QgcGVlaygib3BlcmF0b3IiLCAifSIpIGRvIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbnRyeSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbnNbcG9zXS50eXBlID09ICJpZGVudGlmaWVyIikgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICh0b2tlbnNbcG9zKzFdLnR5cGUgPT0gIm9wZXJhdG9yIikgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICh0b2tlbnNbcG9zKzFdLnRleHQgPT0gIj0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5rZXkgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudmFsdWUgPSBydmFsdWUoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHRva2Vuc1twb3NdLnR5cGUgPT0gIm9wZXJhdG9yIikgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICh0b2tlbnNbcG9zXS50ZXh0ID09ICJbIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAtLSBEaXNhbWJpZ3VhdGUgW2V4cHJdPXZhbHVlIGZyb20gW2V4cHIgc2VsZWN0b3JdLgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG9sZHBvcyA9IHBvcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkua2V5ID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiXSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBUaGlzIG11c3QgYmUgYSBtZXRob2QgY2FsbC4gQmFja3RyYWNrLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IG9sZHBvcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LmtleSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LnZhbHVlID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBLZXkvdmFsdWUgYXNzaWdubWVudC4gdGhlIGBdJyBoYXMgYmVlbiBleHBlY3RlZCwgc28gbm90IGV4cGVjdCBpdCBhZ2FpbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiPSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW50cnkudmFsdWUgPSBydmFsdWUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5LnZhbHVlID0gcnZhbHVlKCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBhc3RbI2FzdCArIDFdID0gZW50cnkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IG9wdGlvbmFsZXhwZWN0KCJvcGVyYXRvciIsICIsIiwgIjsiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIn0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3QKICAgICAgICAgICAgICAgIGVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gICAgICAgICAgICAgICAgICAgICAgICBPQkpFQ1RJVkUgTFVBIEVYVEVOU0lPTlMgICAgICAgICAgICAgICAgICAgICAgLS0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCmxvY2FsIGZ1bmN0aW9uIHBlZWtzZWxlbCgpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdDEgPSB0b2tlbnNbcG9zKzBdCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdDIgPSB0b2tlbnNbcG9zKzFdCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0MSBvciBub3QgdDIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaXNzZWxlbCA9ICgodDEudHlwZSA9PSAiaWRlbnRpZmllciIpIG9yICh0MS50eXBlID09ICJrZXl3b3JkIikpIAogICAgICAgICAgICAgICAgICAgIAkJCQlhbmQgKHQyLnR5cGUgPT0gIm9wZXJhdG9yIikgYW5kICh0Mi50ZXh0ID09ICI6IikKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlzc2VsZWwsIHQxLCB0MgogICAgICAgICAgICAgICAgZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRzZWxlbCgpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYiwgdDEsIHQyID0gcGVla3NlbGVsKCkKICAgICAgICAgICAgICAgICAgICBpZiBiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDEudGV4dCAuLiAiOiIKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmlsCiAgICAgICAgICAgICAgIGVuZAoKICAgIG9sdWFfYmxvY2sgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXN0ID0ge3R5cGU9ImNodW5rIn0KICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgInsiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHdoaWxlIG5vdCBwZWVrKCJvcGVyYXRvciIsICJ9IikgZG8gCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHQgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodC50eXBlID09ICJrZXl3b3JkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXN0ZXJtaW5hdG9ya2V5d29yZCh0LnRleHQpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHQudGV4dCA9PSAicmV0dXJuIikgb3IgKHQudGV4dCA9PSAiYnJlYWsiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYSA9IGxhc3RzdGF0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3RbI2FzdCsxXSA9IGEKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIjsiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhID0gc3RhdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGFzdFsjYXN0KzFdID0gYQoKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIjsiKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAifSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0ib2x1YV9ibG9jayIsCiAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rPWFzdCwgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbmQKCm9sdWFfbWV0aG9kY2FsbCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICJbIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgb2JqZWN0ID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvcHRpb25hbGV4cGVjdCgiaWRlbnRpZmllciIsICJzdXBlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHJ2YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RvciA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7fQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHBlZWsoImlkZW50aWZpZXIiKSBhbmQgbm90IHBlZWsoImtleXdvcmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZGVycm9yKCJpZGVudGlmaWVyIG9yIHNlbGVjdG9yIGVsZW1lbnQiKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBwZWVrc2VsZWwoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBTaW5nbGUtZWxlbWVudCBzZWxlY3Rvci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yWyNzZWxlY3RvciArIDFdID0gdG9rZW5zW3Bvc10udGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IGdldHNlbGVsKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yWyNzZWxlY3RvciArIDFdID0gdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3NbI2FyZ3MgKyAxXSA9IHJ2YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiLCIpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzWyNhcmdzICsgMV0gPSBydmFsdWUoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiXSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RjYWxsIAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJvbHVhX21ldGhvZGNhbGwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0PW9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yPSB0YWJsZS5jb25jYXQoc2VsZWN0b3IpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncz1hcmdzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICBlbmQKb2x1YV90aHJvdyA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIG9iaiA9IHN0YXQoKQogICAgICAgICAgICAgICAgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIjsiKQogICAgICAgICAgICAgICAgbG9jYWwgYXN0ID0gCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJvbHVhX3Rocm93IiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZT1vYmosCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYXN0CiAgICAgICAgICAgICBlbmQKb2x1YV9pbXBsZW1lbnRhdGlvbiA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJAaW1wbGVtZW50YXRpb24iKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNsYXNzID0gZXhwZWN0KCJpZGVudGlmaWVyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN1cGVyY2xhc3MgPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNhdGVnb3J5ID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiOiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBlcmNsYXNzID0gcnZhbHVlbGVhZigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIigiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnkgPSBleHBlY3QoImlkZW50aWZpZXIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiKSIpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXN0ID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJvbHVhX2ltcGxlbWVudGF0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1jbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBlcmNsYXNzPXN1cGVyY2xhc3MudmFsdWUudGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeT1jYXRlZ29yeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaHVuaz1jCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgdG9rZW5zW3Bvc10gZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdG9rZW5zW3Bvc10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC50eXBlID09ICJrZXl3b3JkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC50ZXh0ID09ICJAZW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGEgPSBvbHVhX2ltcGxlbWVudGF0aW9uX3N0YXQoY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN0WyNhc3QrMV0gPSBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoImtleXdvcmQiLCAiQGVuZCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbXBsZW1lbnRhdGlvbihhc3QpCiAgICAgICAgICAgICAgICAgICAgZW5kCm9sdWFfY3JlYXRlU2VsZWN0b3IgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIigiKQogICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2VsID0gZ2V0c2VsZWwoKQogICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICIpIikKICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9Im9sdWFfY3JlYXRlU2VsZWN0b3IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsPXN0cmluZ2lmeShzZWwpLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBlbmQKb2x1YV9nZXRQcm90b2NvbCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiKCIpCiAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwcm90b2NvbCA9IGV4cGVjdCgiaWRlbnRpZmllciIpCiAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIikiKQogICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0ib2x1YV9nZXRQcm90b2NvbCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm90b2NvbD1zdHJpbmdpZnkocHJvdG9jb2wudGV4dCksCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVuZAoKb2x1YV9pbXBvcnRfZmlsZSA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZmlsZU5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIigiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZSA9IGV4cGVjdCgic3RyaW5nIikudGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGlsZVRpbWVJbnRlcmFjdGlvbihnX0VuZ2luZSwgImltcG9ydCIsIGZpbGVOYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICIpIikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZU5hbWUgPSBleHBlY3QoInN0cmluZyIpLnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJvbHVhX2ltcG9ydF9maWxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVOYW1lPWZpbGVOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgIApsb2NhbCBvbHVhX2dldFR5cGVOYW1lID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHlwZUNvbnRlbnQgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJpZGVudGlmaWVyIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHQgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZUNvbnRlbnQgPSB0LnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0LnR5cGUgPT0gIm9wZXJhdG9yIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQudGV4dCA9PSAiKiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICA9IHJlc3VsdCAuLiB0LnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHQudGV4dCA9PSAiWyIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJudW1iZXIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJdIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCAuLiAiKiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoMTM5MikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZXhwZWN0ZWRlcnJvcih0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KDEzOTYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZXhwZWN0ZWRlcnJvcih0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAKbG9jYWwgb2x1YV9hcmd1bWVudExpc3RPZkZ1bmN0aW9uID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgbG9jYWwgYXN0ID0ge30KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3VtZW50VHlwZXMgPSB7dHlwZT0ibGlzdCJ9CiAgICAgICAgICAgICAgICBsb2NhbCBhcmd1bWVudE5hbWVzID0ge3R5cGU9Imxpc3QifQogICAgICAgICAgICAgICAgYXN0LmFyZ3VtZW50VHlwZXMgPSBhcmd1bWVudFR5cGVzCiAgICAgICAgICAgICAgICBhc3QuYXJndW1lbnROYW1lcyA9IGFyZ3VtZW50TmFtZXMKCiAgICAgICAgICAgICAgICBpZiBwZWVrKCJvcGVyYXRvciIsICIpIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3QKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgb3B0aW9uYWxleHBlY3QoImlkZW50aWZpZXIiLCAidm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXN0CiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBsb2NhbCB0eXBlTG9vcGVyID0gbHZhbHVlKCkKICAgICAgICAgICAgICAgIGxvY2FsIG5hbWVMb29wZXIgPSBsdmFsdWUoKQoKICAgICAgICAgICAgICAgIGFyZ3VtZW50VHlwZXNbI2FyZ3VtZW50VHlwZXMrMV0gPSB0eXBlTG9vcGVyCiAgICAgICAgICAgICAgICBhcmd1bWVudE5hbWVzWyNhcmd1bWVudE5hbWVzKzFdID0gbmFtZUxvb3BlcgoKICAgICAgICAgICAgICAgIGlmIHBlZWsoIm9wZXJhdG9yIiwgIikiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFzdAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICAgICAgICAgIHByaW50KHRva2Vuc1twb3NdLnRleHQpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHBlZWsoIm9wZXJhdG9yIiwgIiwiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhc3QKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgdHlwZUxvb3BlciA9IGx2YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRUeXBlc1sjYXJndW1lbnRUeXBlcysxXSA9IHR5cGVMb29wZXIKICAgICAgICAgICAgICAgICAgICBuYW1lTG9vcGVyID0gbHZhbHVlKCkKICAgICAgICAgICAgICAgICAgICBhcmd1bWVudE5hbWVzWyNhcmd1bWVudE5hbWVzKzFdID0gbmFtZUxvb3BlcgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICByZXR1cm4gYXN0CiAgICAgICAgICAgIGVuZAkKICAgICAgICAgICAgCm9sdWFfb2JqY19ibG9ja09iamVjdCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJsb2NrQm9keQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tb3B0aW9uYWwgZXhwZWN0IHRoZSByZXR1cm4gdHlwZSwganVzdCBpZ25vcmUgaXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsZXhwZWN0KCJpZGVudGlmaWVyIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwZWVrKCJvcGVyYXRvciIsICJ7IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrQm9keSA9IG9sdWFfYmxvY2soKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiKCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IG9sdWFfYXJndW1lbnRMaXN0T2ZGdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICIpIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tCb2R5ID0gb2x1YV9ibG9jaygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJvbHVhX29iamNfYmxvY2tPYmplY3QiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzPWFyZ3MsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrQm9keT1ibG9ja0JvZHksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZApvbHVhX29iamNfZW51bWVyYXRvciA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAib2x1YV9vYmpjX2VudW1lcmF0b3IiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBydmFsdWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCm9sdWFfb2JqY19jbGFzc1ByZWRlY2xlYXJhdGlvbiA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNsYXNzTmFtZXMgPSBsdmFsdWVsaXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICNjbGFzc05hbWVzIDwgMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRlcnJvcigiaWRlbnRpZmllciIsICJjbGFzcyBuYW1lcyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsZXhwZWN0KCJvcGVyYXRvciIsICI7IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBrLCB2IGluIGlwYWlycyhjbGFzc05hbWVzKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFzdCA9IHYudmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3QudHlwZSA9ICJzdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN0LnRleHQgPSBzdHJpbmdpZnkoYXN0LnRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gIm9sdWFfb2JqY19jbGFzc1ByZWRlY2xlYXJhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lcyA9IGNsYXNzTmFtZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZApsb2NhbCBydGFnX3JldHVybl9pbl9jaHVuayA9IGZ1bmN0aW9uKGNoKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0eXBlTG9vcGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIGlwYWlycyhjaCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVMb29wZXIgPSB2LnR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlTG9vcGVyID09ICJjaHVuayIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgc3RhdExvb3BlciBpbiBpcGFpcnModikgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnRhZ19yZXR1cm5faW5fY2h1bmsoc3RhdExvb3BlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodHlwZUxvb3BlciA9PSAiaWZlbHNlZW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCBjb25kaXRpb24gaW4gaXBhaXJzKGFzdCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT0gMSkgb3IgY29uZGl0aW9uLmNvbmRpdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydGFnX3JldHVybl9pbl9jaHVuayhjb25kaXRpb24uY29uZGl0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnRhZ19yZXR1cm5faW5fY2h1bmsoY29uZGl0aW9uLmNodW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh0eXBlTG9vcGVyID09ICJmb3JlbmQiKSBvciAodHlwZUxvb3BlciA9PSAiZm9yaW5lbmQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKHR5cGVMb29wZXIgPT0gIndoaWxlZG9lbmQiKSBvciAodHlwZUxvb3BlciA9PSAicmVwZWF0dW50aWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgKHR5cGVMb29wZXIgPT0gImRvZW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ0YWdfcmV0dXJuX2luX2NodW5rKHYuY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHR5cGVMb29wZXIgPT0gInJldHVybiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LnR5cGUgPSAicmV0dXJuRnJvbUF1dG9yZWxlYXNlUG9vbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKCm9iamNfYXV0b3JlbGVhc2Vwb29sID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgia2V5d29yZCIsICJAYXV0b3JlbGVhc2Vwb29sIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjID0gb2x1YV9ibG9jaygpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ0YWdfcmV0dXJuX2luX2NodW5rKGMuY2h1bmspCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0ib2JqY19hdXRvcmVsZWFzZXBvb2wiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrPWMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCm9sdWFfb2JqY190cnljYXRjaGZpbmFsbHkgPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHJ5QmxvY2sgPSBvbHVhX2Jsb2NrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoImtleXdvcmQiLCAiQGNhdGNoIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIigiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRocm93ZWRPYmplY3QgPSBleHBlY3QoImlkZW50aWZpZXIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiKSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2h1bmsgPSBvbHVhX2Jsb2NrKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2F0Y2hCbG9jayA9IHsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnID0gdGhyb3dlZE9iamVjdC50ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNodW5rID0gY2h1bmssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGZpbmFsbHlCbG9jawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9wdGlvbmFsZXhwZWN0KCJrZXl3b3JkIiwgIkBmaW5hbGx5IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbGx5QmxvY2sgPSBvbHVhX2Jsb2NrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJvbHVhX29iamNfdHJ5Y2F0Y2hmaW5hbGx5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5QmxvY2s9dHJ5QmxvY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoQmxvY2s9Y2F0Y2hCbG9jaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxseUJsb2NrPWZpbmFsbHlCbG9jaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKb2x1YV9wcm9wZXJ0eV9kZWNsZWFyYXRpb24gPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcHJvcGVydHlBdHRyaWJ1dGUgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIigiKSB0aGVuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRva2Vuc1twb3NdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0ID0gdC50ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGV4dCA9PSAiLCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSBwb3MgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHRleHQgPT0gIikiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodGV4dCA9PSAibm9uYXRvbWljIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHByb3BlcnR5QXR0cmlidXRlLmF0b21pYyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KDE1MzEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZXhwZWN0ZWRlcnJvcih0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlBdHRyaWJ1dGUuYXRvbWljID0gIm5vbmF0b21pYyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmICh0ZXh0ID09ICJhc3NpZ24iKSBvciAodGV4dCA9PSAiY29weSIpIG9yICh0ZXh0ID09ICJyZXRhaW4iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcHJvcGVydHlBdHRyaWJ1dGUub3duZXJzaGlwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoMTUzOSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5leHBlY3RlZGVycm9yKHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUF0dHJpYnV0ZS5vd25lcnNoaXAgPSB0ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAodGV4dCA9PSAiZ2V0dGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHByb3BlcnR5QXR0cmlidXRlLmdldHRlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZXhwZWN0ZWRlcnJvcih0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIj0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUF0dHJpYnV0ZS5nZXR0ZXIgPSBleHBlY3QoImlkZW50aWZpZXIiKS50ZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgKHRleHQgPT0gInNldHRlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwcm9wZXJ0eUF0dHJpYnV0ZS5zZXR0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmV4cGVjdGVkZXJyb3IodCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICI9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2V0dGVyID0gZXhwZWN0KCJpZGVudGlmaWVyIikudGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwiOiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5QXR0cmlidXRlLnNldHRlciA9IHNldHRlciAuLiAiOiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KCJvcGVyYXRvciIsICIpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHlwZSA9IGV4cGVjdCgiaWRlbnRpZmllciIpLnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gZXhwZWN0KCJpZGVudGlmaWVyIikudGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlBdHRyaWJ1dGVbInR5cGUiXSA9IHR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUF0dHJpYnV0ZVsibmFtZSJdID0gbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5QXR0cmlidXRlWyJpbnRlcm5hbE5hbWUiXSA9IG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiPSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlBdHRyaWJ1dGVbImludGVybmFsTmFtZSJdID0gZXhwZWN0KCJpZGVudGlmaWVyIikudGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBwcm9wZXJ0eUF0dHJpYnV0ZS5hdG9taWMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUF0dHJpYnV0ZS5hdG9taWMgPSAiYXRvbWljIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBwcm9wZXJ0eUF0dHJpYnV0ZS5vd25lcnNoaXAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUF0dHJpYnV0ZS5vd25lcnNoaXAgPSAiYXNzaWduIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBwcm9wZXJ0eUF0dHJpYnV0ZS5nZXR0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eUF0dHJpYnV0ZS5nZXR0ZXIgPSBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHByb3BlcnR5QXR0cmlidXRlLnNldHRlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5QXR0cmlidXRlLnNldHRlciA9ICJzZXQiIC4uIG5hbWU6Z3N1YigiXiVsIiwgc3RyaW5nLnVwcGVyKSAuLiAiOiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiOyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJvbHVhX3Byb3BlcnR5X2RlY2xlYXJhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZT1wcm9wZXJ0eUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCm9sdWFfaW1wbGVtZW50YXRpb25fc3RhdCA9IGZ1bmN0aW9uKGNsYXNzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHQgPSB0b2tlbnNbcG9zXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnR5cGUgPT0gImtleXdvcmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnRleHQgPT0gIkBwcm9wZXJ0eSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGMgPSBvbHVhX3Byb3BlcnR5X2RlY2xlYXJhdGlvbigpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3MgPSBjbGFzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJvbHVhX3Byb3BlcnR5X2RlY2xlYXJhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IGMuYXR0cmlidXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodC50eXBlID09ICJvcGVyYXRvciIpIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCh0LnRleHQgPT0gIi0iKSBvciAodC50ZXh0ID09ICIrIikpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbHVhX21ldGhvZGRlZmluaXRpb24oKQkJCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZW1lbnRlcnJvcih0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgpvbHVhX3R5cGVhbm5vdGF0aW9uID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIigiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByZXN1bHQgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdG9rZW5zW3Bvc10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0LnR5cGUgPT0gIm9wZXJhdG9yIiBhbmQgdC50ZXh0ID09ICIpIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICA9IHJlc3VsdCAuLiB0LnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQKICAgICAgICAgICAgICAgICAgICBlbmQKCgpvbHVhX21ldGhvZGRlZmluaXRpb24gPSBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ID0gZXhwZWN0KCJvcGVyYXRvciIsICItIiwgIisiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2xhc3NtZXRob2QgPSAodC50ZXh0ID09ICIrIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RvciA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmd0eXBlcyA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByZXR0eXBlID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXh0cmFhcmdzID0ge30KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwZWVrKCJvcGVyYXRvciIsICIoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHR5cGUgPSBvbHVhX3R5cGVhbm5vdGF0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBwZWVrKCJpZGVudGlmaWVyIikgYW5kIG5vdCBwZWVrKCJrZXl3b3JkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkZXJyb3IoImlkZW50aWZpZXIgb3Igc2VsZWN0b3IgZWxlbWVudCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcGVla3NlbGVsKCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIFNpbmdsZS1lbGVtZW50IHNlbGVjdG9yLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yWyNzZWxlY3RvciArIDFdID0gdG9rZW5zW3Bvc10udGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IHBvcyArIDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSBnZXRzZWxlbCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rvclsjc2VsZWN0b3IgKyAxXSA9IHQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBlZWsoIm9wZXJhdG9yIiwgIigiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd0eXBlc1sjYXJndHlwZXMgKyAxXSA9IG9sdWFfdHlwZWFubm90YXRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd0eXBlc1sjYXJndHlwZXMgKyAxXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnc1sjYXJncyArIDFdID0gbHZhbHVlaWRlbnRpZmllcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAiLCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRyYWFyZ3MgPSBsdmFsdWVsaXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGMgPSBvbHVhX2Jsb2NrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSJvbHVhX21ldGhvZGRlZmluaXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tY2xhc3M9Y2xhc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3I9dGFibGUuY29uY2F0KHNlbGVjdG9yKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzPWFyZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndHlwZXM9YXJndHlwZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dHlwZT1yZXR0eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhYXJncz1leHRyYWFyZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NtZXRob2Q9Y2xhc3NtZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2h1bms9YywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgpvbHVhX29iamNfbGl0ZXJhbEFycmF5ID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIl0iKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIjsiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJvbHVhX29iamNfbGl0ZXJhbEFycmF5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IGFyZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gcnZhbHVlbGlzdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QoIm9wZXJhdG9yIiwgIl0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIjsiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJvbHVhX29iamNfbGl0ZXJhbEFycmF5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gYXJncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCm9sdWFfb2JqY19saXRlcmFsRGljdGlvbmFyeSA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcHRpb25hbGV4cGVjdCgib3BlcmF0b3IiLCAifSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIjsiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJvbHVhX29iamNfbGl0ZXJhbERpY3Rpb25hcnkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5cyA9IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBrZXlzID0ge3R5cGU9Imxpc3QifQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHZhbHVlcyA9IHt0eXBlPSJsaXN0In0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleXNbI2tleXMgKyAxXSA9IHJ2YWx1ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiPSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1sjdmFsdWVzICsgMV0gPSBydmFsdWUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBwZWVrKCJvcGVyYXRvciIsICJ9IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gcG9zICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxleHBlY3QoIm9wZXJhdG9yIiwgIjsiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICJvbHVhX29iamNfbGl0ZXJhbERpY3Rpb25hcnkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleXMgPSBrZXlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHZhbHVlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdCgib3BlcmF0b3IiLCAiLCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpsb2NhbCBwYXJzZXIgPSBmdW5jdGlvbihpbnB1dCwgX3NvdXJjZSkKICAgICAgICAgICAgICAgICAgICBzb3VyY2UgPSBfc291cmNlIG9yICIodW5rbm93bikiCiAgICAgICAgICAgICAgICAgICAgdG9rZW5zID0gZ2V0dG9rZW5zKGlucHV0KQogICAgICAgICAgICAgICAgICAgIHBvcyA9IDEKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYyA9IGNodW5rKCkKICAgICAgICAgICAgICAgICAgICBpZiB0b2tlbnNbcG9zXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHVuZXhwZWN0ZWRlcnJvcih0b2tlbnNbcG9zXSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYwkKICAgICAgICAgICAgICAgIGVuZAoKCmxvY2FsIHJlc3VsdApsb2NhbCByZWN1cnNpdmVseXVucGFyc2UKbG9jYWwgcmVjdXJzaXZlbHl1bnBhcnNlYmlub3AKCmxvY2FsIGZ1bmN0aW9uIGVtaXQocykKICAgICAgICAgICAgICAgICAgICByZXN1bHRbI3Jlc3VsdCArIDFdID0gcwogICAgICAgICAgICAgICAgZW5kCgpsb2NhbCB0eXBldGFibGUgPQp7CgljaHVuayA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICAgICAgICAgIGZvciBfLCBzdGF0ZW1lbnQgaW4gaXBhaXJzKGFzdCkgZG8KICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2Uoc3RhdGVtZW50KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCwKICAgICAgICAKICAgIGRvZW5kID0gZnVuY3Rpb24oYXN0KQoJCWVtaXQoIlxuZG9cbiIpCgkJcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5jaHVuaykKCQllbWl0KCJcbmVuZCIpCiAgICBlbmQsCiAgICAgICAgCiAgICBpZmVsc2VlbmQgPSBmdW5jdGlvbihhc3QpCgkJZm9yIGksIGNvbmRpdGlvbiBpbiBpcGFpcnMoYXN0KSBkbwoJCQlpZiAoaSA9PSAxKSB0aGVuCgkJCQllbWl0KCJpZiIpCgkJCQlyZWN1cnNpdmVseXVucGFyc2UoY29uZGl0aW9uLmNvbmRpdGlvbikKCQkJCWVtaXQoInRoZW4iKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZiBjb25kaXRpb24uY29uZGl0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICBlbWl0KCJlbHNlaWYiKQogICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShjb25kaXRpb24uY29uZGl0aW9uKQogICAgICAgICAgICAgICAgICAgIGVtaXQoInRoZW4iKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGVtaXQoImVsc2UiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShjb25kaXRpb24uY2h1bmspCiAgICAgICAgZW5kCiAgICAgICAgZW1pdCgiZW5kIikKICAgIGVuZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgZm9yZW5kID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoImZvciIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC52YXIpCiAgICAgICAgZW1pdCgiPSIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5sb3cpCiAgICAgICAgZW1pdCgiLCIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5oaWdoKQogICAgICAgIGlmIGFzdC5zdGVwIHRoZW4KICAgICAgICAgICAgZW1pdCgiLCIpCiAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3Quc3RlcCkKICAgICAgICBlbmQKICAgICAgICBlbWl0KCJkbyIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5jaHVuaykKICAgICAgICBlbWl0KCJlbmQiKQogICAgZW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgZm9yaW5lbmQgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgZW1pdCgiZm9yIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LnZhcikKICAgICAgICBlbWl0KCJpbiIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5pdGVyYXRvcikKICAgICAgICBlbWl0KCJkbyIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5jaHVuaykKICAgICAgICBlbWl0KCJlbmQiKQogICAgZW5kLAogICAgb2x1YV9mb3JpbmVuZCA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBlbWl0KCJmb3IiKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QudmFyKQogICAgICAgIGVtaXQoIiBpbiBvYmpjX05TRmFzdEVudW1lcmF0ZSgiKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuaXRlcmF0b3IpCiAgICAgICAgZW1pdCgiKWRvIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmNodW5rKQogICAgICAgIGVtaXQoImVuZCIpCiAgICBlbmQsCiAgICB3aGlsZWRvZW5kID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoIndoaWxlIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmNvbmRpdGlvbikKICAgICAgICBlbWl0KCJkbyIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5jaHVuaykKICAgICAgICBlbWl0KCJlbmQiKQogICAgZW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGRvd2hpbGUgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgZW1pdCgicmVwZWF0IikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmNodW5rKQogICAgICAgIGVtaXQoInVudGlsIG5vdCgiKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuY29uZGl0aW9uKQogICAgICAgIGVtaXQoIikiKQogICAgZW5kLAogICAgcmVwZWF0dW50aWwgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgZW1pdCgicmVwZWF0IikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmNodW5rKQogICAgICAgIGVtaXQoInVudGlsKCIpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5jb25kaXRpb24pCiAgICAgICAgZW1pdCgiKSIpCiAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBbInJldHVybiJdID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoIiByZXR1cm4gIikKICAgICAgICBpZiBhc3QudmFsdWUgdGhlbgogICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LnZhbHVlKQogICAgICAgIGVuZAogICAgZW5kLAogICAgCiAgICByZXR1cm5Gcm9tQXV0b3JlbGVhc2VQb29sID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoIiByZXR1cm4geydAcG9vbCcsIikKICAgICAgICBpZiBhc3QudmFsdWUgdGhlbgogICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LnZhbHVlKQogICAgICAgIGVsc2UKICAgICAgICAgICAgZW1pdCgiIG5pbCAiKQogICAgICAgIGVuZAogICAgICAgIGVtaXQoIn0iKQogICAgZW5kLAogICAgCiAgICBbImJyZWFrIl0gPSBmdW5jdGlvbihhc3QpCiAgICAgICAgZW1pdCgiYnJlYWsiKQogICAgZW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGZ1bmN0aW9uY2FsbCA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LnZhbHVlKQogICAgICAgIGVtaXQoIigiKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuYXJncykKICAgICAgICBlbWl0KCIpIikKICAgIGVuZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBmdW5jdGlvbmRlZiA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBpZiBub3QgYXN0Lm5hbWUgdGhlbgogICAgICAgICAgICBlbWl0KCIoIikKICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGVtaXQoIlxuZnVuY3Rpb24gIikKICAgICAgICBpZiBhc3QubmFtZSB0aGVuCiAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QubmFtZSkKICAgICAgICBlbmQKICAgICAgICBlbWl0KCIoIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmFyZ3MpCiAgICAgICAgZW1pdCgiKVxuIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmNodW5rKQogICAgICAgIGVtaXQoIlxuZW5kXG4iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGlmIG5vdCBhc3QubmFtZSB0aGVuCiAgICAgICAgICAgIGVtaXQoIikiKQogICAgICAgIGVuZAogICAgZW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGFzc2lnbm1lbnQgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5sZWZ0KQogICAgICAgIGlmIGFzdC5yaWdodCB0aGVuCiAgICAgICAgICAgIGVtaXQoIj0iKQogICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LnJpZ2h0KQogICAgICAgIGVuZAogICAgZW5kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICBsaXN0ID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGZvciBpID0gMSwgI2FzdCBkbwogICAgICAgICAgICBsb2NhbCBleHAgPSBhc3RbaV0KICAgICAgICAgICAgaWYgKGkgPiAxKSB0aGVuCiAgICAgICAgICAgICAgICBlbWl0KCIsIikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShleHApCiAgICAgICAgZW5kCiAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgdGFibGVsaXRlcmFsID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoInsiKQogICAgICAgIGZvciBpID0gMSwgI2FzdCBkbwogICAgICAgICAgICBsb2NhbCBlbnRyeSA9IGFzdFtpXQogICAgICAgICAgICBpZiAoaSA+IDEpIHRoZW4KICAgICAgICAgICAgICAgIGVtaXQoIiwiKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZW50cnkua2V5IHRoZW4KICAgICAgICAgICAgICAgIGlmIChlbnRyeS5rZXkudHlwZSA9PSAiaWRlbnRpZmllciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBlbWl0KGVudHJ5LmtleSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBlbWl0KCJbIikKICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoZW50cnkua2V5KQogICAgICAgICAgICAgICAgICAgIGVtaXQoIl0iKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW1pdCgiPSIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoZW50cnkudmFsdWUpCiAgICAgICAgZW5kCiAgICAgICAgZW1pdCgifSIpCiAgICBlbmQsCiAgICAKICAgIGJpbm9wID0gZnVuY3Rpb24oYXN0KQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZWJpbm9wKGFzdC5sZWZ0LCBhc3QucHJlY2VkZW5jZSkKICAgICAgICBlbWl0KGFzdC5vcGVyYXRvcikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2ViaW5vcChhc3QucmlnaHQsIGFzdC5wcmVjZWRlbmNlKQogICAgZW5kLAogICAgCiAgICB1bm9wID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoYXN0Lm9wZXJhdG9yKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZWJpbm9wKGFzdC52YWx1ZSwgYXN0LnByZWNlZGVuY2UpCiAgICBlbmQsCiAgICAKICAgIGRlcmVmID0gZnVuY3Rpb24oYXN0KQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QubGVmdCkKICAgICAgICBlbWl0KCJbIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LnJpZ2h0KQogICAgICAgIGVtaXQoIl0iKQogICAgZW5kLAogICAgCiAgICBbImxvY2FsIl0gPSBmdW5jdGlvbihhc3QpCiAgICAgICAgZW1pdCgiXG5sb2NhbCAiKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QudmFsdWUpCiAgICBlbmQsCiAgICAKICAgIGxlYWYgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgZW1pdChhc3QudmFsdWUpCiAgICBlbmQsCiAgICAgICAgICAgICAgICAgICAgICAgCiAgICBvYmpjX2FsbG9jYXRlQ2xhc3NQYWlyID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoIm9iamNfYWxsb2NhdGVDbGFzc1BhaXIoIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmFyZ3MpCiAgICAgICAgZW1pdCgiKSIpCiAgICBlbmQsCiAgICAKICAgIG9sdWFfYmxvY2sgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5jaHVuaykKICAgIGVuZCwKICAgIAogICAgb2x1YV9tZXRob2RjYWxsID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoIltvYmplY3Q9IikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0Lm9iamVjdCkKICAgICAgICBlbWl0KCIgc2VsZWN0b3I9IikKICAgICAgICBlbWl0KGFzdC5zZWxlY3RvcikKICAgICAgICBlbWl0KCIgYXJncz17IikKICAgICAgICBmb3IgaSA9IDEsICNhc3QuYXJncyBkbwogICAgICAgICAgICBpZiAoaSA+IDEpIHRoZW4KICAgICAgICAgICAgICAgIGVtaXQoIiwiKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5hcmdzW2ldKQogICAgICAgIGVuZAogICAgICAgIGVtaXQoIn1dIikKICAgIGVuZCwKICAgICAgICAgICAgCiAgICBvbHVhX21ldGhvZF9pbm5lcl9jYWxsID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoIiBvYmpjX21zZ1NlbmQoIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0Lm9iamVjdCkKICAgICAgICBlbWl0KCIsIiAuLiBhc3Quc2VsZWN0b3IpCiAgICAgICAgaWYgI2FzdC5hcmdzID4gMCB0aGVuCiAgICAgICAgICAgIGVtaXQoIiwiKQogICAgICAgIGVuZAogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuYXJncykKICAgICAgICBlbWl0KCIpIikKICAgIGVuZCwKICAgIAogICAgb2x1YV9tZXRob2Rfc3VwZXJfY2FsbCA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBlbWl0KCIgb2JqY19tc2dTZW5kU3VwZXIoc2VsZiwiKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuYXJncykKICAgICAgICBlbWl0KCIpIikKICAgIGVuZCwKCiAgICBvbHVhX2NsYXNzX21ldGhvZF9pbXBsZW1lbnRhdGlvbiA9IGZ1bmN0aW9uKGFzdCkKCQlyZWN1cnNpdmVseXVucGFyc2UoYXN0LmNodW5rKQogICAgZW5kLAoKICAgIGx1YUNsYXNzX2FkZE1ldGhvZCA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBpZiBhc3QubWV0aG9kVHlwZSA9PSAib2JqZWN0bWV0aG9kIiB0aGVuCiAgICAgICAgICAgIGVtaXQoIlxuY2xhc3NfYWRkSW5zdGFuY2VNZXRob2QoJyIgLi4gYXN0LmNsYXNzLnRleHQgLi4gIicsICIpCiAgICAgICAgZWxzZQogICAgICAgICAgICBlbWl0KCJcbmNsYXNzX2FkZENsYXNzTWV0aG9kKCciIC4uIGFzdC5jbGFzcy50ZXh0IC4uICInLCAiKQogICAgICAgIGVuZAogICAgICAgIGVtaXQoYXN0LnNlbGVjdG9yKQoKICAgICAgICBpZiBhc3QucmV0dHlwZSB0aGVuCiAgICAgICAgICAgIGVtaXQoIiwnIiAuLiBhc3QucmV0dHlwZSAuLiAiJyIpCiAgICAgICAgZWxzZQogICAgICAgICAgICBlbWl0KCIsbmlsIikKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBmb3IgaSA9IDEsI2FzdC5hcmd0eXBlcyBkbwogICAgICAgICAgICBlbWl0KCIsJyIgLi4gYXN0LmFyZ3R5cGVzW2ldIC4uICInIikKICAgICAgICBlbmQKICAgICAgICBlbWl0KCIsIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmltcCkKICAgICAgICBlbWl0KCIpIikKICAgIGVuZCwKICAgICAgICAgCiAgICBjbGFzc19pbXBsZW1lbnRhdGlvbiA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBlbWl0KCJcbmRvXG4iKQoJCXJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuY2h1bmspCiAgICAgICAgZW1pdCgiIG9iamNfcmVnaXN0ZXJDbGFzc1BhaXIoJyIgLi4gYXN0LmNsYXNzLnRleHQgLi4gIicpIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmNsYXNzTWV0aG9kc0NodW5rKQoJCWVtaXQoIiBlbmRcbiIpCiAgICBlbmQsCiAgICAKICAgIG9sdWFfcHJvcGVydHlfZGVjbGVhcmF0aW9uID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGxvY2FsIGNsYXNzTmFtZSA9IGFzdC5jbGFzcy50ZXh0CiAgICAgICAgbG9jYWwgcHJvcGVydHlBdHRyaWJ1dGUgPSBhc3QuYXR0cmlidXRlCiAgICAgICAgcHJpbnQoJ3NldHRlcicsIHByb3BlcnR5QXR0cmlidXRlLnNldHRlcikKICAgICAgICBlbWl0KCIgY2xhc3NfYWRkUHJvcGVydHkoJyIgLi4gY2xhc3NOYW1lIC4uICInLCAnIiAuLiBwcm9wZXJ0eUF0dHJpYnV0ZS5hdG9taWMgLi4gIicsJyIpCiAgICAgICAgZW1pdChwcm9wZXJ0eUF0dHJpYnV0ZS5vd25lcnNoaXAgLi4gIicsJyIgLi4gcHJvcGVydHlBdHRyaWJ1dGUuZ2V0dGVyIC4uICInLCciIC4uIHByb3BlcnR5QXR0cmlidXRlLnNldHRlciAuLiAiJywnIikKICAgICAgICBlbWl0KHByb3BlcnR5QXR0cmlidXRlLnR5cGUgLi4gIicsJyIgLi4gcHJvcGVydHlBdHRyaWJ1dGUubmFtZSAuLiAiJywnIiAuLiBwcm9wZXJ0eUF0dHJpYnV0ZS5pbnRlcm5hbE5hbWUgLi4gIicpIiApCiAgICBlbmQsCiAgICAKICAgIG9sdWFfY3JlYXRlU2VsZWN0b3IgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgbG9jYWwgc2VsID0gYXN0LnNlbAogICAgICAgIGVtaXQoIiBzZWxfcmVnaXN0ZXJOYW1lKCIgLi4gc2VsIC4uICIpIikKICAgIGVuZCwKICAgIAogICAgb2x1YV9nZXRQcm90b2NvbCA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBsb2NhbCBwcm90b2NvbCA9IGFzdC5wcm90b2NvbAogICAgICAgIGVtaXQoIiBvYmpjX2dldFByb3RvY29sKCIgLi4gcHJvdG9jb2wgLi4gIikiKQogICAgZW5kLAoKICAgIG9iamNfYXV0b3JlbGVhc2Vwb29sID0gZnVuY3Rpb24oYXN0KQogICAgICAgIGVtaXQoWz09WwogICAgICAgICAgICAgICAgZG8gCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgX19wb29sX18gPSBvYmpjX21zZ1NlbmQob2JqY19tc2dTZW5kKE5TQXV0b3JlbGVhc2VQb29sLCdhbGxvYycpLCAnaW5pdCcpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgX19mdW5jX189KGZ1bmN0aW9uKCkKICAgICAgICAgICAgIF09PV0KICAgICAgICAgICAgKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuYmxvY2spCiAgICAgICAgZW1pdChbPT1bIGVuZCkKICAgICAgICAgICAgbG9jYWwgX19yZXR1cm5UYWJsZV9fID0gX19mdW5jX18oKQogICAgICAgICAgICBpZiBfX3JldHVyblRhYmxlX18gdGhlbgogICAgICAgICAgICAgICAgICBsb2NhbCBfX3JldF9fPV9fcmV0dXJuVGFibGVfX1syXQogICAgICAgICAgICAgICAgICBvYmpjX3JldGFpbkJlZm9yZVJldHVybkZyb21BdXRvcmVsZWFzZVBvb2woX19yZXRfXykKICAgICAgICAgICAgICAgICAgb2JqY19tc2dTZW5kKF9fcG9vbF9fLCAncmVsZWFzZScpCiAgICAgICAgICAgICAgICAgIGNvbGxlY3RnYXJiYWdlKCJjb2xsZWN0IikKICAgICAgICAgICAgICAgICAgcmV0dXJuIF9fcmV0X18KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICBjb2xsZWN0Z2FyYmFnZSgiY29sbGVjdCIpCiAgICAgICAgICAgICAgICAgIG9iamNfbXNnU2VuZChfX3Bvb2xfXywgJ3JlbGVhc2UnKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kXT09XSkKICAgIGVuZCwKICAgIAogICAgb2x1YV9pbXBvcnRfZmlsZSA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBlbWl0KCIgb2JqY19pbXBvcnRfZmlsZSgiIC4uIGFzdC5maWxlTmFtZSAuLiAiKVxuIikKICAgIGVuZCwKICAgIAogICAgb2x1YV90aHJvdyA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBlbWl0KCIgb2JqY190aHJvdygiKQogICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QudmFsdWUpCiAgICAgICAgZW1pdCgiKSIpCiAgICBlbmQsCiAgICBvbHVhX29iamNfZW51bWVyYXRvciA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICBlbWl0KCIgb2JqY19OU0Zhc3RFbnVtZXJhdGUoIikKICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmFyZ3MpCiAgICAgICAgZW1pdCgiKSIpCiAgICBlbmQsCiAgICBvbHVhX29iamNfYmxvY2tPYmplY3QgPSBmdW5jdGlvbihhc3QpICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCIgb2JqY19jcmVhdGVCbG9ja09iamVjdCgiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSBhc3QuYXJncwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFyZ3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmd1bWVudFR5cGVzID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8saSBpbiBpcGFpcnMoYXJncy5hcmd1bWVudFR5cGVzKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRUeXBlc1sjYXJndW1lbnRUeXBlcyArIDFdID0gc3RyaW5nbGVhZihpLnZhbHVlLnRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRUeXBlcy50eXBlID0gImxpc3QiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICNhcmd1bWVudFR5cGVzID4gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXJndW1lbnRUeXBlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoIiwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoImZ1bmN0aW9uKCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXJncy5hcmd1bWVudE5hbWVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCIpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuYmxvY2tCb2R5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCJlbmQpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCJmdW5jdGlvbigpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5ibG9ja0JvZHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoImVuZCkiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgZW5kLAogICAgCiAgICBvbHVhX29iamNfdHJ5Y2F0Y2hmaW5hbGx5ID0gZnVuY3Rpb24oYXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoWz09W2RvIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIF9fdHJ5QmxvY2tfX2Z1bmM9ZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF09PV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LnRyeUJsb2NrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCJcbmVuZFxuIikKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoIiBsb2NhbCBfX2NhdGNoQmxvY2tfX2Z1bmM9ZnVuY3Rpb24oIiAuLiBhc3QuY2F0Y2hCbG9jay5hcmcgLi4gIikiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmNhdGNoQmxvY2suY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoIlxuZW5kIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoIiBsb2NhbCBfX2ZpYW5sbHlCbG9ja19fZnVuY1xuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXN0LmZpbmFsbHlCbG9jayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoIj1mdW5jdGlvbigpIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuZmluYWxseUJsb2NrKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCJcbmVuZFxuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCIgb2JqY190cnlDYXRjaEZpbmFsbHkoX190cnlCbG9ja19fZnVuYywgX19jYXRjaEJsb2NrX19mdW5jLCBfX2ZpYW5sbHlCbG9ja19fZnVuYykiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCgiXG5lbmQiKQogICAgZW5kLCAgICAKICAgIE5TQ29uc3RhbnRTdHJpbmcgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCgiIF9fTlNDb25zdGFudFN0cmluZygiIC4uIGFzdC50ZXh0IC4uICIpIikKICAgIGVuZCwKICAgIE5TQ29uc3RhbnROdW1iZXIgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCgiIF9fTlNDb25zdGFudE51bWJlcigiIC4uIGFzdC50ZXh0IC4uICIpIikKICAgIGVuZCwKICAgIG9sdWFfb2JqY19jbGFzc1ByZWRlY2xlYXJhdGlvbiA9IGZ1bmN0aW9uKGFzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCIgb2JqY19jbGFzc1ByZWRlY2xlYXJhdGlvbigiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QuY2xhc3NOYW1lcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCIpIikKICAgIGVuZCwKICAgIG9sdWFfb2JqY19saXRlcmFsQXJyYXkgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCgiIG9iamNfY3JlYXRlTGl0ZXJhbEFycmF5KCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdC5hcmdzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoIikiKQogICAgZW5kLAogICAgb2x1YV9vYmpjX2xpdGVyYWxEaWN0aW9uYXJ5ID0gZnVuY3Rpb24oYXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCJvYmpjX2NyZWF0ZUxpdGVyYWxEaWN0aW9uYXJ5KCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgjYXN0LmtleXMgPiAwKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0LmtleXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbWl0KCIsIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QudmFsdWVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCgiKSIpCiAgICBlbmQsCn0KCnJlY3Vyc2l2ZWx5dW5wYXJzZWJpbm9wID0gZnVuY3Rpb24oYXN0LCB0aGlzcHJlY2VkZW5jZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhc3QudHlwZSA9PSAiYmlub3AiKSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChub3QgYXN0LnByZWNlZGVuY2Ugb3Igbm90IHRoaXNwcmVjZWRlbmNlIG9yIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhc3QucHJlY2VkZW5jZSA8IHRoaXNwcmVjZWRlbmNlKSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtaXQoIigiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY3Vyc2l2ZWx5dW5wYXJzZShhc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1pdCgiKSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlbHl1bnBhcnNlKGFzdCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKcmVjdXJzaXZlbHl1bnBhcnNlID0gZnVuY3Rpb24oYXN0KQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0ID0gdHlwZXRhYmxlW2FzdC50eXBlXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaywgdiBpbiBwYWlycyhhc3QpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoImssdiIsIGssIHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKCJVbmtub3duIEFTVCBub2RlIHR5cGUgIi4uYXN0LnR5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgdChhc3QpCiAgICAgICAgICAgICAgICAgICAgICBlbmQKCmxvY2FsIG5lZWRzc3BhY2UgPQp7CglzdHJpbmcgPSB0cnVlLAoJbnVtYmVyID0gdHJ1ZSwKCWlkZW50aWZpZXIgPSB0cnVlLAoJa2V5d29yZCA9IHRydWUKfQoKbG9jYWwgdW5wYXJzZXIgPSBmdW5jdGlvbihhc3QpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0ge30KICAgICAgICAgICAgICAgICAgICByZWN1cnNpdmVseXVucGFyc2UoYXN0KQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBsaW5lID0gMQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGxhc3R0eXBlID0gbmlsCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcyA9IHt9CiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHQgaW4gaXBhaXJzKHJlc3VsdCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZSh0KSA9PSAic3RyaW5nIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBpc3N0cmluZyA9IHQ6ZmluZCgiXlsld19dKiQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmVlZHNzcGFjZVtsYXN0dHlwZV0gYW5kIGlzc3RyaW5nIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWyNzKzFdID0gIiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWyNzKzFdID0gdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNzdHJpbmcgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3R0eXBlID0gInN0cmluZyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0dHlwZSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHQubGluZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGxpbmUgPCB0LmxpbmUpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tc1sjcysxXSA9ICJcbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZSA9IGxpbmUgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3R0eXBlID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuZWVkc3NwYWNlW2xhc3R0eXBlXSBhbmQgbmVlZHNzcGFjZVt0LnR5cGVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWyNzKzFdID0gIiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzWyNzKzFdID0gdC50ZXh0CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdHR5cGUgPSB0LnR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YWJsZS5jb25jYXQocykKICAgICAgICAgICAgICAgIGVuZAoKCnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKGludGV4dCwgZW5naW5lKQogICAgICAgICAgICAgICAgZ19FbmdpbmUgPSBlbmdpbmUKICAgICAgICAgICAgICAgIGxvY2FsIHJlc3VsdCA9IHVucGFyc2VyKHBhcnNlcihpbnRleHQsIG5pbCkpCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgICAgICAtLXJldHVybiBzdHJpbmcuZ3N1YihyZXN1bHQsICIoXG4rKSIsICJcbiIpCiAgICAgICAgICAgIGVuZAo="
