//
//  VMKJqueryMinBase64String.h
//  VeritasMachineKit
//
//  Created by tearsofphoenix on 13-2-28.
//
//

#ifndef __VMK_VMKJqueryMinBase64String__
#define __VMK_VMKJqueryMinBase64String__ 1

#define VMKJqueryMinBase64String @"LyohDQoqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjEuNC4yDQoqIGh0dHA6Ly9qcXVlcnkuY29tLw0KKg0KKiBDb3B5cmlnaHQgMjAxMCwgSm9obiBSZXNpZw0KKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgb3IgR1BMIFZlcnNpb24gMiBsaWNlbnNlcy4NCiogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQ0KKg0KKiBJbmNsdWRlcyBTaXp6bGUuanMNCiogaHR0cDovL3NpenpsZWpzLmNvbS8NCiogQ29weXJpZ2h0IDIwMTAsIFRoZSBEb2pvIEZvdW5kYXRpb24NCiogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCwgQlNELCBhbmQgR1BMIExpY2Vuc2VzLg0KKg0KKiBEYXRlOiBTYXQgRmViIDEzIDIyOjMzOjQ4IDIwMTAgLTA1MDANCiovDQooZnVuY3Rpb24gKEEsIHcpIHsNCiAgICBmdW5jdGlvbiBtYSgpIHsgaWYgKCFjLmlzUmVhZHkpIHsgdHJ5IHsgcy5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwoImxlZnQiKSB9IGNhdGNoIChhKSB7IHNldFRpbWVvdXQobWEsIDEpOyByZXR1cm4gfSBjLnJlYWR5KCkgfSB9IGZ1bmN0aW9uIFFhKGEsIGIpIHsgYi5zcmMgPyBjLmFqYXgoeyB1cmw6IGIuc3JjLCBhc3luYzogZmFsc2UsIGRhdGFUeXBlOiAic2NyaXB0IiB9KSA6IGMuZ2xvYmFsRXZhbChiLnRleHQgfHwgYi50ZXh0Q29udGVudCB8fCBiLmlubmVySFRNTCB8fCAiIik7IGIucGFyZW50Tm9kZSAmJiBiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYikgfSBmdW5jdGlvbiBYKGEsIGIsIGQsIGYsIGUsIGopIHsNCiAgICAgICAgdmFyIGkgPSBhLmxlbmd0aDsgaWYgKHR5cGVvZiBiID09PSAib2JqZWN0IikgeyBmb3IgKHZhciBvIGluIGIpIFgoYSwgbywgYltvXSwgZiwgZSwgZCk7IHJldHVybiBhIH0gaWYgKGQgIT09IHcpIHsgZiA9ICFqICYmIGYgJiYgYy5pc0Z1bmN0aW9uKGQpOyBmb3IgKG8gPSAwOyBvIDwgaTsgbysrKSBlKGFbb10sIGIsIGYgPyBkLmNhbGwoYVtvXSwgbywgZShhW29dLCBiKSkgOiBkLCBqKTsgcmV0dXJuIGEgfSByZXR1cm4gaSA/DQplKGFbMF0sIGIpIDogdw0KICAgIH0gZnVuY3Rpb24gSigpIHsgcmV0dXJuIChuZXcgRGF0ZSkuZ2V0VGltZSgpIH0gZnVuY3Rpb24gWSgpIHsgcmV0dXJuIGZhbHNlIH0gZnVuY3Rpb24gWigpIHsgcmV0dXJuIHRydWUgfSBmdW5jdGlvbiBuYShhLCBiLCBkKSB7IGRbMF0udHlwZSA9IGE7IHJldHVybiBjLmV2ZW50LmhhbmRsZS5hcHBseShiLCBkKSB9IGZ1bmN0aW9uIG9hKGEpIHsNCiAgICAgICAgdmFyIGIsIGQgPSBbXSwgZiA9IFtdLCBlID0gYXJndW1lbnRzLCBqLCBpLCBvLCBrLCBuLCByOyBpID0gYy5kYXRhKHRoaXMsICJldmVudHMiKTsgaWYgKCEoYS5saXZlRmlyZWQgPT09IHRoaXMgfHwgIWkgfHwgIWkubGl2ZSB8fCBhLmJ1dHRvbiAmJiBhLnR5cGUgPT09ICJjbGljayIpKSB7DQogICAgICAgICAgICBhLmxpdmVGaXJlZCA9IHRoaXM7IHZhciB1ID0gaS5saXZlLnNsaWNlKDApOyBmb3IgKGsgPSAwOyBrIDwgdS5sZW5ndGg7IGsrKykgeyBpID0gdVtrXTsgaS5vcmlnVHlwZS5yZXBsYWNlKE8sICIiKSA9PT0gYS50eXBlID8gZi5wdXNoKGkuc2VsZWN0b3IpIDogdS5zcGxpY2Uoay0tLCAxKSB9IGogPSBjKGEudGFyZ2V0KS5jbG9zZXN0KGYsIGEuY3VycmVudFRhcmdldCk7IG4gPSAwOyBmb3IgKHIgPQ0Kai5sZW5ndGg7IG4gPCByOyBuKyspIGZvciAoayA9IDA7IGsgPCB1Lmxlbmd0aDsgaysrKSB7IGkgPSB1W2tdOyBpZiAoaltuXS5zZWxlY3RvciA9PT0gaS5zZWxlY3RvcikgeyBvID0galtuXS5lbGVtOyBmID0gbnVsbDsgaWYgKGkucHJlVHlwZSA9PT0gIm1vdXNlZW50ZXIiIHx8IGkucHJlVHlwZSA9PT0gIm1vdXNlbGVhdmUiKSBmID0gYyhhLnJlbGF0ZWRUYXJnZXQpLmNsb3Nlc3QoaS5zZWxlY3RvcilbMF07IGlmICghZiB8fCBmICE9PSBvKSBkLnB1c2goeyBlbGVtOiBvLCBoYW5kbGVPYmo6IGkgfSkgfSB9IG4gPSAwOyBmb3IgKHIgPSBkLmxlbmd0aDsgbiA8IHI7IG4rKykgeyBqID0gZFtuXTsgYS5jdXJyZW50VGFyZ2V0ID0gai5lbGVtOyBhLmRhdGEgPSBqLmhhbmRsZU9iai5kYXRhOyBhLmhhbmRsZU9iaiA9IGouaGFuZGxlT2JqOyBpZiAoai5oYW5kbGVPYmoub3JpZ0hhbmRsZXIuYXBwbHkoai5lbGVtLCBlKSA9PT0gZmFsc2UpIHsgYiA9IGZhbHNlOyBicmVhayB9IH0gcmV0dXJuIGINCiAgICAgICAgfSANCiAgICB9IGZ1bmN0aW9uIHBhKGEsIGIpIHsNCiAgICAgICAgcmV0dXJuICJsaXZlLiIgKyAoYSAmJiBhICE9PSAiKiIgPyBhICsgIi4iIDogIiIpICsgYi5yZXBsYWNlKC9cLi9nLCAiYCIpLnJlcGxhY2UoLyAvZywNCiImIikNCiAgICB9IGZ1bmN0aW9uIHFhKGEpIHsgcmV0dXJuICFhIHx8ICFhLnBhcmVudE5vZGUgfHwgYS5wYXJlbnROb2RlLm5vZGVUeXBlID09PSAxMSB9IGZ1bmN0aW9uIHJhKGEsIGIpIHsgdmFyIGQgPSAwOyBiLmVhY2goZnVuY3Rpb24gKCkgeyBpZiAodGhpcy5ub2RlTmFtZSA9PT0gKGFbZF0gJiYgYVtkXS5ub2RlTmFtZSkpIHsgdmFyIGYgPSBjLmRhdGEoYVtkKytdKSwgZSA9IGMuZGF0YSh0aGlzLCBmKTsgaWYgKGYgPSBmICYmIGYuZXZlbnRzKSB7IGRlbGV0ZSBlLmhhbmRsZTsgZS5ldmVudHMgPSB7fTsgZm9yICh2YXIgaiBpbiBmKSBmb3IgKHZhciBpIGluIGZbal0pIGMuZXZlbnQuYWRkKHRoaXMsIGosIGZbal1baV0sIGZbal1baV0uZGF0YSkgfSB9IH0pIH0gZnVuY3Rpb24gc2EoYSwgYiwgZCkgew0KICAgICAgICB2YXIgZiwgZSwgajsgYiA9IGIgJiYgYlswXSA/IGJbMF0ub3duZXJEb2N1bWVudCB8fCBiWzBdIDogczsgaWYgKGEubGVuZ3RoID09PSAxICYmIHR5cGVvZiBhWzBdID09PSAic3RyaW5nIiAmJiBhWzBdLmxlbmd0aCA8IDUxMiAmJiBiID09PSBzICYmICF0YS50ZXN0KGFbMF0pICYmIChjLnN1cHBvcnQuY2hlY2tDbG9uZSB8fCAhdWEudGVzdChhWzBdKSkpIHsNCiAgICAgICAgICAgIGUgPQ0KdHJ1ZTsgaWYgKGogPSBjLmZyYWdtZW50c1thWzBdXSkgaWYgKGogIT09IDEpIGYgPSBqDQogICAgICAgIH0gaWYgKCFmKSB7IGYgPSBiLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsgYy5jbGVhbihhLCBiLCBmLCBkKSB9IGlmIChlKSBjLmZyYWdtZW50c1thWzBdXSA9IGogPyBmIDogMTsgcmV0dXJuIHsgZnJhZ21lbnQ6IGYsIGNhY2hlYWJsZTogZX0NCiAgICB9IGZ1bmN0aW9uIEsoYSwgYikgeyB2YXIgZCA9IHt9OyBjLmVhY2godmEuY29uY2F0LmFwcGx5KFtdLCB2YS5zbGljZSgwLCBiKSksIGZ1bmN0aW9uICgpIHsgZFt0aGlzXSA9IGEgfSk7IHJldHVybiBkIH0gZnVuY3Rpb24gd2EoYSkgeyByZXR1cm4gInNjcm9sbFRvIiBpbiBhICYmIGEuZG9jdW1lbnQgPyBhIDogYS5ub2RlVHlwZSA9PT0gOSA/IGEuZGVmYXVsdFZpZXcgfHwgYS5wYXJlbnRXaW5kb3cgOiBmYWxzZSB9IHZhciBjID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIG5ldyBjLmZuLmluaXQoYSwgYikgfSwgUmEgPSBBLmpRdWVyeSwgU2EgPSBBLiQsIHMgPSBBLmRvY3VtZW50LCBULCBUYSA9IC9eW148XSooPFtcd1xXXSs+KVtePl0qJHxeIyhbXHctXSspJC8sIFVhID0gL14uW146I1xbXC4sXSokLywgVmEgPSAvXFMvLA0KV2EgPSAvXihcc3xcdTAwQTApK3woXHN8XHUwMEEwKSskL2csIFhhID0gL148KFx3KylccypcLz8+KD86PFwvXDE+KT8kLywgUCA9IG5hdmlnYXRvci51c2VyQWdlbnQsIHhhID0gZmFsc2UsIFEgPSBbXSwgTCwgJCA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsIGFhID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgYmEgPSBBcnJheS5wcm90b3R5cGUucHVzaCwgUiA9IEFycmF5LnByb3RvdHlwZS5zbGljZSwgeWEgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZjsgYy5mbiA9IGMucHJvdG90eXBlID0geyBpbml0OiBmdW5jdGlvbiAoYSwgYikgew0KICAgIHZhciBkLCBmOyBpZiAoIWEpIHJldHVybiB0aGlzOyBpZiAoYS5ub2RlVHlwZSkgeyB0aGlzLmNvbnRleHQgPSB0aGlzWzBdID0gYTsgdGhpcy5sZW5ndGggPSAxOyByZXR1cm4gdGhpcyB9IGlmIChhID09PSAiYm9keSIgJiYgIWIpIHsgdGhpcy5jb250ZXh0ID0gczsgdGhpc1swXSA9IHMuYm9keTsgdGhpcy5zZWxlY3RvciA9ICJib2R5IjsgdGhpcy5sZW5ndGggPSAxOyByZXR1cm4gdGhpcyB9IGlmICh0eXBlb2YgYSA9PT0gInN0cmluZyIpIGlmICgoZCA9IFRhLmV4ZWMoYSkpICYmDQooZFsxXSB8fCAhYikpIGlmIChkWzFdKSB7IGYgPSBiID8gYi5vd25lckRvY3VtZW50IHx8IGIgOiBzOyBpZiAoYSA9IFhhLmV4ZWMoYSkpIGlmIChjLmlzUGxhaW5PYmplY3QoYikpIHsgYSA9IFtzLmNyZWF0ZUVsZW1lbnQoYVsxXSldOyBjLmZuLmF0dHIuY2FsbChhLCBiLCB0cnVlKSB9IGVsc2UgYSA9IFtmLmNyZWF0ZUVsZW1lbnQoYVsxXSldOyBlbHNlIHsgYSA9IHNhKFtkWzFdXSwgW2ZdKTsgYSA9IChhLmNhY2hlYWJsZSA/IGEuZnJhZ21lbnQuY2xvbmVOb2RlKHRydWUpIDogYS5mcmFnbWVudCkuY2hpbGROb2RlcyB9IHJldHVybiBjLm1lcmdlKHRoaXMsIGEpIH0gZWxzZSB7IGlmIChiID0gcy5nZXRFbGVtZW50QnlJZChkWzJdKSkgeyBpZiAoYi5pZCAhPT0gZFsyXSkgcmV0dXJuIFQuZmluZChhKTsgdGhpcy5sZW5ndGggPSAxOyB0aGlzWzBdID0gYiB9IHRoaXMuY29udGV4dCA9IHM7IHRoaXMuc2VsZWN0b3IgPSBhOyByZXR1cm4gdGhpcyB9IGVsc2UgaWYgKCFiICYmIC9eXHcrJC8udGVzdChhKSkgew0KICAgICAgICB0aGlzLnNlbGVjdG9yID0gYTsgdGhpcy5jb250ZXh0ID0gczsgYSA9IHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYSk7IHJldHVybiBjLm1lcmdlKHRoaXMsDQphKQ0KICAgIH0gZWxzZSByZXR1cm4gIWIgfHwgYi5qcXVlcnkgPyAoYiB8fCBUKS5maW5kKGEpIDogYyhiKS5maW5kKGEpOyBlbHNlIGlmIChjLmlzRnVuY3Rpb24oYSkpIHJldHVybiBULnJlYWR5KGEpOyBpZiAoYS5zZWxlY3RvciAhPT0gdykgeyB0aGlzLnNlbGVjdG9yID0gYS5zZWxlY3RvcjsgdGhpcy5jb250ZXh0ID0gYS5jb250ZXh0IH0gcmV0dXJuIGMubWFrZUFycmF5KGEsIHRoaXMpDQp9LCBzZWxlY3RvcjogIiIsIGpxdWVyeTogIjEuNC4yIiwgbGVuZ3RoOiAwLCBzaXplOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmxlbmd0aCB9LCB0b0FycmF5OiBmdW5jdGlvbiAoKSB7IHJldHVybiBSLmNhbGwodGhpcywgMCkgfSwgZ2V0OiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYSA9PSBudWxsID8gdGhpcy50b0FycmF5KCkgOiBhIDwgMCA/IHRoaXMuc2xpY2UoYSlbMF0gOiB0aGlzW2FdIH0sIHB1c2hTdGFjazogZnVuY3Rpb24gKGEsIGIsIGQpIHsNCiAgICB2YXIgZiA9IGMoKTsgYy5pc0FycmF5KGEpID8gYmEuYXBwbHkoZiwgYSkgOiBjLm1lcmdlKGYsIGEpOyBmLnByZXZPYmplY3QgPSB0aGlzOyBmLmNvbnRleHQgPSB0aGlzLmNvbnRleHQ7IGlmIChiID09PQ0KImZpbmQiKSBmLnNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciArICh0aGlzLnNlbGVjdG9yID8gIiAiIDogIiIpICsgZDsgZWxzZSBpZiAoYikgZi5zZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IgKyAiLiIgKyBiICsgIigiICsgZCArICIpIjsgcmV0dXJuIGYNCn0sIGVhY2g6IGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBjLmVhY2godGhpcywgYSwgYikgfSwgcmVhZHk6IGZ1bmN0aW9uIChhKSB7IGMuYmluZFJlYWR5KCk7IGlmIChjLmlzUmVhZHkpIGEuY2FsbChzLCBjKTsgZWxzZSBRICYmIFEucHVzaChhKTsgcmV0dXJuIHRoaXMgfSwgZXE6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBhID09PSAtMSA/IHRoaXMuc2xpY2UoYSkgOiB0aGlzLnNsaWNlKGEsICthICsgMSkgfSwgZmlyc3Q6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZXEoMCkgfSwgbGFzdDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5lcSgtMSkgfSwgc2xpY2U6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMucHVzaFN0YWNrKFIuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgInNsaWNlIiwgUi5jYWxsKGFyZ3VtZW50cykuam9pbigiLCIpKSB9LCBtYXA6IGZ1bmN0aW9uIChhKSB7DQogICAgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGMubWFwKHRoaXMsDQpmdW5jdGlvbiAoYiwgZCkgeyByZXR1cm4gYS5jYWxsKGIsIGQsIGIpIH0pKQ0KfSwgZW5kOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgYyhudWxsKSB9LCBwdXNoOiBiYSwgc29ydDogW10uc29ydCwgc3BsaWNlOiBbXS5zcGxpY2UNCn07IGMuZm4uaW5pdC5wcm90b3R5cGUgPSBjLmZuOyBjLmV4dGVuZCA9IGMuZm4uZXh0ZW5kID0gZnVuY3Rpb24gKCkgew0KICAgIHZhciBhID0gYXJndW1lbnRzWzBdIHx8IHt9LCBiID0gMSwgZCA9IGFyZ3VtZW50cy5sZW5ndGgsIGYgPSBmYWxzZSwgZSwgaiwgaSwgbzsgaWYgKHR5cGVvZiBhID09PSAiYm9vbGVhbiIpIHsgZiA9IGE7IGEgPSBhcmd1bWVudHNbMV0gfHwge307IGIgPSAyIH0gaWYgKHR5cGVvZiBhICE9PSAib2JqZWN0IiAmJiAhYy5pc0Z1bmN0aW9uKGEpKSBhID0ge307IGlmIChkID09PSBiKSB7IGEgPSB0aGlzOyAtLWIgfSBmb3IgKDsgYiA8IGQ7IGIrKykgaWYgKChlID0gYXJndW1lbnRzW2JdKSAhPSBudWxsKSBmb3IgKGogaW4gZSkgew0KICAgICAgICBpID0gYVtqXTsgbyA9IGVbal07IGlmIChhICE9PSBvKSBpZiAoZiAmJiBvICYmIChjLmlzUGxhaW5PYmplY3QobykgfHwgYy5pc0FycmF5KG8pKSkgew0KICAgICAgICAgICAgaSA9IGkgJiYgKGMuaXNQbGFpbk9iamVjdChpKSB8fA0KYy5pc0FycmF5KGkpKSA/IGkgOiBjLmlzQXJyYXkobykgPyBbXSA6IHt9OyBhW2pdID0gYy5leHRlbmQoZiwgaSwgbykNCiAgICAgICAgfSBlbHNlIGlmIChvICE9PSB3KSBhW2pdID0gbw0KICAgIH0gcmV0dXJuIGENCn07IGMuZXh0ZW5kKHsgbm9Db25mbGljdDogZnVuY3Rpb24gKGEpIHsgQS4kID0gU2E7IGlmIChhKSBBLmpRdWVyeSA9IFJhOyByZXR1cm4gYyB9LCBpc1JlYWR5OiBmYWxzZSwgcmVhZHk6IGZ1bmN0aW9uICgpIHsgaWYgKCFjLmlzUmVhZHkpIHsgaWYgKCFzLmJvZHkpIHJldHVybiBzZXRUaW1lb3V0KGMucmVhZHksIDEzKTsgYy5pc1JlYWR5ID0gdHJ1ZTsgaWYgKFEpIHsgZm9yICh2YXIgYSwgYiA9IDA7IGEgPSBRW2IrK107ICkgYS5jYWxsKHMsIGMpOyBRID0gbnVsbCB9IGMuZm4udHJpZ2dlckhhbmRsZXIgJiYgYyhzKS50cmlnZ2VySGFuZGxlcigicmVhZHkiKSB9IH0sIGJpbmRSZWFkeTogZnVuY3Rpb24gKCkgew0KICAgIGlmICgheGEpIHsNCiAgICAgICAgeGEgPSB0cnVlOyBpZiAocy5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiKSByZXR1cm4gYy5yZWFkeSgpOyBpZiAocy5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICAgICAgICBzLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLA0KTCwgZmFsc2UpOyBBLmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBjLnJlYWR5LCBmYWxzZSkNCiAgICAgICAgfSBlbHNlIGlmIChzLmF0dGFjaEV2ZW50KSB7IHMuYXR0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIEwpOyBBLmF0dGFjaEV2ZW50KCJvbmxvYWQiLCBjLnJlYWR5KTsgdmFyIGEgPSBmYWxzZTsgdHJ5IHsgYSA9IEEuZnJhbWVFbGVtZW50ID09IG51bGwgfSBjYXRjaCAoYikgeyB9IHMuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsICYmIGEgJiYgbWEoKSB9IA0KICAgIH0gDQp9LCBpc0Z1bmN0aW9uOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gJC5jYWxsKGEpID09PSAiW29iamVjdCBGdW5jdGlvbl0iIH0sIGlzQXJyYXk6IGZ1bmN0aW9uIChhKSB7IHJldHVybiAkLmNhbGwoYSkgPT09ICJbb2JqZWN0IEFycmF5XSIgfSwgaXNQbGFpbk9iamVjdDogZnVuY3Rpb24gKGEpIHsNCiAgICBpZiAoIWEgfHwgJC5jYWxsKGEpICE9PSAiW29iamVjdCBPYmplY3RdIiB8fCBhLm5vZGVUeXBlIHx8IGEuc2V0SW50ZXJ2YWwpIHJldHVybiBmYWxzZTsgaWYgKGEuY29uc3RydWN0b3IgJiYgIWFhLmNhbGwoYSwgImNvbnN0cnVjdG9yIikgJiYgIWFhLmNhbGwoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsDQoiaXNQcm90b3R5cGVPZiIpKSByZXR1cm4gZmFsc2U7IHZhciBiOyBmb3IgKGIgaW4gYSk7IHJldHVybiBiID09PSB3IHx8IGFhLmNhbGwoYSwgYikNCn0sIGlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uIChhKSB7IGZvciAodmFyIGIgaW4gYSkgcmV0dXJuIGZhbHNlOyByZXR1cm4gdHJ1ZSB9LCBlcnJvcjogZnVuY3Rpb24gKGEpIHsgdGhyb3cgYTsgfSwgcGFyc2VKU09OOiBmdW5jdGlvbiAoYSkgew0KICAgIGlmICh0eXBlb2YgYSAhPT0gInN0cmluZyIgfHwgIWEpIHJldHVybiBudWxsOyBhID0gYy50cmltKGEpOyBpZiAoL15bXF0sOnt9XHNdKiQvLnRlc3QoYS5yZXBsYWNlKC9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2csICJAIikucmVwbGFjZSgvIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2csICJdIikucmVwbGFjZSgvKD86Xnw6fCwpKD86XHMqXFspKy9nLCAiIikpKSByZXR1cm4gQS5KU09OICYmIEEuSlNPTi5wYXJzZSA/IEEuSlNPTi5wYXJzZShhKSA6IChuZXcgRnVuY3Rpb24oInJldHVybiAiICsNCmEpKSgpOyBlbHNlIGMuZXJyb3IoIkludmFsaWQgSlNPTjogIiArIGEpDQp9LCBub29wOiBmdW5jdGlvbiAoKSB7IH0sIGdsb2JhbEV2YWw6IGZ1bmN0aW9uIChhKSB7IGlmIChhICYmIFZhLnRlc3QoYSkpIHsgdmFyIGIgPSBzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0gfHwgcy5kb2N1bWVudEVsZW1lbnQsIGQgPSBzLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOyBkLnR5cGUgPSAidGV4dC9qYXZhc2NyaXB0IjsgaWYgKGMuc3VwcG9ydC5zY3JpcHRFdmFsKSBkLmFwcGVuZENoaWxkKHMuY3JlYXRlVGV4dE5vZGUoYSkpOyBlbHNlIGQudGV4dCA9IGE7IGIuaW5zZXJ0QmVmb3JlKGQsIGIuZmlyc3RDaGlsZCk7IGIucmVtb3ZlQ2hpbGQoZCkgfSB9LCBub2RlTmFtZTogZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEubm9kZU5hbWUgJiYgYS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpID09PSBiLnRvVXBwZXJDYXNlKCkgfSwgZWFjaDogZnVuY3Rpb24gKGEsIGIsIGQpIHsNCiAgICB2YXIgZiwgZSA9IDAsIGogPSBhLmxlbmd0aCwgaSA9IGogPT09IHcgfHwgYy5pc0Z1bmN0aW9uKGEpOyBpZiAoZCkgaWYgKGkpIGZvciAoZiBpbiBhKSB7DQogICAgICAgIGlmIChiLmFwcGx5KGFbZl0sDQpkKSA9PT0gZmFsc2UpIGJyZWFrDQogICAgfSBlbHNlIGZvciAoOyBlIDwgajsgKSB7IGlmIChiLmFwcGx5KGFbZSsrXSwgZCkgPT09IGZhbHNlKSBicmVhayB9IGVsc2UgaWYgKGkpIGZvciAoZiBpbiBhKSB7IGlmIChiLmNhbGwoYVtmXSwgZiwgYVtmXSkgPT09IGZhbHNlKSBicmVhayB9IGVsc2UgZm9yIChkID0gYVswXTsgZSA8IGogJiYgYi5jYWxsKGQsIGUsIGQpICE9PSBmYWxzZTsgZCA9IGFbKytlXSk7IHJldHVybiBhDQp9LCB0cmltOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gKGEgfHwgIiIpLnJlcGxhY2UoV2EsICIiKSB9LCBtYWtlQXJyYXk6IGZ1bmN0aW9uIChhLCBiKSB7IGIgPSBiIHx8IFtdOyBpZiAoYSAhPSBudWxsKSBhLmxlbmd0aCA9PSBudWxsIHx8IHR5cGVvZiBhID09PSAic3RyaW5nIiB8fCBjLmlzRnVuY3Rpb24oYSkgfHwgdHlwZW9mIGEgIT09ICJmdW5jdGlvbiIgJiYgYS5zZXRJbnRlcnZhbCA/IGJhLmNhbGwoYiwgYSkgOiBjLm1lcmdlKGIsIGEpOyByZXR1cm4gYiB9LCBpbkFycmF5OiBmdW5jdGlvbiAoYSwgYikgew0KICAgIGlmIChiLmluZGV4T2YpIHJldHVybiBiLmluZGV4T2YoYSk7IGZvciAodmFyIGQgPSAwLCBmID0gYi5sZW5ndGg7IGQgPCBmOyBkKyspIGlmIChiW2RdID09PQ0KYSkgcmV0dXJuIGQ7IHJldHVybiAtMQ0KfSwgbWVyZ2U6IGZ1bmN0aW9uIChhLCBiKSB7IHZhciBkID0gYS5sZW5ndGgsIGYgPSAwOyBpZiAodHlwZW9mIGIubGVuZ3RoID09PSAibnVtYmVyIikgZm9yICh2YXIgZSA9IGIubGVuZ3RoOyBmIDwgZTsgZisrKSBhW2QrK10gPSBiW2ZdOyBlbHNlIGZvciAoOyBiW2ZdICE9PSB3OyApIGFbZCsrXSA9IGJbZisrXTsgYS5sZW5ndGggPSBkOyByZXR1cm4gYSB9LCBncmVwOiBmdW5jdGlvbiAoYSwgYiwgZCkgeyBmb3IgKHZhciBmID0gW10sIGUgPSAwLCBqID0gYS5sZW5ndGg7IGUgPCBqOyBlKyspICFkICE9PSAhYihhW2VdLCBlKSAmJiBmLnB1c2goYVtlXSk7IHJldHVybiBmIH0sIG1hcDogZnVuY3Rpb24gKGEsIGIsIGQpIHsgZm9yICh2YXIgZiA9IFtdLCBlLCBqID0gMCwgaSA9IGEubGVuZ3RoOyBqIDwgaTsgaisrKSB7IGUgPSBiKGFbal0sIGosIGQpOyBpZiAoZSAhPSBudWxsKSBmW2YubGVuZ3RoXSA9IGUgfSByZXR1cm4gZi5jb25jYXQuYXBwbHkoW10sIGYpIH0sIGd1aWQ6IDEsIHByb3h5OiBmdW5jdGlvbiAoYSwgYiwgZCkgew0KICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSBpZiAodHlwZW9mIGIgPT09ICJzdHJpbmciKSB7IGQgPSBhOyBhID0gZFtiXTsgYiA9IHcgfSBlbHNlIGlmIChiICYmDQohYy5pc0Z1bmN0aW9uKGIpKSB7IGQgPSBiOyBiID0gdyB9IGlmICghYiAmJiBhKSBiID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gYS5hcHBseShkIHx8IHRoaXMsIGFyZ3VtZW50cykgfTsgaWYgKGEpIGIuZ3VpZCA9IGEuZ3VpZCA9IGEuZ3VpZCB8fCBiLmd1aWQgfHwgYy5ndWlkKys7IHJldHVybiBiDQp9LCB1YU1hdGNoOiBmdW5jdGlvbiAoYSkgeyBhID0gYS50b0xvd2VyQ2FzZSgpOyBhID0gLyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8uZXhlYyhhKSB8fCAvKG9wZXJhKSg/Oi4qdmVyc2lvbik/WyBcL10oW1x3Ll0rKS8uZXhlYyhhKSB8fCAvKG1zaWUpIChbXHcuXSspLy5leGVjKGEpIHx8ICEvY29tcGF0aWJsZS8udGVzdChhKSAmJiAvKG1vemlsbGEpKD86Lio/IHJ2OihbXHcuXSspKT8vLmV4ZWMoYSkgfHwgW107IHJldHVybiB7IGJyb3dzZXI6IGFbMV0gfHwgIiIsIHZlcnNpb246IGFbMl0gfHwgIjAifSB9LCBicm93c2VyOiB7fQ0KfSk7IFAgPSBjLnVhTWF0Y2goUCk7IGlmIChQLmJyb3dzZXIpIHsgYy5icm93c2VyW1AuYnJvd3Nlcl0gPSB0cnVlOyBjLmJyb3dzZXIudmVyc2lvbiA9IFAudmVyc2lvbiB9IGlmIChjLmJyb3dzZXIud2Via2l0KSBjLmJyb3dzZXIuc2FmYXJpID0NCnRydWU7IGlmICh5YSkgYy5pbkFycmF5ID0gZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIHlhLmNhbGwoYiwgYSkgfTsgVCA9IGMocyk7IGlmIChzLmFkZEV2ZW50TGlzdGVuZXIpIEwgPSBmdW5jdGlvbiAoKSB7IHMucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIEwsIGZhbHNlKTsgYy5yZWFkeSgpIH07IGVsc2UgaWYgKHMuYXR0YWNoRXZlbnQpIEwgPSBmdW5jdGlvbiAoKSB7IGlmIChzLnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIpIHsgcy5kZXRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIiwgTCk7IGMucmVhZHkoKSB9IH07IChmdW5jdGlvbiAoKSB7DQogICAgYy5zdXBwb3J0ID0ge307IHZhciBhID0gcy5kb2N1bWVudEVsZW1lbnQsIGIgPSBzLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLCBkID0gcy5jcmVhdGVFbGVtZW50KCJkaXYiKSwgZiA9ICJzY3JpcHQiICsgSigpOyBkLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7IGQuaW5uZXJIVE1MID0gIiAgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYScgc3R5bGU9J2NvbG9yOnJlZDtmbG9hdDpsZWZ0O29wYWNpdHk6LjU1Oyc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iOw0KICAgIHZhciBlID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLCBqID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpWzBdOyBpZiAoISghZSB8fCAhZS5sZW5ndGggfHwgIWopKSB7DQogICAgICAgIGMuc3VwcG9ydCA9IHsgbGVhZGluZ1doaXRlc3BhY2U6IGQuZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMywgdGJvZHk6ICFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpLmxlbmd0aCwgaHRtbFNlcmlhbGl6ZTogISFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJsaW5rIikubGVuZ3RoLCBzdHlsZTogL3JlZC8udGVzdChqLmdldEF0dHJpYnV0ZSgic3R5bGUiKSksIGhyZWZOb3JtYWxpemVkOiBqLmdldEF0dHJpYnV0ZSgiaHJlZiIpID09PSAiL2EiLCBvcGFjaXR5OiAvXjAuNTUkLy50ZXN0KGouc3R5bGUub3BhY2l0eSksIGNzc0Zsb2F0OiAhIWouc3R5bGUuY3NzRmxvYXQsIGNoZWNrT246IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IilbMF0udmFsdWUgPT09ICJvbiIsIG9wdFNlbGVjdGVkOiBzLmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpLmFwcGVuZENoaWxkKHMuY3JlYXRlRWxlbWVudCgib3B0aW9uIikpLnNlbGVjdGVkLA0KICAgICAgICAgICAgcGFyZW50Tm9kZTogZC5yZW1vdmVDaGlsZChkLmFwcGVuZENoaWxkKHMuY3JlYXRlRWxlbWVudCgiZGl2IikpKS5wYXJlbnROb2RlID09PSBudWxsLCBkZWxldGVFeHBhbmRvOiB0cnVlLCBjaGVja0Nsb25lOiBmYWxzZSwgc2NyaXB0RXZhbDogZmFsc2UsIG5vQ2xvbmVFdmVudDogdHJ1ZSwgYm94TW9kZWw6IG51bGwNCiAgICAgICAgfTsgYi50eXBlID0gInRleHQvamF2YXNjcmlwdCI7IHRyeSB7IGIuYXBwZW5kQ2hpbGQocy5jcmVhdGVUZXh0Tm9kZSgid2luZG93LiIgKyBmICsgIj0xOyIpKSB9IGNhdGNoIChpKSB7IH0gYS5pbnNlcnRCZWZvcmUoYiwgYS5maXJzdENoaWxkKTsgaWYgKEFbZl0pIHsgYy5zdXBwb3J0LnNjcmlwdEV2YWwgPSB0cnVlOyBkZWxldGUgQVtmXSB9IHRyeSB7IGRlbGV0ZSBiLnRlc3QgfSBjYXRjaCAobykgeyBjLnN1cHBvcnQuZGVsZXRlRXhwYW5kbyA9IGZhbHNlIH0gYS5yZW1vdmVDaGlsZChiKTsgaWYgKGQuYXR0YWNoRXZlbnQgJiYgZC5maXJlRXZlbnQpIHsNCiAgICAgICAgICAgIGQuYXR0YWNoRXZlbnQoIm9uY2xpY2siLCBmdW5jdGlvbiBrKCkgew0KICAgICAgICAgICAgICAgIGMuc3VwcG9ydC5ub0Nsb25lRXZlbnQgPQ0KZmFsc2U7IGQuZGV0YWNoRXZlbnQoIm9uY2xpY2siLCBrKQ0KICAgICAgICAgICAgfSk7IGQuY2xvbmVOb2RlKHRydWUpLmZpcmVFdmVudCgib25jbGljayIpDQogICAgICAgIH0gZCA9IHMuY3JlYXRlRWxlbWVudCgiZGl2Iik7IGQuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPSdyYWRpbycgbmFtZT0ncmFkaW90ZXN0JyBjaGVja2VkPSdjaGVja2VkJy8+IjsgYSA9IHMuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOyBhLmFwcGVuZENoaWxkKGQuZmlyc3RDaGlsZCk7IGMuc3VwcG9ydC5jaGVja0Nsb25lID0gYS5jbG9uZU5vZGUodHJ1ZSkuY2xvbmVOb2RlKHRydWUpLmxhc3RDaGlsZC5jaGVja2VkOyBjKGZ1bmN0aW9uICgpIHsgdmFyIGsgPSBzLmNyZWF0ZUVsZW1lbnQoImRpdiIpOyBrLnN0eWxlLndpZHRoID0gay5zdHlsZS5wYWRkaW5nTGVmdCA9ICIxcHgiOyBzLmJvZHkuYXBwZW5kQ2hpbGQoayk7IGMuYm94TW9kZWwgPSBjLnN1cHBvcnQuYm94TW9kZWwgPSBrLm9mZnNldFdpZHRoID09PSAyOyBzLmJvZHkucmVtb3ZlQ2hpbGQoaykuc3R5bGUuZGlzcGxheSA9ICJub25lIiB9KTsgYSA9IGZ1bmN0aW9uIChrKSB7DQogICAgICAgICAgICB2YXIgbiA9DQpzLmNyZWF0ZUVsZW1lbnQoImRpdiIpOyBrID0gIm9uIiArIGs7IHZhciByID0gayBpbiBuOyBpZiAoIXIpIHsgbi5zZXRBdHRyaWJ1dGUoaywgInJldHVybjsiKTsgciA9IHR5cGVvZiBuW2tdID09PSAiZnVuY3Rpb24iIH0gcmV0dXJuIHINCiAgICAgICAgfTsgYy5zdXBwb3J0LnN1Ym1pdEJ1YmJsZXMgPSBhKCJzdWJtaXQiKTsgYy5zdXBwb3J0LmNoYW5nZUJ1YmJsZXMgPSBhKCJjaGFuZ2UiKTsgYSA9IGIgPSBkID0gZSA9IGogPSBudWxsDQogICAgfSANCn0pKCk7IGMucHJvcHMgPSB7ICJmb3IiOiAiaHRtbEZvciIsICJjbGFzcyI6ICJjbGFzc05hbWUiLCByZWFkb25seTogInJlYWRPbmx5IiwgbWF4bGVuZ3RoOiAibWF4TGVuZ3RoIiwgY2VsbHNwYWNpbmc6ICJjZWxsU3BhY2luZyIsIHJvd3NwYW46ICJyb3dTcGFuIiwgY29sc3BhbjogImNvbFNwYW4iLCB0YWJpbmRleDogInRhYkluZGV4IiwgdXNlbWFwOiAidXNlTWFwIiwgZnJhbWVib3JkZXI6ICJmcmFtZUJvcmRlciIgfTsgdmFyIEcgPSAialF1ZXJ5IiArIEooKSwgWWEgPSAwLCB6YSA9IHt9OyBjLmV4dGVuZCh7IGNhY2hlOiB7fSwgZXhwYW5kbzogRywgbm9EYXRhOiB7IGVtYmVkOiB0cnVlLCBvYmplY3Q6IHRydWUsDQogICAgYXBwbGV0OiB0cnVlDQp9LCBkYXRhOiBmdW5jdGlvbiAoYSwgYiwgZCkgeyBpZiAoIShhLm5vZGVOYW1lICYmIGMubm9EYXRhW2Eubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pKSB7IGEgPSBhID09IEEgPyB6YSA6IGE7IHZhciBmID0gYVtHXSwgZSA9IGMuY2FjaGU7IGlmICghZiAmJiB0eXBlb2YgYiA9PT0gInN0cmluZyIgJiYgZCA9PT0gdykgcmV0dXJuIG51bGw7IGYgfHwgKGYgPSArK1lhKTsgaWYgKHR5cGVvZiBiID09PSAib2JqZWN0IikgeyBhW0ddID0gZjsgZVtmXSA9IGMuZXh0ZW5kKHRydWUsIHt9LCBiKSB9IGVsc2UgaWYgKCFlW2ZdKSB7IGFbR10gPSBmOyBlW2ZdID0ge30gfSBhID0gZVtmXTsgaWYgKGQgIT09IHcpIGFbYl0gPSBkOyByZXR1cm4gdHlwZW9mIGIgPT09ICJzdHJpbmciID8gYVtiXSA6IGEgfSB9LCByZW1vdmVEYXRhOiBmdW5jdGlvbiAoYSwgYikgew0KICAgIGlmICghKGEubm9kZU5hbWUgJiYgYy5ub0RhdGFbYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSkpIHsNCiAgICAgICAgYSA9IGEgPT0gQSA/IHphIDogYTsgdmFyIGQgPSBhW0ddLCBmID0gYy5jYWNoZSwgZSA9IGZbZF07IGlmIChiKSB7IGlmIChlKSB7IGRlbGV0ZSBlW2JdOyBjLmlzRW1wdHlPYmplY3QoZSkgJiYgYy5yZW1vdmVEYXRhKGEpIH0gfSBlbHNlIHsNCiAgICAgICAgICAgIGlmIChjLnN1cHBvcnQuZGVsZXRlRXhwYW5kbykgZGVsZXRlIGFbYy5leHBhbmRvXTsNCiAgICAgICAgICAgIGVsc2UgYS5yZW1vdmVBdHRyaWJ1dGUgJiYgYS5yZW1vdmVBdHRyaWJ1dGUoYy5leHBhbmRvKTsgZGVsZXRlIGZbZF0NCiAgICAgICAgfSANCiAgICB9IA0KfSANCn0pOyBjLmZuLmV4dGVuZCh7IGRhdGE6IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgaWYgKHR5cGVvZiBhID09PSAidW5kZWZpbmVkIiAmJiB0aGlzLmxlbmd0aCkgcmV0dXJuIGMuZGF0YSh0aGlzWzBdKTsgZWxzZSBpZiAodHlwZW9mIGEgPT09ICJvYmplY3QiKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgYy5kYXRhKHRoaXMsIGEpIH0pOyB2YXIgZCA9IGEuc3BsaXQoIi4iKTsgZFsxXSA9IGRbMV0gPyAiLiIgKyBkWzFdIDogIiI7IGlmIChiID09PSB3KSB7IHZhciBmID0gdGhpcy50cmlnZ2VySGFuZGxlcigiZ2V0RGF0YSIgKyBkWzFdICsgIiEiLCBbZFswXV0pOyBpZiAoZiA9PT0gdyAmJiB0aGlzLmxlbmd0aCkgZiA9IGMuZGF0YSh0aGlzWzBdLCBhKTsgcmV0dXJuIGYgPT09IHcgJiYgZFsxXSA/IHRoaXMuZGF0YShkWzBdKSA6IGYgfSBlbHNlIHJldHVybiB0aGlzLnRyaWdnZXIoInNldERhdGEiICsgZFsxXSArICIhIiwgW2RbMF0sIGJdKS5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgYy5kYXRhKHRoaXMsDQphLCBiKQ0KICAgIH0pDQp9LCByZW1vdmVEYXRhOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgYy5yZW1vdmVEYXRhKHRoaXMsIGEpIH0pIH0gDQp9KTsgYy5leHRlbmQoeyBxdWV1ZTogZnVuY3Rpb24gKGEsIGIsIGQpIHsgaWYgKGEpIHsgYiA9IChiIHx8ICJmeCIpICsgInF1ZXVlIjsgdmFyIGYgPSBjLmRhdGEoYSwgYik7IGlmICghZCkgcmV0dXJuIGYgfHwgW107IGlmICghZiB8fCBjLmlzQXJyYXkoZCkpIGYgPSBjLmRhdGEoYSwgYiwgYy5tYWtlQXJyYXkoZCkpOyBlbHNlIGYucHVzaChkKTsgcmV0dXJuIGYgfSB9LCBkZXF1ZXVlOiBmdW5jdGlvbiAoYSwgYikgeyBiID0gYiB8fCAiZngiOyB2YXIgZCA9IGMucXVldWUoYSwgYiksIGYgPSBkLnNoaWZ0KCk7IGlmIChmID09PSAiaW5wcm9ncmVzcyIpIGYgPSBkLnNoaWZ0KCk7IGlmIChmKSB7IGIgPT09ICJmeCIgJiYgZC51bnNoaWZ0KCJpbnByb2dyZXNzIik7IGYuY2FsbChhLCBmdW5jdGlvbiAoKSB7IGMuZGVxdWV1ZShhLCBiKSB9KSB9IH0gfSk7IGMuZm4uZXh0ZW5kKHsgcXVldWU6IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgaWYgKHR5cGVvZiBhICE9PSAic3RyaW5nIikgeyBiID0gYTsgYSA9ICJmeCIgfSBpZiAoYiA9PT0NCncpIHJldHVybiBjLnF1ZXVlKHRoaXNbMF0sIGEpOyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGQgPSBjLnF1ZXVlKHRoaXMsIGEsIGIpOyBhID09PSAiZngiICYmIGRbMF0gIT09ICJpbnByb2dyZXNzIiAmJiBjLmRlcXVldWUodGhpcywgYSkgfSkNCn0sIGRlcXVldWU6IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyBjLmRlcXVldWUodGhpcywgYSkgfSkgfSwgZGVsYXk6IGZ1bmN0aW9uIChhLCBiKSB7IGEgPSBjLmZ4ID8gYy5meC5zcGVlZHNbYV0gfHwgYSA6IGE7IGIgPSBiIHx8ICJmeCI7IHJldHVybiB0aGlzLnF1ZXVlKGIsIGZ1bmN0aW9uICgpIHsgdmFyIGQgPSB0aGlzOyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgYy5kZXF1ZXVlKGQsIGIpIH0sIGEpIH0pIH0sIGNsZWFyUXVldWU6IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0aGlzLnF1ZXVlKGEgfHwgImZ4IiwgW10pIH0gDQp9KTsgdmFyIEFhID0gL1tcblx0XS9nLCBjYSA9IC9ccysvLCBaYSA9IC9cci9nLCAkYSA9IC9ocmVmfHNyY3xzdHlsZS8sIGFiID0gLyhidXR0b258aW5wdXQpL2ksIGJiID0gLyhidXR0b258aW5wdXR8b2JqZWN0fHNlbGVjdHx0ZXh0YXJlYSkvaSwNCmNiID0gL14oYXxhcmVhKSQvaSwgQmEgPSAvcmFkaW98Y2hlY2tib3gvOyBjLmZuLmV4dGVuZCh7IGF0dHI6IGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBYKHRoaXMsIGEsIGIsIHRydWUsIGMuYXR0cikgfSwgcmVtb3ZlQXR0cjogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7IGMuYXR0cih0aGlzLCBhLCAiIik7IHRoaXMubm9kZVR5cGUgPT09IDEgJiYgdGhpcy5yZW1vdmVBdHRyaWJ1dGUoYSkgfSkgfSwgYWRkQ2xhc3M6IGZ1bmN0aW9uIChhKSB7DQogICAgaWYgKGMuaXNGdW5jdGlvbihhKSkgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAobikgeyB2YXIgciA9IGModGhpcyk7IHIuYWRkQ2xhc3MoYS5jYWxsKHRoaXMsIG4sIHIuYXR0cigiY2xhc3MiKSkpIH0pOyBpZiAoYSAmJiB0eXBlb2YgYSA9PT0gInN0cmluZyIpIGZvciAodmFyIGIgPSAoYSB8fCAiIikuc3BsaXQoY2EpLCBkID0gMCwgZiA9IHRoaXMubGVuZ3RoOyBkIDwgZjsgZCsrKSB7DQogICAgICAgIHZhciBlID0gdGhpc1tkXTsgaWYgKGUubm9kZVR5cGUgPT09IDEpIGlmIChlLmNsYXNzTmFtZSkgew0KICAgICAgICAgICAgZm9yICh2YXIgaiA9ICIgIiArIGUuY2xhc3NOYW1lICsgIiAiLA0KaSA9IGUuY2xhc3NOYW1lLCBvID0gMCwgayA9IGIubGVuZ3RoOyBvIDwgazsgbysrKSBpZiAoai5pbmRleE9mKCIgIiArIGJbb10gKyAiICIpIDwgMCkgaSArPSAiICIgKyBiW29dOyBlLmNsYXNzTmFtZSA9IGMudHJpbShpKQ0KICAgICAgICB9IGVsc2UgZS5jbGFzc05hbWUgPSBhDQogICAgfSByZXR1cm4gdGhpcw0KfSwgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uIChhKSB7DQogICAgaWYgKGMuaXNGdW5jdGlvbihhKSkgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaykgeyB2YXIgbiA9IGModGhpcyk7IG4ucmVtb3ZlQ2xhc3MoYS5jYWxsKHRoaXMsIGssIG4uYXR0cigiY2xhc3MiKSkpIH0pOyBpZiAoYSAmJiB0eXBlb2YgYSA9PT0gInN0cmluZyIgfHwgYSA9PT0gdykgZm9yICh2YXIgYiA9IChhIHx8ICIiKS5zcGxpdChjYSksIGQgPSAwLCBmID0gdGhpcy5sZW5ndGg7IGQgPCBmOyBkKyspIHsNCiAgICAgICAgdmFyIGUgPSB0aGlzW2RdOyBpZiAoZS5ub2RlVHlwZSA9PT0gMSAmJiBlLmNsYXNzTmFtZSkgaWYgKGEpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGogPSAoIiAiICsgZS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UoQWEsICIgIiksIGkgPSAwLCBvID0gYi5sZW5ndGg7IGkgPCBvOyBpKyspIGogPSBqLnJlcGxhY2UoIiAiICsgYltpXSArICIgIiwNCiIgIik7IGUuY2xhc3NOYW1lID0gYy50cmltKGopDQogICAgICAgIH0gZWxzZSBlLmNsYXNzTmFtZSA9ICIiDQogICAgfSByZXR1cm4gdGhpcw0KfSwgdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgdmFyIGQgPSB0eXBlb2YgYSwgZiA9IHR5cGVvZiBiID09PSAiYm9vbGVhbiI7IGlmIChjLmlzRnVuY3Rpb24oYSkpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGUpIHsgdmFyIGogPSBjKHRoaXMpOyBqLnRvZ2dsZUNsYXNzKGEuY2FsbCh0aGlzLCBlLCBqLmF0dHIoImNsYXNzIiksIGIpLCBiKSB9KTsgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmIChkID09PSAic3RyaW5nIikgZm9yICh2YXIgZSwgaiA9IDAsIGkgPSBjKHRoaXMpLCBvID0gYiwgayA9IGEuc3BsaXQoY2EpOyBlID0ga1tqKytdOyApIHsgbyA9IGYgPyBvIDogIWkuaGFzQ2xhc3MoZSk7IGlbbyA/ICJhZGRDbGFzcyIgOiAicmVtb3ZlQ2xhc3MiXShlKSB9IGVsc2UgaWYgKGQgPT09ICJ1bmRlZmluZWQiIHx8IGQgPT09ICJib29sZWFuIikgew0KICAgICAgICAgICAgdGhpcy5jbGFzc05hbWUgJiYgYy5kYXRhKHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUpOyB0aGlzLmNsYXNzTmFtZSA9DQp0aGlzLmNsYXNzTmFtZSB8fCBhID09PSBmYWxzZSA/ICIiIDogYy5kYXRhKHRoaXMsICJfX2NsYXNzTmFtZV9fIikgfHwgIiINCiAgICAgICAgfSANCiAgICB9KQ0KfSwgaGFzQ2xhc3M6IGZ1bmN0aW9uIChhKSB7IGEgPSAiICIgKyBhICsgIiAiOyBmb3IgKHZhciBiID0gMCwgZCA9IHRoaXMubGVuZ3RoOyBiIDwgZDsgYisrKSBpZiAoKCIgIiArIHRoaXNbYl0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKEFhLCAiICIpLmluZGV4T2YoYSkgPiAtMSkgcmV0dXJuIHRydWU7IHJldHVybiBmYWxzZSB9LCB2YWw6IGZ1bmN0aW9uIChhKSB7DQogICAgaWYgKGEgPT09IHcpIHsNCiAgICAgICAgdmFyIGIgPSB0aGlzWzBdOyBpZiAoYikgew0KICAgICAgICAgICAgaWYgKGMubm9kZU5hbWUoYiwgIm9wdGlvbiIpKSByZXR1cm4gKGIuYXR0cmlidXRlcy52YWx1ZSB8fCB7fSkuc3BlY2lmaWVkID8gYi52YWx1ZSA6IGIudGV4dDsgaWYgKGMubm9kZU5hbWUoYiwgInNlbGVjdCIpKSB7DQogICAgICAgICAgICAgICAgdmFyIGQgPSBiLnNlbGVjdGVkSW5kZXgsIGYgPSBbXSwgZSA9IGIub3B0aW9uczsgYiA9IGIudHlwZSA9PT0gInNlbGVjdC1vbmUiOyBpZiAoZCA8IDApIHJldHVybiBudWxsOyB2YXIgaiA9IGIgPyBkIDogMDsgZm9yIChkID0gYiA/IGQgKyAxIDogZS5sZW5ndGg7IGogPCBkOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPQ0KZVtqXTsgaWYgKGkuc2VsZWN0ZWQpIHsgYSA9IGMoaSkudmFsKCk7IGlmIChiKSByZXR1cm4gYTsgZi5wdXNoKGEpIH0gDQogICAgICAgICAgICAgICAgfSByZXR1cm4gZg0KICAgICAgICAgICAgfSBpZiAoQmEudGVzdChiLnR5cGUpICYmICFjLnN1cHBvcnQuY2hlY2tPbikgcmV0dXJuIGIuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID09PSBudWxsID8gIm9uIiA6IGIudmFsdWU7IHJldHVybiAoYi52YWx1ZSB8fCAiIikucmVwbGFjZShaYSwgIiIpDQogICAgICAgIH0gcmV0dXJuIHcNCiAgICB9IHZhciBvID0gYy5pc0Z1bmN0aW9uKGEpOyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChrKSB7DQogICAgICAgIHZhciBuID0gYyh0aGlzKSwgciA9IGE7IGlmICh0aGlzLm5vZGVUeXBlID09PSAxKSB7DQogICAgICAgICAgICBpZiAobykgciA9IGEuY2FsbCh0aGlzLCBrLCBuLnZhbCgpKTsgaWYgKHR5cGVvZiByID09PSAibnVtYmVyIikgciArPSAiIjsgaWYgKGMuaXNBcnJheShyKSAmJiBCYS50ZXN0KHRoaXMudHlwZSkpIHRoaXMuY2hlY2tlZCA9IGMuaW5BcnJheShuLnZhbCgpLCByKSA+PSAwOyBlbHNlIGlmIChjLm5vZGVOYW1lKHRoaXMsICJzZWxlY3QiKSkgew0KICAgICAgICAgICAgICAgIHZhciB1ID0gYy5tYWtlQXJyYXkocik7IGMoIm9wdGlvbiIsIHRoaXMpLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0NCmMuaW5BcnJheShjKHRoaXMpLnZhbCgpLCB1KSA+PSAwDQogICAgICAgICAgICAgICAgfSk7IGlmICghdS5sZW5ndGgpIHRoaXMuc2VsZWN0ZWRJbmRleCA9IC0xDQogICAgICAgICAgICB9IGVsc2UgdGhpcy52YWx1ZSA9IHINCiAgICAgICAgfSANCiAgICB9KQ0KfSANCn0pOyBjLmV4dGVuZCh7IGF0dHJGbjogeyB2YWw6IHRydWUsIGNzczogdHJ1ZSwgaHRtbDogdHJ1ZSwgdGV4dDogdHJ1ZSwgZGF0YTogdHJ1ZSwgd2lkdGg6IHRydWUsIGhlaWdodDogdHJ1ZSwgb2Zmc2V0OiB0cnVlIH0sIGF0dHI6IGZ1bmN0aW9uIChhLCBiLCBkLCBmKSB7DQogICAgaWYgKCFhIHx8IGEubm9kZVR5cGUgPT09IDMgfHwgYS5ub2RlVHlwZSA9PT0gOCkgcmV0dXJuIHc7IGlmIChmICYmIGIgaW4gYy5hdHRyRm4pIHJldHVybiBjKGEpW2JdKGQpOyBmID0gYS5ub2RlVHlwZSAhPT0gMSB8fCAhYy5pc1hNTERvYyhhKTsgdmFyIGUgPSBkICE9PSB3OyBiID0gZiAmJiBjLnByb3BzW2JdIHx8IGI7IGlmIChhLm5vZGVUeXBlID09PSAxKSB7DQogICAgICAgIHZhciBqID0gJGEudGVzdChiKTsgaWYgKGIgaW4gYSAmJiBmICYmICFqKSB7DQogICAgICAgICAgICBpZiAoZSkgew0KICAgICAgICAgICAgICAgIGIgPT09ICJ0eXBlIiAmJiBhYi50ZXN0KGEubm9kZU5hbWUpICYmIGEucGFyZW50Tm9kZSAmJiBjLmVycm9yKCJ0eXBlIHByb3BlcnR5IGNhbid0IGJlIGNoYW5nZWQiKTsNCiAgICAgICAgICAgICAgICBhW2JdID0gZA0KICAgICAgICAgICAgfSBpZiAoYy5ub2RlTmFtZShhLCAiZm9ybSIpICYmIGEuZ2V0QXR0cmlidXRlTm9kZShiKSkgcmV0dXJuIGEuZ2V0QXR0cmlidXRlTm9kZShiKS5ub2RlVmFsdWU7IGlmIChiID09PSAidGFiSW5kZXgiKSByZXR1cm4gKGIgPSBhLmdldEF0dHJpYnV0ZU5vZGUoInRhYkluZGV4IikpICYmIGIuc3BlY2lmaWVkID8gYi52YWx1ZSA6IGJiLnRlc3QoYS5ub2RlTmFtZSkgfHwgY2IudGVzdChhLm5vZGVOYW1lKSAmJiBhLmhyZWYgPyAwIDogdzsgcmV0dXJuIGFbYl0NCiAgICAgICAgfSBpZiAoIWMuc3VwcG9ydC5zdHlsZSAmJiBmICYmIGIgPT09ICJzdHlsZSIpIHsgaWYgKGUpIGEuc3R5bGUuY3NzVGV4dCA9ICIiICsgZDsgcmV0dXJuIGEuc3R5bGUuY3NzVGV4dCB9IGUgJiYgYS5zZXRBdHRyaWJ1dGUoYiwgIiIgKyBkKTsgYSA9ICFjLnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgJiYgZiAmJiBqID8gYS5nZXRBdHRyaWJ1dGUoYiwgMikgOiBhLmdldEF0dHJpYnV0ZShiKTsgcmV0dXJuIGEgPT09IG51bGwgPyB3IDogYQ0KICAgIH0gcmV0dXJuIGMuc3R5bGUoYSwgYiwgZCkNCn0gDQp9KTsgdmFyIE8gPSAvXC4oLiopJC8sIGRiID0gZnVuY3Rpb24gKGEpIHsNCiAgICByZXR1cm4gYS5yZXBsYWNlKC9bXlx3XHNcLlx8YF0vZywNCmZ1bmN0aW9uIChiKSB7IHJldHVybiAiXFwiICsgYiB9KQ0KfTsgYy5ldmVudCA9IHsgYWRkOiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgew0KICAgIGlmICghKGEubm9kZVR5cGUgPT09IDMgfHwgYS5ub2RlVHlwZSA9PT0gOCkpIHsNCiAgICAgICAgaWYgKGEuc2V0SW50ZXJ2YWwgJiYgYSAhPT0gQSAmJiAhYS5mcmFtZUVsZW1lbnQpIGEgPSBBOyB2YXIgZSwgajsgaWYgKGQuaGFuZGxlcikgeyBlID0gZDsgZCA9IGUuaGFuZGxlciB9IGlmICghZC5ndWlkKSBkLmd1aWQgPSBjLmd1aWQrKzsgaWYgKGogPSBjLmRhdGEoYSkpIHsNCiAgICAgICAgICAgIHZhciBpID0gai5ldmVudHMgPSBqLmV2ZW50cyB8fCB7fSwgbyA9IGouaGFuZGxlOyBpZiAoIW8pIGouaGFuZGxlID0gbyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHR5cGVvZiBjICE9PSAidW5kZWZpbmVkIiAmJiAhYy5ldmVudC50cmlnZ2VyZWQgPyBjLmV2ZW50LmhhbmRsZS5hcHBseShvLmVsZW0sIGFyZ3VtZW50cykgOiB3IH07IG8uZWxlbSA9IGE7IGIgPSBiLnNwbGl0KCIgIik7IGZvciAodmFyIGssIG4gPSAwLCByOyBrID0gYltuKytdOyApIHsNCiAgICAgICAgICAgICAgICBqID0gZSA/IGMuZXh0ZW5kKHt9LCBlKSA6IHsgaGFuZGxlcjogZCwgZGF0YTogZiB9OyBpZiAoay5pbmRleE9mKCIuIikgPiAtMSkgew0KICAgICAgICAgICAgICAgICAgICByID0gay5zcGxpdCgiLiIpOw0KICAgICAgICAgICAgICAgICAgICBrID0gci5zaGlmdCgpOyBqLm5hbWVzcGFjZSA9IHIuc2xpY2UoMCkuc29ydCgpLmpvaW4oIi4iKQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7IHIgPSBbXTsgai5uYW1lc3BhY2UgPSAiIiB9IGoudHlwZSA9IGs7IGouZ3VpZCA9IGQuZ3VpZDsgdmFyIHUgPSBpW2tdLCB6ID0gYy5ldmVudC5zcGVjaWFsW2tdIHx8IHt9OyBpZiAoIXUpIHsgdSA9IGlba10gPSBbXTsgaWYgKCF6LnNldHVwIHx8IHouc2V0dXAuY2FsbChhLCBmLCByLCBvKSA9PT0gZmFsc2UpIGlmIChhLmFkZEV2ZW50TGlzdGVuZXIpIGEuYWRkRXZlbnRMaXN0ZW5lcihrLCBvLCBmYWxzZSk7IGVsc2UgYS5hdHRhY2hFdmVudCAmJiBhLmF0dGFjaEV2ZW50KCJvbiIgKyBrLCBvKSB9IGlmICh6LmFkZCkgeyB6LmFkZC5jYWxsKGEsIGopOyBpZiAoIWouaGFuZGxlci5ndWlkKSBqLmhhbmRsZXIuZ3VpZCA9IGQuZ3VpZCB9IHUucHVzaChqKTsgYy5ldmVudC5nbG9iYWxba10gPSB0cnVlDQogICAgICAgICAgICB9IGEgPSBudWxsDQogICAgICAgIH0gDQogICAgfSANCn0sIGdsb2JhbDoge30sIHJlbW92ZTogZnVuY3Rpb24gKGEsIGIsIGQsIGYpIHsNCiAgICBpZiAoIShhLm5vZGVUeXBlID09PSAzIHx8IGEubm9kZVR5cGUgPT09IDgpKSB7DQogICAgICAgIHZhciBlLCBqID0gMCwgaSwgbywgaywgbiwgciwgdSwgeiA9IGMuZGF0YShhKSwNCkMgPSB6ICYmIHouZXZlbnRzOyBpZiAoeiAmJiBDKSB7DQogICAgICAgICAgICBpZiAoYiAmJiBiLnR5cGUpIHsgZCA9IGIuaGFuZGxlcjsgYiA9IGIudHlwZSB9IGlmICghYiB8fCB0eXBlb2YgYiA9PT0gInN0cmluZyIgJiYgYi5jaGFyQXQoMCkgPT09ICIuIikgeyBiID0gYiB8fCAiIjsgZm9yIChlIGluIEMpIGMuZXZlbnQucmVtb3ZlKGEsIGUgKyBiKSB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZvciAoYiA9IGIuc3BsaXQoIiAiKTsgZSA9IGJbaisrXTsgKSB7DQogICAgICAgICAgICAgICAgICAgIG4gPSBlOyBpID0gZS5pbmRleE9mKCIuIikgPCAwOyBvID0gW107IGlmICghaSkgeyBvID0gZS5zcGxpdCgiLiIpOyBlID0gby5zaGlmdCgpOyBrID0gbmV3IFJlZ0V4cCgiKF58XFwuKSIgKyBjLm1hcChvLnNsaWNlKDApLnNvcnQoKSwgZGIpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSArICIoXFwufCQpIikgfSBpZiAociA9IENbZV0pIGlmIChkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBuID0gYy5ldmVudC5zcGVjaWFsW2VdIHx8IHt9OyBmb3IgKEIgPSBmIHx8IDA7IEIgPCByLmxlbmd0aDsgQisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdSA9IHJbQl07IGlmIChkLmd1aWQgPT09IHUuZ3VpZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSB8fCBrLnRlc3QodS5uYW1lc3BhY2UpKSB7IGYgPT0gbnVsbCAmJiByLnNwbGljZShCLS0sIDEpOyBuLnJlbW92ZSAmJiBuLnJlbW92ZS5jYWxsKGEsIHUpIH0gaWYgKGYgIT0NCm51bGwpIGJyZWFrDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSANCiAgICAgICAgICAgICAgICAgICAgICAgIH0gaWYgKHIubGVuZ3RoID09PSAwIHx8IGYgIT0gbnVsbCAmJiByLmxlbmd0aCA9PT0gMSkgeyBpZiAoIW4udGVhcmRvd24gfHwgbi50ZWFyZG93bi5jYWxsKGEsIG8pID09PSBmYWxzZSkgQ2EoYSwgZSwgei5oYW5kbGUpOyBkZWxldGUgQ1tlXSB9IA0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgZm9yICh2YXIgQiA9IDA7IEIgPCByLmxlbmd0aDsgQisrKSB7IHUgPSByW0JdOyBpZiAoaSB8fCBrLnRlc3QodS5uYW1lc3BhY2UpKSB7IGMuZXZlbnQucmVtb3ZlKGEsIG4sIHUuaGFuZGxlciwgQik7IHIuc3BsaWNlKEItLSwgMSkgfSB9IA0KICAgICAgICAgICAgICAgIH0gaWYgKGMuaXNFbXB0eU9iamVjdChDKSkgeyBpZiAoYiA9IHouaGFuZGxlKSBiLmVsZW0gPSBudWxsOyBkZWxldGUgei5ldmVudHM7IGRlbGV0ZSB6LmhhbmRsZTsgYy5pc0VtcHR5T2JqZWN0KHopICYmIGMucmVtb3ZlRGF0YShhKSB9IA0KICAgICAgICAgICAgfSANCiAgICAgICAgfSANCiAgICB9IA0KfSwgdHJpZ2dlcjogZnVuY3Rpb24gKGEsIGIsIGQsIGYpIHsNCiAgICB2YXIgZSA9IGEudHlwZSB8fCBhOyBpZiAoIWYpIHsNCiAgICAgICAgYSA9IHR5cGVvZiBhID09PSAib2JqZWN0IiA/IGFbR10gPyBhIDogYy5leHRlbmQoYy5FdmVudChlKSwgYSkgOiBjLkV2ZW50KGUpOyBpZiAoZS5pbmRleE9mKCIhIikgPj0gMCkgew0KICAgICAgICAgICAgYS50eXBlID0NCmUgPSBlLnNsaWNlKDAsIC0xKTsgYS5leGNsdXNpdmUgPSB0cnVlDQogICAgICAgIH0gaWYgKCFkKSB7IGEuc3RvcFByb3BhZ2F0aW9uKCk7IGMuZXZlbnQuZ2xvYmFsW2VdICYmIGMuZWFjaChjLmNhY2hlLCBmdW5jdGlvbiAoKSB7IHRoaXMuZXZlbnRzICYmIHRoaXMuZXZlbnRzW2VdICYmIGMuZXZlbnQudHJpZ2dlcihhLCBiLCB0aGlzLmhhbmRsZS5lbGVtKSB9KSB9IGlmICghZCB8fCBkLm5vZGVUeXBlID09PSAzIHx8IGQubm9kZVR5cGUgPT09IDgpIHJldHVybiB3OyBhLnJlc3VsdCA9IHc7IGEudGFyZ2V0ID0gZDsgYiA9IGMubWFrZUFycmF5KGIpOyBiLnVuc2hpZnQoYSkNCiAgICB9IGEuY3VycmVudFRhcmdldCA9IGQ7IChmID0gYy5kYXRhKGQsICJoYW5kbGUiKSkgJiYgZi5hcHBseShkLCBiKTsgZiA9IGQucGFyZW50Tm9kZSB8fCBkLm93bmVyRG9jdW1lbnQ7IHRyeSB7IGlmICghKGQgJiYgZC5ub2RlTmFtZSAmJiBjLm5vRGF0YVtkLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSkgaWYgKGRbIm9uIiArIGVdICYmIGRbIm9uIiArIGVdLmFwcGx5KGQsIGIpID09PSBmYWxzZSkgYS5yZXN1bHQgPSBmYWxzZSB9IGNhdGNoIChqKSB7IH0gaWYgKCFhLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgJiYNCmYpIGMuZXZlbnQudHJpZ2dlcihhLCBiLCBmLCB0cnVlKTsgZWxzZSBpZiAoIWEuaXNEZWZhdWx0UHJldmVudGVkKCkpIHsgZiA9IGEudGFyZ2V0OyB2YXIgaSwgbyA9IGMubm9kZU5hbWUoZiwgImEiKSAmJiBlID09PSAiY2xpY2siLCBrID0gYy5ldmVudC5zcGVjaWFsW2VdIHx8IHt9OyBpZiAoKCFrLl9kZWZhdWx0IHx8IGsuX2RlZmF1bHQuY2FsbChkLCBhKSA9PT0gZmFsc2UpICYmICFvICYmICEoZiAmJiBmLm5vZGVOYW1lICYmIGMubm9EYXRhW2Yubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0pKSB7IHRyeSB7IGlmIChmW2VdKSB7IGlmIChpID0gZlsib24iICsgZV0pIGZbIm9uIiArIGVdID0gbnVsbDsgYy5ldmVudC50cmlnZ2VyZWQgPSB0cnVlOyBmW2VdKCkgfSB9IGNhdGNoIChuKSB7IH0gaWYgKGkpIGZbIm9uIiArIGVdID0gaTsgYy5ldmVudC50cmlnZ2VyZWQgPSBmYWxzZSB9IH0gDQp9LCBoYW5kbGU6IGZ1bmN0aW9uIChhKSB7DQogICAgdmFyIGIsIGQsIGYsIGU7IGEgPSBhcmd1bWVudHNbMF0gPSBjLmV2ZW50LmZpeChhIHx8IEEuZXZlbnQpOyBhLmN1cnJlbnRUYXJnZXQgPSB0aGlzOyBiID0gYS50eXBlLmluZGV4T2YoIi4iKSA8IDAgJiYgIWEuZXhjbHVzaXZlOw0KICAgIGlmICghYikgeyBkID0gYS50eXBlLnNwbGl0KCIuIik7IGEudHlwZSA9IGQuc2hpZnQoKTsgZiA9IG5ldyBSZWdFeHAoIihefFxcLikiICsgZC5zbGljZSgwKS5zb3J0KCkuam9pbigiXFwuKD86LipcXC4pPyIpICsgIihcXC58JCkiKSB9IGUgPSBjLmRhdGEodGhpcywgImV2ZW50cyIpOyBkID0gZVthLnR5cGVdOyBpZiAoZSAmJiBkKSB7IGQgPSBkLnNsaWNlKDApOyBlID0gMDsgZm9yICh2YXIgaiA9IGQubGVuZ3RoOyBlIDwgajsgZSsrKSB7IHZhciBpID0gZFtlXTsgaWYgKGIgfHwgZi50ZXN0KGkubmFtZXNwYWNlKSkgeyBhLmhhbmRsZXIgPSBpLmhhbmRsZXI7IGEuZGF0YSA9IGkuZGF0YTsgYS5oYW5kbGVPYmogPSBpOyBpID0gaS5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IGlmIChpICE9PSB3KSB7IGEucmVzdWx0ID0gaTsgaWYgKGkgPT09IGZhbHNlKSB7IGEucHJldmVudERlZmF1bHQoKTsgYS5zdG9wUHJvcGFnYXRpb24oKSB9IH0gaWYgKGEuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkgYnJlYWsgfSB9IH0gcmV0dXJuIGEucmVzdWx0DQp9LCBwcm9wczogImFsdEtleSBhdHRyQ2hhbmdlIGF0dHJOYW1lIGJ1YmJsZXMgYnV0dG9uIGNhbmNlbGFibGUgY2hhckNvZGUgY2xpZW50WCBjbGllbnRZIGN0cmxLZXkgY3VycmVudFRhcmdldCBkYXRhIGRldGFpbCBldmVudFBoYXNlIGZyb21FbGVtZW50IGhhbmRsZXIga2V5Q29kZSBsYXllclggbGF5ZXJZIG1ldGFLZXkgbmV3VmFsdWUgb2Zmc2V0WCBvZmZzZXRZIG9yaWdpbmFsVGFyZ2V0IHBhZ2VYIHBhZ2VZIHByZXZWYWx1ZSByZWxhdGVkTm9kZSByZWxhdGVkVGFyZ2V0IHNjcmVlblggc2NyZWVuWSBzaGlmdEtleSBzcmNFbGVtZW50IHRhcmdldCB0b0VsZW1lbnQgdmlldyB3aGVlbERlbHRhIHdoaWNoIi5zcGxpdCgiICIpLA0KICAgIGZpeDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgaWYgKGFbR10pIHJldHVybiBhOyB2YXIgYiA9IGE7IGEgPSBjLkV2ZW50KGIpOyBmb3IgKHZhciBkID0gdGhpcy5wcm9wcy5sZW5ndGgsIGY7IGQ7ICkgeyBmID0gdGhpcy5wcm9wc1stLWRdOyBhW2ZdID0gYltmXSB9IGlmICghYS50YXJnZXQpIGEudGFyZ2V0ID0gYS5zcmNFbGVtZW50IHx8IHM7IGlmIChhLnRhcmdldC5ub2RlVHlwZSA9PT0gMykgYS50YXJnZXQgPSBhLnRhcmdldC5wYXJlbnROb2RlOyBpZiAoIWEucmVsYXRlZFRhcmdldCAmJiBhLmZyb21FbGVtZW50KSBhLnJlbGF0ZWRUYXJnZXQgPSBhLmZyb21FbGVtZW50ID09PSBhLnRhcmdldCA/IGEudG9FbGVtZW50IDogYS5mcm9tRWxlbWVudDsgaWYgKGEucGFnZVggPT0gbnVsbCAmJiBhLmNsaWVudFggIT0gbnVsbCkgew0KICAgICAgICAgICAgYiA9IHMuZG9jdW1lbnRFbGVtZW50OyBkID0gcy5ib2R5OyBhLnBhZ2VYID0gYS5jbGllbnRYICsgKGIgJiYgYi5zY3JvbGxMZWZ0IHx8IGQgJiYgZC5zY3JvbGxMZWZ0IHx8IDApIC0gKGIgJiYgYi5jbGllbnRMZWZ0IHx8IGQgJiYgZC5jbGllbnRMZWZ0IHx8IDApOyBhLnBhZ2VZID0gYS5jbGllbnRZICsgKGIgJiYgYi5zY3JvbGxUb3AgfHwNCmQgJiYgZC5zY3JvbGxUb3AgfHwgMCkgLSAoYiAmJiBiLmNsaWVudFRvcCB8fCBkICYmIGQuY2xpZW50VG9wIHx8IDApDQogICAgICAgIH0gaWYgKCFhLndoaWNoICYmIChhLmNoYXJDb2RlIHx8IGEuY2hhckNvZGUgPT09IDAgPyBhLmNoYXJDb2RlIDogYS5rZXlDb2RlKSkgYS53aGljaCA9IGEuY2hhckNvZGUgfHwgYS5rZXlDb2RlOyBpZiAoIWEubWV0YUtleSAmJiBhLmN0cmxLZXkpIGEubWV0YUtleSA9IGEuY3RybEtleTsgaWYgKCFhLndoaWNoICYmIGEuYnV0dG9uICE9PSB3KSBhLndoaWNoID0gYS5idXR0b24gJiAxID8gMSA6IGEuYnV0dG9uICYgMiA/IDMgOiBhLmJ1dHRvbiAmIDQgPyAyIDogMDsgcmV0dXJuIGENCiAgICB9LCBndWlkOiAxRTgsIHByb3h5OiBjLnByb3h5LCBzcGVjaWFsOiB7IHJlYWR5OiB7IHNldHVwOiBjLmJpbmRSZWFkeSwgdGVhcmRvd246IGMubm9vcCB9LCBsaXZlOiB7IGFkZDogZnVuY3Rpb24gKGEpIHsgYy5ldmVudC5hZGQodGhpcywgYS5vcmlnVHlwZSwgYy5leHRlbmQoe30sIGEsIHsgaGFuZGxlcjogb2EgfSkpIH0sIHJlbW92ZTogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGIgPSB0cnVlLCBkID0gYS5vcmlnVHlwZS5yZXBsYWNlKE8sICIiKTsgYy5lYWNoKGMuZGF0YSh0aGlzLA0KImV2ZW50cyIpLmxpdmUgfHwgW10sIGZ1bmN0aW9uICgpIHsgaWYgKGQgPT09IHRoaXMub3JpZ1R5cGUucmVwbGFjZShPLCAiIikpIHJldHVybiBiID0gZmFsc2UgfSk7IGIgJiYgYy5ldmVudC5yZW1vdmUodGhpcywgYS5vcmlnVHlwZSwgb2EpDQogICAgfSANCiAgICB9LCBiZWZvcmV1bmxvYWQ6IHsgc2V0dXA6IGZ1bmN0aW9uIChhLCBiLCBkKSB7IGlmICh0aGlzLnNldEludGVydmFsKSB0aGlzLm9uYmVmb3JldW5sb2FkID0gZDsgcmV0dXJuIGZhbHNlIH0sIHRlYXJkb3duOiBmdW5jdGlvbiAoYSwgYikgeyBpZiAodGhpcy5vbmJlZm9yZXVubG9hZCA9PT0gYikgdGhpcy5vbmJlZm9yZXVubG9hZCA9IG51bGwgfSB9DQogICAgfQ0KfTsgdmFyIENhID0gcy5yZW1vdmVFdmVudExpc3RlbmVyID8gZnVuY3Rpb24gKGEsIGIsIGQpIHsgYS5yZW1vdmVFdmVudExpc3RlbmVyKGIsIGQsIGZhbHNlKSB9IDogZnVuY3Rpb24gKGEsIGIsIGQpIHsgYS5kZXRhY2hFdmVudCgib24iICsgYiwgZCkgfTsgYy5FdmVudCA9IGZ1bmN0aW9uIChhKSB7DQogICAgaWYgKCF0aGlzLnByZXZlbnREZWZhdWx0KSByZXR1cm4gbmV3IGMuRXZlbnQoYSk7IGlmIChhICYmIGEudHlwZSkgew0KICAgICAgICB0aGlzLm9yaWdpbmFsRXZlbnQgPQ0KYTsgdGhpcy50eXBlID0gYS50eXBlDQogICAgfSBlbHNlIHRoaXMudHlwZSA9IGE7IHRoaXMudGltZVN0YW1wID0gSigpOyB0aGlzW0ddID0gdHJ1ZQ0KfTsgYy5FdmVudC5wcm90b3R5cGUgPSB7IHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiAoKSB7IHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gWjsgdmFyIGEgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7IGlmIChhKSB7IGEucHJldmVudERlZmF1bHQgJiYgYS5wcmV2ZW50RGVmYXVsdCgpOyBhLnJldHVyblZhbHVlID0gZmFsc2UgfSB9LCBzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uICgpIHsgdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IFo7IHZhciBhID0gdGhpcy5vcmlnaW5hbEV2ZW50OyBpZiAoYSkgeyBhLnN0b3BQcm9wYWdhdGlvbiAmJiBhLnN0b3BQcm9wYWdhdGlvbigpOyBhLmNhbmNlbEJ1YmJsZSA9IHRydWUgfSB9LCBzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246IGZ1bmN0aW9uICgpIHsgdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IFo7IHRoaXMuc3RvcFByb3BhZ2F0aW9uKCkgfSwgaXNEZWZhdWx0UHJldmVudGVkOiBZLCBpc1Byb3BhZ2F0aW9uU3RvcHBlZDogWSwNCiAgICBpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDogWQ0KfTsgdmFyIERhID0gZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSBhLnJlbGF0ZWRUYXJnZXQ7IHRyeSB7IGZvciAoOyBiICYmIGIgIT09IHRoaXM7ICkgYiA9IGIucGFyZW50Tm9kZTsgaWYgKGIgIT09IHRoaXMpIHsgYS50eXBlID0gYS5kYXRhOyBjLmV2ZW50LmhhbmRsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gfSBjYXRjaCAoZCkgeyB9IH0sIEVhID0gZnVuY3Rpb24gKGEpIHsgYS50eXBlID0gYS5kYXRhOyBjLmV2ZW50LmhhbmRsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH07IGMuZWFjaCh7IG1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLCBtb3VzZWxlYXZlOiAibW91c2VvdXQiIH0sIGZ1bmN0aW9uIChhLCBiKSB7IGMuZXZlbnQuc3BlY2lhbFthXSA9IHsgc2V0dXA6IGZ1bmN0aW9uIChkKSB7IGMuZXZlbnQuYWRkKHRoaXMsIGIsIGQgJiYgZC5zZWxlY3RvciA/IEVhIDogRGEsIGEpIH0sIHRlYXJkb3duOiBmdW5jdGlvbiAoZCkgeyBjLmV2ZW50LnJlbW92ZSh0aGlzLCBiLCBkICYmIGQuc2VsZWN0b3IgPyBFYSA6IERhKSB9IH0gfSk7IGlmICghYy5zdXBwb3J0LnN1Ym1pdEJ1YmJsZXMpIGMuZXZlbnQuc3BlY2lhbC5zdWJtaXQgPQ0KeyBzZXR1cDogZnVuY3Rpb24gKCkgeyBpZiAodGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAiZm9ybSIpIHsgYy5ldmVudC5hZGQodGhpcywgImNsaWNrLnNwZWNpYWxTdWJtaXQiLCBmdW5jdGlvbiAoYSkgeyB2YXIgYiA9IGEudGFyZ2V0LCBkID0gYi50eXBlOyBpZiAoKGQgPT09ICJzdWJtaXQiIHx8IGQgPT09ICJpbWFnZSIpICYmIGMoYikuY2xvc2VzdCgiZm9ybSIpLmxlbmd0aCkgcmV0dXJuIG5hKCJzdWJtaXQiLCB0aGlzLCBhcmd1bWVudHMpIH0pOyBjLmV2ZW50LmFkZCh0aGlzLCAia2V5cHJlc3Muc3BlY2lhbFN1Ym1pdCIsIGZ1bmN0aW9uIChhKSB7IHZhciBiID0gYS50YXJnZXQsIGQgPSBiLnR5cGU7IGlmICgoZCA9PT0gInRleHQiIHx8IGQgPT09ICJwYXNzd29yZCIpICYmIGMoYikuY2xvc2VzdCgiZm9ybSIpLmxlbmd0aCAmJiBhLmtleUNvZGUgPT09IDEzKSByZXR1cm4gbmEoInN1Ym1pdCIsIHRoaXMsIGFyZ3VtZW50cykgfSkgfSBlbHNlIHJldHVybiBmYWxzZSB9LCB0ZWFyZG93bjogZnVuY3Rpb24gKCkgeyBjLmV2ZW50LnJlbW92ZSh0aGlzLCAiLnNwZWNpYWxTdWJtaXQiKSB9IH07DQogICAgaWYgKCFjLnN1cHBvcnQuY2hhbmdlQnViYmxlcykgew0KICAgICAgICB2YXIgZGEgPSAvdGV4dGFyZWF8aW5wdXR8c2VsZWN0L2ksIGVhLCBGYSA9IGZ1bmN0aW9uIChhKSB7IHZhciBiID0gYS50eXBlLCBkID0gYS52YWx1ZTsgaWYgKGIgPT09ICJyYWRpbyIgfHwgYiA9PT0gImNoZWNrYm94IikgZCA9IGEuY2hlY2tlZDsgZWxzZSBpZiAoYiA9PT0gInNlbGVjdC1tdWx0aXBsZSIpIGQgPSBhLnNlbGVjdGVkSW5kZXggPiAtMSA/IGMubWFwKGEub3B0aW9ucywgZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGYuc2VsZWN0ZWQgfSkuam9pbigiLSIpIDogIiI7IGVsc2UgaWYgKGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gInNlbGVjdCIpIGQgPSBhLnNlbGVjdGVkSW5kZXg7IHJldHVybiBkIH0sIGZhID0gZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgICAgIHZhciBkID0gYS50YXJnZXQsIGYsIGU7IGlmICghKCFkYS50ZXN0KGQubm9kZU5hbWUpIHx8IGQucmVhZE9ubHkpKSB7DQogICAgICAgICAgICAgICAgZiA9IGMuZGF0YShkLCAiX2NoYW5nZV9kYXRhIik7IGUgPSBGYShkKTsgaWYgKGEudHlwZSAhPT0gImZvY3Vzb3V0IiB8fCBkLnR5cGUgIT09ICJyYWRpbyIpIGMuZGF0YShkLCAiX2NoYW5nZV9kYXRhIiwNCmUpOyBpZiAoIShmID09PSB3IHx8IGUgPT09IGYpKSBpZiAoZiAhPSBudWxsIHx8IGUpIHsgYS50eXBlID0gImNoYW5nZSI7IHJldHVybiBjLmV2ZW50LnRyaWdnZXIoYSwgYiwgZCkgfSANCiAgICAgICAgICAgIH0gDQogICAgICAgIH07IGMuZXZlbnQuc3BlY2lhbC5jaGFuZ2UgPSB7IGZpbHRlcnM6IHsgZm9jdXNvdXQ6IGZhLCBjbGljazogZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSBhLnRhcmdldCwgZCA9IGIudHlwZTsgaWYgKGQgPT09ICJyYWRpbyIgfHwgZCA9PT0gImNoZWNrYm94IiB8fCBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJzZWxlY3QiKSByZXR1cm4gZmEuY2FsbCh0aGlzLCBhKSB9LCBrZXlkb3duOiBmdW5jdGlvbiAoYSkgeyB2YXIgYiA9IGEudGFyZ2V0LCBkID0gYi50eXBlOyBpZiAoYS5rZXlDb2RlID09PSAxMyAmJiBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJ0ZXh0YXJlYSIgfHwgYS5rZXlDb2RlID09PSAzMiAmJiAoZCA9PT0gImNoZWNrYm94IiB8fCBkID09PSAicmFkaW8iKSB8fCBkID09PSAic2VsZWN0LW11bHRpcGxlIikgcmV0dXJuIGZhLmNhbGwodGhpcywgYSkgfSwgYmVmb3JlYWN0aXZhdGU6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICBhID0gYS50YXJnZXQ7IGMuZGF0YShhLA0KIl9jaGFuZ2VfZGF0YSIsIEZhKGEpKQ0KICAgICAgICB9IA0KICAgICAgICB9LCBzZXR1cDogZnVuY3Rpb24gKCkgeyBpZiAodGhpcy50eXBlID09PSAiZmlsZSIpIHJldHVybiBmYWxzZTsgZm9yICh2YXIgYSBpbiBlYSkgYy5ldmVudC5hZGQodGhpcywgYSArICIuc3BlY2lhbENoYW5nZSIsIGVhW2FdKTsgcmV0dXJuIGRhLnRlc3QodGhpcy5ub2RlTmFtZSkgfSwgdGVhcmRvd246IGZ1bmN0aW9uICgpIHsgYy5ldmVudC5yZW1vdmUodGhpcywgIi5zcGVjaWFsQ2hhbmdlIik7IHJldHVybiBkYS50ZXN0KHRoaXMubm9kZU5hbWUpIH0gDQogICAgICAgIH07IGVhID0gYy5ldmVudC5zcGVjaWFsLmNoYW5nZS5maWx0ZXJzDQogICAgfSBzLmFkZEV2ZW50TGlzdGVuZXIgJiYgYy5lYWNoKHsgZm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0IiB9LCBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICBmdW5jdGlvbiBkKGYpIHsgZiA9IGMuZXZlbnQuZml4KGYpOyBmLnR5cGUgPSBiOyByZXR1cm4gYy5ldmVudC5oYW5kbGUuY2FsbCh0aGlzLCBmKSB9IGMuZXZlbnQuc3BlY2lhbFtiXSA9IHsgc2V0dXA6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihhLA0KZCwgdHJ1ZSkNCiAgICAgICAgfSwgdGVhcmRvd246IGZ1bmN0aW9uICgpIHsgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKGEsIGQsIHRydWUpIH0gDQogICAgICAgIH0NCiAgICB9KTsgYy5lYWNoKFsiYmluZCIsICJvbmUiXSwgZnVuY3Rpb24gKGEsIGIpIHsgYy5mbltiXSA9IGZ1bmN0aW9uIChkLCBmLCBlKSB7IGlmICh0eXBlb2YgZCA9PT0gIm9iamVjdCIpIHsgZm9yICh2YXIgaiBpbiBkKSB0aGlzW2JdKGosIGYsIGRbal0sIGUpOyByZXR1cm4gdGhpcyB9IGlmIChjLmlzRnVuY3Rpb24oZikpIHsgZSA9IGY7IGYgPSB3IH0gdmFyIGkgPSBiID09PSAib25lIiA/IGMucHJveHkoZSwgZnVuY3Rpb24gKGspIHsgYyh0aGlzKS51bmJpbmQoaywgaSk7IHJldHVybiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfSkgOiBlOyBpZiAoZCA9PT0gInVubG9hZCIgJiYgYiAhPT0gIm9uZSIpIHRoaXMub25lKGQsIGYsIGUpOyBlbHNlIHsgaiA9IDA7IGZvciAodmFyIG8gPSB0aGlzLmxlbmd0aDsgaiA8IG87IGorKykgYy5ldmVudC5hZGQodGhpc1tqXSwgZCwgaSwgZikgfSByZXR1cm4gdGhpcyB9IH0pOyBjLmZuLmV4dGVuZCh7IHVuYmluZDogZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgaWYgKHR5cGVvZiBhID09PSAib2JqZWN0IiAmJg0KIWEucHJldmVudERlZmF1bHQpIGZvciAodmFyIGQgaW4gYSkgdGhpcy51bmJpbmQoZCwgYVtkXSk7IGVsc2UgeyBkID0gMDsgZm9yICh2YXIgZiA9IHRoaXMubGVuZ3RoOyBkIDwgZjsgZCsrKSBjLmV2ZW50LnJlbW92ZSh0aGlzW2RdLCBhLCBiKSB9IHJldHVybiB0aGlzDQogICAgfSwgZGVsZWdhdGU6IGZ1bmN0aW9uIChhLCBiLCBkLCBmKSB7IHJldHVybiB0aGlzLmxpdmUoYiwgZCwgZiwgYSkgfSwgdW5kZWxlZ2F0ZTogZnVuY3Rpb24gKGEsIGIsIGQpIHsgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDAgPyB0aGlzLnVuYmluZCgibGl2ZSIpIDogdGhpcy5kaWUoYiwgbnVsbCwgZCwgYSkgfSwgdHJpZ2dlcjogZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7IGMuZXZlbnQudHJpZ2dlcihhLCBiLCB0aGlzKSB9KSB9LCB0cmlnZ2VySGFuZGxlcjogZnVuY3Rpb24gKGEsIGIpIHsgaWYgKHRoaXNbMF0pIHsgYSA9IGMuRXZlbnQoYSk7IGEucHJldmVudERlZmF1bHQoKTsgYS5zdG9wUHJvcGFnYXRpb24oKTsgYy5ldmVudC50cmlnZ2VyKGEsIGIsIHRoaXNbMF0pOyByZXR1cm4gYS5yZXN1bHQgfSB9LA0KICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uIChhKSB7IGZvciAodmFyIGIgPSBhcmd1bWVudHMsIGQgPSAxOyBkIDwgYi5sZW5ndGg7ICkgYy5wcm94eShhLCBiW2QrK10pOyByZXR1cm4gdGhpcy5jbGljayhjLnByb3h5KGEsIGZ1bmN0aW9uIChmKSB7IHZhciBlID0gKGMuZGF0YSh0aGlzLCAibGFzdFRvZ2dsZSIgKyBhLmd1aWQpIHx8IDApICUgZDsgYy5kYXRhKHRoaXMsICJsYXN0VG9nZ2xlIiArIGEuZ3VpZCwgZSArIDEpOyBmLnByZXZlbnREZWZhdWx0KCk7IHJldHVybiBiW2VdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgZmFsc2UgfSkpIH0sIGhvdmVyOiBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gdGhpcy5tb3VzZWVudGVyKGEpLm1vdXNlbGVhdmUoYiB8fCBhKSB9IA0KICAgIH0pOyB2YXIgR2EgPSB7IGZvY3VzOiAiZm9jdXNpbiIsIGJsdXI6ICJmb2N1c291dCIsIG1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLCBtb3VzZWxlYXZlOiAibW91c2VvdXQiIH07IGMuZWFjaChbImxpdmUiLCAiZGllIl0sIGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICAgIGMuZm5bYl0gPSBmdW5jdGlvbiAoZCwgZiwgZSwgaikgew0KICAgICAgICAgICAgdmFyIGksIG8gPSAwLCBrLCBuLCByID0gaiB8fCB0aGlzLnNlbGVjdG9yLA0KdSA9IGogPyB0aGlzIDogYyh0aGlzLmNvbnRleHQpOyBpZiAoYy5pc0Z1bmN0aW9uKGYpKSB7IGUgPSBmOyBmID0gdyB9IGZvciAoZCA9IChkIHx8ICIiKS5zcGxpdCgiICIpOyAoaSA9IGRbbysrXSkgIT0gbnVsbDsgKSB7IGogPSBPLmV4ZWMoaSk7IGsgPSAiIjsgaWYgKGopIHsgayA9IGpbMF07IGkgPSBpLnJlcGxhY2UoTywgIiIpIH0gaWYgKGkgPT09ICJob3ZlciIpIGQucHVzaCgibW91c2VlbnRlciIgKyBrLCAibW91c2VsZWF2ZSIgKyBrKTsgZWxzZSB7IG4gPSBpOyBpZiAoaSA9PT0gImZvY3VzIiB8fCBpID09PSAiYmx1ciIpIHsgZC5wdXNoKEdhW2ldICsgayk7IGkgKz0gayB9IGVsc2UgaSA9IChHYVtpXSB8fCBpKSArIGs7IGIgPT09ICJsaXZlIiA/IHUuZWFjaChmdW5jdGlvbiAoKSB7IGMuZXZlbnQuYWRkKHRoaXMsIHBhKGksIHIpLCB7IGRhdGE6IGYsIHNlbGVjdG9yOiByLCBoYW5kbGVyOiBlLCBvcmlnVHlwZTogaSwgb3JpZ0hhbmRsZXI6IGUsIHByZVR5cGU6IG4gfSkgfSkgOiB1LnVuYmluZChwYShpLCByKSwgZSkgfSB9IHJldHVybiB0aGlzDQogICAgICAgIH0gDQogICAgfSk7IGMuZWFjaCgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciIuc3BsaXQoIiAiKSwNCmZ1bmN0aW9uIChhLCBiKSB7IGMuZm5bYl0gPSBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZCA/IHRoaXMuYmluZChiLCBkKSA6IHRoaXMudHJpZ2dlcihiKSB9OyBpZiAoYy5hdHRyRm4pIGMuYXR0ckZuW2JdID0gdHJ1ZSB9KTsgQS5hdHRhY2hFdmVudCAmJiAhQS5hZGRFdmVudExpc3RlbmVyICYmIEEuYXR0YWNoRXZlbnQoIm9udW5sb2FkIiwgZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBhIGluIGMuY2FjaGUpIGlmIChjLmNhY2hlW2FdLmhhbmRsZSkgdHJ5IHsgYy5ldmVudC5yZW1vdmUoYy5jYWNoZVthXS5oYW5kbGUuZWxlbSkgfSBjYXRjaCAoYikgeyB9IH0pOyAoZnVuY3Rpb24gKCkgew0KICAgIGZ1bmN0aW9uIGEoZykgeyBmb3IgKHZhciBoID0gIiIsIGwsIG0gPSAwOyBnW21dOyBtKyspIHsgbCA9IGdbbV07IGlmIChsLm5vZGVUeXBlID09PSAzIHx8IGwubm9kZVR5cGUgPT09IDQpIGggKz0gbC5ub2RlVmFsdWU7IGVsc2UgaWYgKGwubm9kZVR5cGUgIT09IDgpIGggKz0gYShsLmNoaWxkTm9kZXMpIH0gcmV0dXJuIGggfSBmdW5jdGlvbiBiKGcsIGgsIGwsIG0sIHEsIHApIHsNCiAgICAgICAgcSA9IDA7IGZvciAodmFyIHYgPSBtLmxlbmd0aDsgcSA8IHY7IHErKykgew0KICAgICAgICAgICAgdmFyIHQgPSBtW3FdOw0KICAgICAgICAgICAgaWYgKHQpIHsgdCA9IHRbZ107IGZvciAodmFyIHkgPSBmYWxzZTsgdDsgKSB7IGlmICh0LnNpemNhY2hlID09PSBsKSB7IHkgPSBtW3Quc2l6c2V0XTsgYnJlYWsgfSBpZiAodC5ub2RlVHlwZSA9PT0gMSAmJiAhcCkgeyB0LnNpemNhY2hlID0gbDsgdC5zaXpzZXQgPSBxIH0gaWYgKHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gaCkgeyB5ID0gdDsgYnJlYWsgfSB0ID0gdFtnXSB9IG1bcV0gPSB5IH0gDQogICAgICAgIH0gDQogICAgfSBmdW5jdGlvbiBkKGcsIGgsIGwsIG0sIHEsIHApIHsgcSA9IDA7IGZvciAodmFyIHYgPSBtLmxlbmd0aDsgcSA8IHY7IHErKykgeyB2YXIgdCA9IG1bcV07IGlmICh0KSB7IHQgPSB0W2ddOyBmb3IgKHZhciB5ID0gZmFsc2U7IHQ7ICkgeyBpZiAodC5zaXpjYWNoZSA9PT0gbCkgeyB5ID0gbVt0LnNpenNldF07IGJyZWFrIH0gaWYgKHQubm9kZVR5cGUgPT09IDEpIHsgaWYgKCFwKSB7IHQuc2l6Y2FjaGUgPSBsOyB0LnNpenNldCA9IHEgfSBpZiAodHlwZW9mIGggIT09ICJzdHJpbmciKSB7IGlmICh0ID09PSBoKSB7IHkgPSB0cnVlOyBicmVhayB9IH0gZWxzZSBpZiAoay5maWx0ZXIoaCwgW3RdKS5sZW5ndGggPiAwKSB7IHkgPSB0OyBicmVhayB9IH0gdCA9IHRbZ10gfSBtW3FdID0geSB9IH0gfSB2YXIgZiA9IC8oKD86XCgoPzpcKFteKCldK1wpfFteKCldKykrXCl8XFsoPzpcW1teW1xdXSpcXXxbJyJdW14nIl0qWyciXXxbXltcXSciXSspK1xdfFxcLnxbXiA+K34sKFxbXFxdKykrfFs+K35dKShccyosXHMqKT8oKD86LnxccnxcbikqKS9nLA0KZSA9IDAsIGogPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLCBpID0gZmFsc2UsIG8gPSB0cnVlOyBbMCwgMF0uc29ydChmdW5jdGlvbiAoKSB7IG8gPSBmYWxzZTsgcmV0dXJuIDAgfSk7IHZhciBrID0gZnVuY3Rpb24gKGcsIGgsIGwsIG0pIHsNCiAgICBsID0gbCB8fCBbXTsgdmFyIHEgPSBoID0gaCB8fCBzOyBpZiAoaC5ub2RlVHlwZSAhPT0gMSAmJiBoLm5vZGVUeXBlICE9PSA5KSByZXR1cm4gW107IGlmICghZyB8fCB0eXBlb2YgZyAhPT0gInN0cmluZyIpIHJldHVybiBsOyBmb3IgKHZhciBwID0gW10sIHYsIHQsIHksIFMsIEggPSB0cnVlLCBNID0geChoKSwgSSA9IGc7IChmLmV4ZWMoIiIpLCB2ID0gZi5leGVjKEkpKSAhPT0gbnVsbDsgKSB7IEkgPSB2WzNdOyBwLnB1c2godlsxXSk7IGlmICh2WzJdKSB7IFMgPSB2WzNdOyBicmVhayB9IH0gaWYgKHAubGVuZ3RoID4gMSAmJiByLmV4ZWMoZykpIGlmIChwLmxlbmd0aCA9PT0gMiAmJiBuLnJlbGF0aXZlW3BbMF1dKSB0ID0gZ2EocFswXSArIHBbMV0sIGgpOyBlbHNlIGZvciAodCA9IG4ucmVsYXRpdmVbcFswXV0gPyBbaF0gOiBrKHAuc2hpZnQoKSwgaCk7IHAubGVuZ3RoOyApIHsNCiAgICAgICAgZyA9IHAuc2hpZnQoKTsgaWYgKG4ucmVsYXRpdmVbZ10pIGcgKz0gcC5zaGlmdCgpOw0KICAgICAgICB0ID0gZ2EoZywgdCkNCiAgICB9IGVsc2UgeyBpZiAoIW0gJiYgcC5sZW5ndGggPiAxICYmIGgubm9kZVR5cGUgPT09IDkgJiYgIU0gJiYgbi5tYXRjaC5JRC50ZXN0KHBbMF0pICYmICFuLm1hdGNoLklELnRlc3QocFtwLmxlbmd0aCAtIDFdKSkgeyB2ID0gay5maW5kKHAuc2hpZnQoKSwgaCwgTSk7IGggPSB2LmV4cHIgPyBrLmZpbHRlcih2LmV4cHIsIHYuc2V0KVswXSA6IHYuc2V0WzBdIH0gaWYgKGgpIHsgdiA9IG0gPyB7IGV4cHI6IHAucG9wKCksIHNldDogeihtKX0gOiBrLmZpbmQocC5wb3AoKSwgcC5sZW5ndGggPT09IDEgJiYgKHBbMF0gPT09ICJ+IiB8fCBwWzBdID09PSAiKyIpICYmIGgucGFyZW50Tm9kZSA/IGgucGFyZW50Tm9kZSA6IGgsIE0pOyB0ID0gdi5leHByID8gay5maWx0ZXIodi5leHByLCB2LnNldCkgOiB2LnNldDsgaWYgKHAubGVuZ3RoID4gMCkgeSA9IHoodCk7IGVsc2UgSCA9IGZhbHNlOyBmb3IgKDsgcC5sZW5ndGg7ICkgeyB2YXIgRCA9IHAucG9wKCk7IHYgPSBEOyBpZiAobi5yZWxhdGl2ZVtEXSkgdiA9IHAucG9wKCk7IGVsc2UgRCA9ICIiOyBpZiAodiA9PSBudWxsKSB2ID0gaDsgbi5yZWxhdGl2ZVtEXSh5LCB2LCBNKSB9IH0gZWxzZSB5ID0gW10gfSB5IHx8ICh5ID0gdCk7IHkgfHwgay5lcnJvcihEIHx8DQpnKTsgaWYgKGouY2FsbCh5KSA9PT0gIltvYmplY3QgQXJyYXldIikgaWYgKEgpIGlmIChoICYmIGgubm9kZVR5cGUgPT09IDEpIGZvciAoZyA9IDA7IHlbZ10gIT0gbnVsbDsgZysrKSB7IGlmICh5W2ddICYmICh5W2ddID09PSB0cnVlIHx8IHlbZ10ubm9kZVR5cGUgPT09IDEgJiYgRShoLCB5W2ddKSkpIGwucHVzaCh0W2ddKSB9IGVsc2UgZm9yIChnID0gMDsgeVtnXSAhPSBudWxsOyBnKyspIHlbZ10gJiYgeVtnXS5ub2RlVHlwZSA9PT0gMSAmJiBsLnB1c2godFtnXSk7IGVsc2UgbC5wdXNoLmFwcGx5KGwsIHkpOyBlbHNlIHooeSwgbCk7IGlmIChTKSB7IGsoUywgcSwgbCwgbSk7IGsudW5pcXVlU29ydChsKSB9IHJldHVybiBsDQp9OyBrLnVuaXF1ZVNvcnQgPSBmdW5jdGlvbiAoZykgeyBpZiAoQikgeyBpID0gbzsgZy5zb3J0KEIpOyBpZiAoaSkgZm9yICh2YXIgaCA9IDE7IGggPCBnLmxlbmd0aDsgaCsrKSBnW2hdID09PSBnW2ggLSAxXSAmJiBnLnNwbGljZShoLS0sIDEpIH0gcmV0dXJuIGcgfTsgay5tYXRjaGVzID0gZnVuY3Rpb24gKGcsIGgpIHsgcmV0dXJuIGsoZywgbnVsbCwgbnVsbCwgaCkgfTsgay5maW5kID0gZnVuY3Rpb24gKGcsIGgsIGwpIHsNCiAgICB2YXIgbSwgcTsgaWYgKCFnKSByZXR1cm4gW107DQogICAgZm9yICh2YXIgcCA9IDAsIHYgPSBuLm9yZGVyLmxlbmd0aDsgcCA8IHY7IHArKykgeyB2YXIgdCA9IG4ub3JkZXJbcF07IGlmIChxID0gbi5sZWZ0TWF0Y2hbdF0uZXhlYyhnKSkgeyB2YXIgeSA9IHFbMV07IHEuc3BsaWNlKDEsIDEpOyBpZiAoeS5zdWJzdHIoeS5sZW5ndGggLSAxKSAhPT0gIlxcIikgeyBxWzFdID0gKHFbMV0gfHwgIiIpLnJlcGxhY2UoL1xcL2csICIiKTsgbSA9IG4uZmluZFt0XShxLCBoLCBsKTsgaWYgKG0gIT0gbnVsbCkgeyBnID0gZy5yZXBsYWNlKG4ubWF0Y2hbdF0sICIiKTsgYnJlYWsgfSB9IH0gfSBtIHx8IChtID0gaC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKTsgcmV0dXJuIHsgc2V0OiBtLCBleHByOiBnfQ0KfTsgay5maWx0ZXIgPSBmdW5jdGlvbiAoZywgaCwgbCwgbSkgew0KICAgIGZvciAodmFyIHEgPSBnLCBwID0gW10sIHYgPSBoLCB0LCB5LCBTID0gaCAmJiBoWzBdICYmIHgoaFswXSk7IGcgJiYgaC5sZW5ndGg7ICkgew0KICAgICAgICBmb3IgKHZhciBIIGluIG4uZmlsdGVyKSBpZiAoKHQgPSBuLmxlZnRNYXRjaFtIXS5leGVjKGcpKSAhPSBudWxsICYmIHRbMl0pIHsNCiAgICAgICAgICAgIHZhciBNID0gbi5maWx0ZXJbSF0sIEksIEQ7IEQgPSB0WzFdOyB5ID0gZmFsc2U7IHQuc3BsaWNlKDEsIDEpOyBpZiAoRC5zdWJzdHIoRC5sZW5ndGggLQ0KMSkgIT09ICJcXCIpIHsgaWYgKHYgPT09IHApIHAgPSBbXTsgaWYgKG4ucHJlRmlsdGVyW0hdKSBpZiAodCA9IG4ucHJlRmlsdGVyW0hdKHQsIHYsIGwsIHAsIG0sIFMpKSB7IGlmICh0ID09PSB0cnVlKSBjb250aW51ZSB9IGVsc2UgeSA9IEkgPSB0cnVlOyBpZiAodCkgZm9yICh2YXIgVSA9IDA7IChEID0gdltVXSkgIT0gbnVsbDsgVSsrKSBpZiAoRCkgeyBJID0gTShELCB0LCBVLCB2KTsgdmFyIEhhID0gbSBeICEhSTsgaWYgKGwgJiYgSSAhPSBudWxsKSBpZiAoSGEpIHkgPSB0cnVlOyBlbHNlIHZbVV0gPSBmYWxzZTsgZWxzZSBpZiAoSGEpIHsgcC5wdXNoKEQpOyB5ID0gdHJ1ZSB9IH0gaWYgKEkgIT09IHcpIHsgbCB8fCAodiA9IHApOyBnID0gZy5yZXBsYWNlKG4ubWF0Y2hbSF0sICIiKTsgaWYgKCF5KSByZXR1cm4gW107IGJyZWFrIH0gfSANCiAgICAgICAgfSBpZiAoZyA9PT0gcSkgaWYgKHkgPT0gbnVsbCkgay5lcnJvcihnKTsgZWxzZSBicmVhazsgcSA9IGcNCiAgICB9IHJldHVybiB2DQp9OyBrLmVycm9yID0gZnVuY3Rpb24gKGcpIHsgdGhyb3cgIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIgKyBnOyB9OyB2YXIgbiA9IGsuc2VsZWN0b3JzID0geyBvcmRlcjogWyJJRCIsICJOQU1FIiwgIlRBRyJdLCBtYXRjaDogeyBJRDogLyMoKD86W1x3XHUwMGMwLVx1RkZGRi1dfFxcLikrKS8sDQogICAgQ0xBU1M6IC9cLigoPzpbXHdcdTAwYzAtXHVGRkZGLV18XFwuKSspLywgTkFNRTogL1xbbmFtZT1bJyJdKigoPzpbXHdcdTAwYzAtXHVGRkZGLV18XFwuKSspWyciXSpcXS8sIEFUVFI6IC9cW1xzKigoPzpbXHdcdTAwYzAtXHVGRkZGLV18XFwuKSspXHMqKD86KFxTPz0pXHMqKFsnIl0qKSguKj8pXDN8KVxzKlxdLywgVEFHOiAvXigoPzpbXHdcdTAwYzAtXHVGRkZGXCotXXxcXC4pKykvLCBDSElMRDogLzoob25seXxudGh8bGFzdHxmaXJzdCktY2hpbGQoPzpcKChldmVufG9kZHxbXGRuKy1dKilcKSk/LywgUE9TOiAvOihudGh8ZXF8Z3R8bHR8Zmlyc3R8bGFzdHxldmVufG9kZCkoPzpcKChcZCopXCkpPyg/PVteLV18JCkvLCBQU0VVRE86IC86KCg/Oltcd1x1MDBjMC1cdUZGRkYtXXxcXC4pKykoPzpcKChbJyJdPykoKD86XChbXlwpXStcKXxbXlwoXCldKikrKVwyXCkpPy8NCn0sIGxlZnRNYXRjaDoge30sIGF0dHJNYXA6IHsgImNsYXNzIjogImNsYXNzTmFtZSIsICJmb3IiOiAiaHRtbEZvciIgfSwgYXR0ckhhbmRsZTogeyBocmVmOiBmdW5jdGlvbiAoZykgeyByZXR1cm4gZy5nZXRBdHRyaWJ1dGUoImhyZWYiKSB9IH0sDQogICAgcmVsYXRpdmU6IHsgIisiOiBmdW5jdGlvbiAoZywgaCkgeyB2YXIgbCA9IHR5cGVvZiBoID09PSAic3RyaW5nIiwgbSA9IGwgJiYgIS9cVy8udGVzdChoKTsgbCA9IGwgJiYgIW07IGlmIChtKSBoID0gaC50b0xvd2VyQ2FzZSgpOyBtID0gMDsgZm9yICh2YXIgcSA9IGcubGVuZ3RoLCBwOyBtIDwgcTsgbSsrKSBpZiAocCA9IGdbbV0pIHsgZm9yICg7IChwID0gcC5wcmV2aW91c1NpYmxpbmcpICYmIHAubm9kZVR5cGUgIT09IDE7ICk7IGdbbV0gPSBsIHx8IHAgJiYgcC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBoID8gcCB8fCBmYWxzZSA6IHAgPT09IGggfSBsICYmIGsuZmlsdGVyKGgsIGcsIHRydWUpIH0sICI+IjogZnVuY3Rpb24gKGcsIGgpIHsNCiAgICAgICAgdmFyIGwgPSB0eXBlb2YgaCA9PT0gInN0cmluZyI7IGlmIChsICYmICEvXFcvLnRlc3QoaCkpIHsgaCA9IGgudG9Mb3dlckNhc2UoKTsgZm9yICh2YXIgbSA9IDAsIHEgPSBnLmxlbmd0aDsgbSA8IHE7IG0rKykgeyB2YXIgcCA9IGdbbV07IGlmIChwKSB7IGwgPSBwLnBhcmVudE5vZGU7IGdbbV0gPSBsLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGggPyBsIDogZmFsc2UgfSB9IH0gZWxzZSB7DQogICAgICAgICAgICBtID0gMDsgZm9yIChxID0gZy5sZW5ndGg7IG0gPCBxOyBtKyspIGlmIChwID0gZ1ttXSkgZ1ttXSA9DQpsID8gcC5wYXJlbnROb2RlIDogcC5wYXJlbnROb2RlID09PSBoOyBsICYmIGsuZmlsdGVyKGgsIGcsIHRydWUpDQogICAgICAgIH0gDQogICAgfSwgIiI6IGZ1bmN0aW9uIChnLCBoLCBsKSB7IHZhciBtID0gZSsrLCBxID0gZDsgaWYgKHR5cGVvZiBoID09PSAic3RyaW5nIiAmJiAhL1xXLy50ZXN0KGgpKSB7IHZhciBwID0gaCA9IGgudG9Mb3dlckNhc2UoKTsgcSA9IGIgfSBxKCJwYXJlbnROb2RlIiwgaCwgbSwgZywgcCwgbCkgfSwgIn4iOiBmdW5jdGlvbiAoZywgaCwgbCkgeyB2YXIgbSA9IGUrKywgcSA9IGQ7IGlmICh0eXBlb2YgaCA9PT0gInN0cmluZyIgJiYgIS9cVy8udGVzdChoKSkgeyB2YXIgcCA9IGggPSBoLnRvTG93ZXJDYXNlKCk7IHEgPSBiIH0gcSgicHJldmlvdXNTaWJsaW5nIiwgaCwgbSwgZywgcCwgbCkgfSANCiAgICB9LCBmaW5kOiB7IElEOiBmdW5jdGlvbiAoZywgaCwgbCkgeyBpZiAodHlwZW9mIGguZ2V0RWxlbWVudEJ5SWQgIT09ICJ1bmRlZmluZWQiICYmICFsKSByZXR1cm4gKGcgPSBoLmdldEVsZW1lbnRCeUlkKGdbMV0pKSA/IFtnXSA6IFtdIH0sIE5BTUU6IGZ1bmN0aW9uIChnLCBoKSB7DQogICAgICAgIGlmICh0eXBlb2YgaC5nZXRFbGVtZW50c0J5TmFtZSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgIHZhciBsID0gW107DQogICAgICAgICAgICBoID0gaC5nZXRFbGVtZW50c0J5TmFtZShnWzFdKTsgZm9yICh2YXIgbSA9IDAsIHEgPSBoLmxlbmd0aDsgbSA8IHE7IG0rKykgaFttXS5nZXRBdHRyaWJ1dGUoIm5hbWUiKSA9PT0gZ1sxXSAmJiBsLnB1c2goaFttXSk7IHJldHVybiBsLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBsDQogICAgICAgIH0gDQogICAgfSwgVEFHOiBmdW5jdGlvbiAoZywgaCkgeyByZXR1cm4gaC5nZXRFbGVtZW50c0J5VGFnTmFtZShnWzFdKSB9IA0KICAgIH0sIHByZUZpbHRlcjogeyBDTEFTUzogZnVuY3Rpb24gKGcsIGgsIGwsIG0sIHEsIHApIHsgZyA9ICIgIiArIGdbMV0ucmVwbGFjZSgvXFwvZywgIiIpICsgIiAiOyBpZiAocCkgcmV0dXJuIGc7IHAgPSAwOyBmb3IgKHZhciB2OyAodiA9IGhbcF0pICE9IG51bGw7IHArKykgaWYgKHYpIGlmIChxIF4gKHYuY2xhc3NOYW1lICYmICgiICIgKyB2LmNsYXNzTmFtZSArICIgIikucmVwbGFjZSgvW1x0XG5dL2csICIgIikuaW5kZXhPZihnKSA+PSAwKSkgbCB8fCBtLnB1c2godik7IGVsc2UgaWYgKGwpIGhbcF0gPSBmYWxzZTsgcmV0dXJuIGZhbHNlIH0sIElEOiBmdW5jdGlvbiAoZykgeyByZXR1cm4gZ1sxXS5yZXBsYWNlKC9cXC9nLCAiIikgfSwgVEFHOiBmdW5jdGlvbiAoZykgeyByZXR1cm4gZ1sxXS50b0xvd2VyQ2FzZSgpIH0sDQogICAgICAgIENISUxEOiBmdW5jdGlvbiAoZykgeyBpZiAoZ1sxXSA9PT0gIm50aCIpIHsgdmFyIGggPSAvKC0/KShcZCopbigoPzpcK3wtKT9cZCopLy5leGVjKGdbMl0gPT09ICJldmVuIiAmJiAiMm4iIHx8IGdbMl0gPT09ICJvZGQiICYmICIybisxIiB8fCAhL1xELy50ZXN0KGdbMl0pICYmICIwbisiICsgZ1syXSB8fCBnWzJdKTsgZ1syXSA9IGhbMV0gKyAoaFsyXSB8fCAxKSAtIDA7IGdbM10gPSBoWzNdIC0gMCB9IGdbMF0gPSBlKys7IHJldHVybiBnIH0sIEFUVFI6IGZ1bmN0aW9uIChnLCBoLCBsLCBtLCBxLCBwKSB7IGggPSBnWzFdLnJlcGxhY2UoL1xcL2csICIiKTsgaWYgKCFwICYmIG4uYXR0ck1hcFtoXSkgZ1sxXSA9IG4uYXR0ck1hcFtoXTsgaWYgKGdbMl0gPT09ICJ+PSIpIGdbNF0gPSAiICIgKyBnWzRdICsgIiAiOyByZXR1cm4gZyB9LCBQU0VVRE86IGZ1bmN0aW9uIChnLCBoLCBsLCBtLCBxKSB7DQogICAgICAgICAgICBpZiAoZ1sxXSA9PT0gIm5vdCIpIGlmICgoZi5leGVjKGdbM10pIHx8ICIiKS5sZW5ndGggPiAxIHx8IC9eXHcvLnRlc3QoZ1szXSkpIGdbM10gPSBrKGdbM10sIG51bGwsIG51bGwsIGgpOyBlbHNlIHsNCiAgICAgICAgICAgICAgICBnID0gay5maWx0ZXIoZ1szXSwgaCwgbCwgdHJ1ZSBeIHEpOyBsIHx8IG0ucHVzaC5hcHBseShtLA0KZyk7IHJldHVybiBmYWxzZQ0KICAgICAgICAgICAgfSBlbHNlIGlmIChuLm1hdGNoLlBPUy50ZXN0KGdbMF0pIHx8IG4ubWF0Y2guQ0hJTEQudGVzdChnWzBdKSkgcmV0dXJuIHRydWU7IHJldHVybiBnDQogICAgICAgIH0sIFBPUzogZnVuY3Rpb24gKGcpIHsgZy51bnNoaWZ0KHRydWUpOyByZXR1cm4gZyB9IA0KICAgIH0sIGZpbHRlcnM6IHsgZW5hYmxlZDogZnVuY3Rpb24gKGcpIHsgcmV0dXJuIGcuZGlzYWJsZWQgPT09IGZhbHNlICYmIGcudHlwZSAhPT0gImhpZGRlbiIgfSwgZGlzYWJsZWQ6IGZ1bmN0aW9uIChnKSB7IHJldHVybiBnLmRpc2FibGVkID09PSB0cnVlIH0sIGNoZWNrZWQ6IGZ1bmN0aW9uIChnKSB7IHJldHVybiBnLmNoZWNrZWQgPT09IHRydWUgfSwgc2VsZWN0ZWQ6IGZ1bmN0aW9uIChnKSB7IHJldHVybiBnLnNlbGVjdGVkID09PSB0cnVlIH0sIHBhcmVudDogZnVuY3Rpb24gKGcpIHsgcmV0dXJuICEhZy5maXJzdENoaWxkIH0sIGVtcHR5OiBmdW5jdGlvbiAoZykgeyByZXR1cm4gIWcuZmlyc3RDaGlsZCB9LCBoYXM6IGZ1bmN0aW9uIChnLCBoLCBsKSB7IHJldHVybiAhIWsobFszXSwgZykubGVuZ3RoIH0sIGhlYWRlcjogZnVuY3Rpb24gKGcpIHsgcmV0dXJuIC9oXGQvaS50ZXN0KGcubm9kZU5hbWUpIH0sDQogICAgICAgIHRleHQ6IGZ1bmN0aW9uIChnKSB7IHJldHVybiAidGV4dCIgPT09IGcudHlwZSB9LCByYWRpbzogZnVuY3Rpb24gKGcpIHsgcmV0dXJuICJyYWRpbyIgPT09IGcudHlwZSB9LCBjaGVja2JveDogZnVuY3Rpb24gKGcpIHsgcmV0dXJuICJjaGVja2JveCIgPT09IGcudHlwZSB9LCBmaWxlOiBmdW5jdGlvbiAoZykgeyByZXR1cm4gImZpbGUiID09PSBnLnR5cGUgfSwgcGFzc3dvcmQ6IGZ1bmN0aW9uIChnKSB7IHJldHVybiAicGFzc3dvcmQiID09PSBnLnR5cGUgfSwgc3VibWl0OiBmdW5jdGlvbiAoZykgeyByZXR1cm4gInN1Ym1pdCIgPT09IGcudHlwZSB9LCBpbWFnZTogZnVuY3Rpb24gKGcpIHsgcmV0dXJuICJpbWFnZSIgPT09IGcudHlwZSB9LCByZXNldDogZnVuY3Rpb24gKGcpIHsgcmV0dXJuICJyZXNldCIgPT09IGcudHlwZSB9LCBidXR0b246IGZ1bmN0aW9uIChnKSB7IHJldHVybiAiYnV0dG9uIiA9PT0gZy50eXBlIHx8IGcubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImJ1dHRvbiIgfSwgaW5wdXQ6IGZ1bmN0aW9uIChnKSB7IHJldHVybiAvaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbi9pLnRlc3QoZy5ub2RlTmFtZSkgfSANCiAgICB9LA0KICAgIHNldEZpbHRlcnM6IHsgZmlyc3Q6IGZ1bmN0aW9uIChnLCBoKSB7IHJldHVybiBoID09PSAwIH0sIGxhc3Q6IGZ1bmN0aW9uIChnLCBoLCBsLCBtKSB7IHJldHVybiBoID09PSBtLmxlbmd0aCAtIDEgfSwgZXZlbjogZnVuY3Rpb24gKGcsIGgpIHsgcmV0dXJuIGggJSAyID09PSAwIH0sIG9kZDogZnVuY3Rpb24gKGcsIGgpIHsgcmV0dXJuIGggJSAyID09PSAxIH0sIGx0OiBmdW5jdGlvbiAoZywgaCwgbCkgeyByZXR1cm4gaCA8IGxbM10gLSAwIH0sIGd0OiBmdW5jdGlvbiAoZywgaCwgbCkgeyByZXR1cm4gaCA+IGxbM10gLSAwIH0sIG50aDogZnVuY3Rpb24gKGcsIGgsIGwpIHsgcmV0dXJuIGxbM10gLSAwID09PSBoIH0sIGVxOiBmdW5jdGlvbiAoZywgaCwgbCkgeyByZXR1cm4gbFszXSAtIDAgPT09IGggfSB9LCBmaWx0ZXI6IHsgUFNFVURPOiBmdW5jdGlvbiAoZywgaCwgbCwgbSkgew0KICAgICAgICB2YXIgcSA9IGhbMV0sIHAgPSBuLmZpbHRlcnNbcV07IGlmIChwKSByZXR1cm4gcChnLCBsLCBoLCBtKTsgZWxzZSBpZiAocSA9PT0gImNvbnRhaW5zIikgcmV0dXJuIChnLnRleHRDb250ZW50IHx8IGcuaW5uZXJUZXh0IHx8IGEoW2ddKSB8fCAiIikuaW5kZXhPZihoWzNdKSA+PSAwOyBlbHNlIGlmIChxID09PSAibm90Iikgew0KICAgICAgICAgICAgaCA9DQpoWzNdOyBsID0gMDsgZm9yIChtID0gaC5sZW5ndGg7IGwgPCBtOyBsKyspIGlmIChoW2xdID09PSBnKSByZXR1cm4gZmFsc2U7IHJldHVybiB0cnVlDQogICAgICAgIH0gZWxzZSBrLmVycm9yKCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiICsgcSkNCiAgICB9LCBDSElMRDogZnVuY3Rpb24gKGcsIGgpIHsNCiAgICAgICAgdmFyIGwgPSBoWzFdLCBtID0gZzsgc3dpdGNoIChsKSB7DQogICAgICAgICAgICBjYXNlICJvbmx5IjogY2FzZSAiZmlyc3QiOiBmb3IgKDsgbSA9IG0ucHJldmlvdXNTaWJsaW5nOyApIGlmIChtLm5vZGVUeXBlID09PSAxKSByZXR1cm4gZmFsc2U7IGlmIChsID09PSAiZmlyc3QiKSByZXR1cm4gdHJ1ZTsgbSA9IGc7IGNhc2UgImxhc3QiOiBmb3IgKDsgbSA9IG0ubmV4dFNpYmxpbmc7ICkgaWYgKG0ubm9kZVR5cGUgPT09IDEpIHJldHVybiBmYWxzZTsgcmV0dXJuIHRydWU7IGNhc2UgIm50aCI6IGwgPSBoWzJdOyB2YXIgcSA9IGhbM107IGlmIChsID09PSAxICYmIHEgPT09IDApIHJldHVybiB0cnVlOyBoID0gaFswXTsgdmFyIHAgPSBnLnBhcmVudE5vZGU7IGlmIChwICYmIChwLnNpemNhY2hlICE9PSBoIHx8ICFnLm5vZGVJbmRleCkpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHYgPSAwOyBmb3IgKG0gPSBwLmZpcnN0Q2hpbGQ7IG07IG0gPQ0KbS5uZXh0U2libGluZykgaWYgKG0ubm9kZVR5cGUgPT09IDEpIG0ubm9kZUluZGV4ID0gKyt2OyBwLnNpemNhY2hlID0gaA0KICAgICAgICAgICAgICAgIH0gZyA9IGcubm9kZUluZGV4IC0gcTsgcmV0dXJuIGwgPT09IDAgPyBnID09PSAwIDogZyAlIGwgPT09IDAgJiYgZyAvIGwgPj0gMA0KICAgICAgICB9IA0KICAgIH0sIElEOiBmdW5jdGlvbiAoZywgaCkgeyByZXR1cm4gZy5ub2RlVHlwZSA9PT0gMSAmJiBnLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gaCB9LCBUQUc6IGZ1bmN0aW9uIChnLCBoKSB7IHJldHVybiBoID09PSAiKiIgJiYgZy5ub2RlVHlwZSA9PT0gMSB8fCBnLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IGggfSwgQ0xBU1M6IGZ1bmN0aW9uIChnLCBoKSB7IHJldHVybiAoIiAiICsgKGcuY2xhc3NOYW1lIHx8IGcuZ2V0QXR0cmlidXRlKCJjbGFzcyIpKSArICIgIikuaW5kZXhPZihoKSA+IC0xIH0sIEFUVFI6IGZ1bmN0aW9uIChnLCBoKSB7DQogICAgICAgIHZhciBsID0gaFsxXTsgZyA9IG4uYXR0ckhhbmRsZVtsXSA/IG4uYXR0ckhhbmRsZVtsXShnKSA6IGdbbF0gIT0gbnVsbCA/IGdbbF0gOiBnLmdldEF0dHJpYnV0ZShsKTsgbCA9IGcgKyAiIjsgdmFyIG0gPSBoWzJdOyBoID0gaFs0XTsgcmV0dXJuIGcgPT0gbnVsbCA/IG0gPT09ICIhPSIgOiBtID09PQ0KIj0iID8gbCA9PT0gaCA6IG0gPT09ICIqPSIgPyBsLmluZGV4T2YoaCkgPj0gMCA6IG0gPT09ICJ+PSIgPyAoIiAiICsgbCArICIgIikuaW5kZXhPZihoKSA+PSAwIDogIWggPyBsICYmIGcgIT09IGZhbHNlIDogbSA9PT0gIiE9IiA/IGwgIT09IGggOiBtID09PSAiXj0iID8gbC5pbmRleE9mKGgpID09PSAwIDogbSA9PT0gIiQ9IiA/IGwuc3Vic3RyKGwubGVuZ3RoIC0gaC5sZW5ndGgpID09PSBoIDogbSA9PT0gInw9IiA/IGwgPT09IGggfHwgbC5zdWJzdHIoMCwgaC5sZW5ndGggKyAxKSA9PT0gaCArICItIiA6IGZhbHNlDQogICAgfSwgUE9TOiBmdW5jdGlvbiAoZywgaCwgbCwgbSkgeyB2YXIgcSA9IG4uc2V0RmlsdGVyc1toWzJdXTsgaWYgKHEpIHJldHVybiBxKGcsIGwsIGgsIG0pIH0gDQogICAgfQ0KfSwgciA9IG4ubWF0Y2guUE9TOyBmb3IgKHZhciB1IGluIG4ubWF0Y2gpIHsNCiAgICAgICAgbi5tYXRjaFt1XSA9IG5ldyBSZWdFeHAobi5tYXRjaFt1XS5zb3VyY2UgKyAvKD8hW15cW10qXF0pKD8hW15cKF0qXCkpLy5zb3VyY2UpOyBuLmxlZnRNYXRjaFt1XSA9IG5ldyBSZWdFeHAoLyheKD86LnxccnxcbikqPykvLnNvdXJjZSArIG4ubWF0Y2hbdV0uc291cmNlLnJlcGxhY2UoL1xcKFxkKykvZywgZnVuY3Rpb24gKGcsDQpoKSB7IHJldHVybiAiXFwiICsgKGggLSAwICsgMSkgfSkpDQogICAgfSB2YXIgeiA9IGZ1bmN0aW9uIChnLCBoKSB7IGcgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChnLCAwKTsgaWYgKGgpIHsgaC5wdXNoLmFwcGx5KGgsIGcpOyByZXR1cm4gaCB9IHJldHVybiBnIH07IHRyeSB7IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHMuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMsIDApIH0gY2F0Y2ggKEMpIHsgeiA9IGZ1bmN0aW9uIChnLCBoKSB7IGggPSBoIHx8IFtdOyBpZiAoai5jYWxsKGcpID09PSAiW29iamVjdCBBcnJheV0iKSBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShoLCBnKTsgZWxzZSBpZiAodHlwZW9mIGcubGVuZ3RoID09PSAibnVtYmVyIikgZm9yICh2YXIgbCA9IDAsIG0gPSBnLmxlbmd0aDsgbCA8IG07IGwrKykgaC5wdXNoKGdbbF0pOyBlbHNlIGZvciAobCA9IDA7IGdbbF07IGwrKykgaC5wdXNoKGdbbF0pOyByZXR1cm4gaCB9IH0gdmFyIEI7IGlmIChzLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbikgQiA9IGZ1bmN0aW9uIChnLCBoKSB7DQogICAgICAgIGlmICghZy5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiB8fA0KIWguY29tcGFyZURvY3VtZW50UG9zaXRpb24pIHsgaWYgKGcgPT0gaCkgaSA9IHRydWU7IHJldHVybiBnLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8gLTEgOiAxIH0gZyA9IGcuY29tcGFyZURvY3VtZW50UG9zaXRpb24oaCkgJiA0ID8gLTEgOiBnID09PSBoID8gMCA6IDE7IGlmIChnID09PSAwKSBpID0gdHJ1ZTsgcmV0dXJuIGcNCiAgICB9OyBlbHNlIGlmICgic291cmNlSW5kZXgiIGluIHMuZG9jdW1lbnRFbGVtZW50KSBCID0gZnVuY3Rpb24gKGcsIGgpIHsgaWYgKCFnLnNvdXJjZUluZGV4IHx8ICFoLnNvdXJjZUluZGV4KSB7IGlmIChnID09IGgpIGkgPSB0cnVlOyByZXR1cm4gZy5zb3VyY2VJbmRleCA/IC0xIDogMSB9IGcgPSBnLnNvdXJjZUluZGV4IC0gaC5zb3VyY2VJbmRleDsgaWYgKGcgPT09IDApIGkgPSB0cnVlOyByZXR1cm4gZyB9OyBlbHNlIGlmIChzLmNyZWF0ZVJhbmdlKSBCID0gZnVuY3Rpb24gKGcsIGgpIHsNCiAgICAgICAgaWYgKCFnLm93bmVyRG9jdW1lbnQgfHwgIWgub3duZXJEb2N1bWVudCkgeyBpZiAoZyA9PSBoKSBpID0gdHJ1ZTsgcmV0dXJuIGcub3duZXJEb2N1bWVudCA/IC0xIDogMSB9IHZhciBsID0gZy5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKCksIG0gPQ0KaC5vd25lckRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7IGwuc2V0U3RhcnQoZywgMCk7IGwuc2V0RW5kKGcsIDApOyBtLnNldFN0YXJ0KGgsIDApOyBtLnNldEVuZChoLCAwKTsgZyA9IGwuY29tcGFyZUJvdW5kYXJ5UG9pbnRzKFJhbmdlLlNUQVJUX1RPX0VORCwgbSk7IGlmIChnID09PSAwKSBpID0gdHJ1ZTsgcmV0dXJuIGcNCiAgICB9OyAoZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgZyA9IHMuY3JlYXRlRWxlbWVudCgiZGl2IiksIGggPSAic2NyaXB0IiArIChuZXcgRGF0ZSkuZ2V0VGltZSgpOyBnLmlubmVySFRNTCA9ICI8YSBuYW1lPSciICsgaCArICInLz4iOyB2YXIgbCA9IHMuZG9jdW1lbnRFbGVtZW50OyBsLmluc2VydEJlZm9yZShnLCBsLmZpcnN0Q2hpbGQpOyBpZiAocy5nZXRFbGVtZW50QnlJZChoKSkgew0KICAgICAgICAgICAgbi5maW5kLklEID0gZnVuY3Rpb24gKG0sIHEsIHApIHsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHEuZ2V0RWxlbWVudEJ5SWQgIT09ICJ1bmRlZmluZWQiICYmICFwKSByZXR1cm4gKHEgPSBxLmdldEVsZW1lbnRCeUlkKG1bMV0pKSA/IHEuaWQgPT09IG1bMV0gfHwgdHlwZW9mIHEuZ2V0QXR0cmlidXRlTm9kZSAhPT0gInVuZGVmaW5lZCIgJiYNCnEuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKS5ub2RlVmFsdWUgPT09IG1bMV0gPyBbcV0gOiB3IDogW10NCiAgICAgICAgICAgIH07IG4uZmlsdGVyLklEID0gZnVuY3Rpb24gKG0sIHEpIHsgdmFyIHAgPSB0eXBlb2YgbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSAidW5kZWZpbmVkIiAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoImlkIik7IHJldHVybiBtLm5vZGVUeXBlID09PSAxICYmIHAgJiYgcC5ub2RlVmFsdWUgPT09IHEgfSANCiAgICAgICAgfSBsLnJlbW92ZUNoaWxkKGcpOyBsID0gZyA9IG51bGwNCiAgICB9KSgpOyAoZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgZyA9IHMuY3JlYXRlRWxlbWVudCgiZGl2Iik7IGcuYXBwZW5kQ2hpbGQocy5jcmVhdGVDb21tZW50KCIiKSk7IGlmIChnLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RoID4gMCkgbi5maW5kLlRBRyA9IGZ1bmN0aW9uIChoLCBsKSB7IGwgPSBsLmdldEVsZW1lbnRzQnlUYWdOYW1lKGhbMV0pOyBpZiAoaFsxXSA9PT0gIioiKSB7IGggPSBbXTsgZm9yICh2YXIgbSA9IDA7IGxbbV07IG0rKykgbFttXS5ub2RlVHlwZSA9PT0gMSAmJiBoLnB1c2gobFttXSk7IGwgPSBoIH0gcmV0dXJuIGwgfTsgZy5pbm5lckhUTUwgPSAiPGEgaHJlZj0nIyc+PC9hPiI7DQogICAgICAgIGlmIChnLmZpcnN0Q2hpbGQgJiYgdHlwZW9mIGcuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUgIT09ICJ1bmRlZmluZWQiICYmIGcuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKSAhPT0gIiMiKSBuLmF0dHJIYW5kbGUuaHJlZiA9IGZ1bmN0aW9uIChoKSB7IHJldHVybiBoLmdldEF0dHJpYnV0ZSgiaHJlZiIsIDIpIH07IGcgPSBudWxsDQogICAgfSkoKTsgcy5xdWVyeVNlbGVjdG9yQWxsICYmIGZ1bmN0aW9uICgpIHsgdmFyIGcgPSBrLCBoID0gcy5jcmVhdGVFbGVtZW50KCJkaXYiKTsgaC5pbm5lckhUTUwgPSAiPHAgY2xhc3M9J1RFU1QnPjwvcD4iOyBpZiAoIShoLnF1ZXJ5U2VsZWN0b3JBbGwgJiYgaC5xdWVyeVNlbGVjdG9yQWxsKCIuVEVTVCIpLmxlbmd0aCA9PT0gMCkpIHsgayA9IGZ1bmN0aW9uIChtLCBxLCBwLCB2KSB7IHEgPSBxIHx8IHM7IGlmICghdiAmJiBxLm5vZGVUeXBlID09PSA5ICYmICF4KHEpKSB0cnkgeyByZXR1cm4geihxLnF1ZXJ5U2VsZWN0b3JBbGwobSksIHApIH0gY2F0Y2ggKHQpIHsgfSByZXR1cm4gZyhtLCBxLCBwLCB2KSB9OyBmb3IgKHZhciBsIGluIGcpIGtbbF0gPSBnW2xdOyBoID0gbnVsbCB9IH0gKCk7DQogICAgKGZ1bmN0aW9uICgpIHsgdmFyIGcgPSBzLmNyZWF0ZUVsZW1lbnQoImRpdiIpOyBnLmlubmVySFRNTCA9ICI8ZGl2IGNsYXNzPSd0ZXN0IGUnPjwvZGl2PjxkaXYgY2xhc3M9J3Rlc3QnPjwvZGl2PiI7IGlmICghKCFnLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgfHwgZy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoID09PSAwKSkgeyBnLmxhc3RDaGlsZC5jbGFzc05hbWUgPSAiZSI7IGlmIChnLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGggIT09IDEpIHsgbi5vcmRlci5zcGxpY2UoMSwgMCwgIkNMQVNTIik7IG4uZmluZC5DTEFTUyA9IGZ1bmN0aW9uIChoLCBsLCBtKSB7IGlmICh0eXBlb2YgbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICE9PSAidW5kZWZpbmVkIiAmJiAhbSkgcmV0dXJuIGwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShoWzFdKSB9OyBnID0gbnVsbCB9IH0gfSkoKTsgdmFyIEUgPSBzLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8gZnVuY3Rpb24gKGcsIGgpIHsgcmV0dXJuICEhKGcuY29tcGFyZURvY3VtZW50UG9zaXRpb24oaCkgJiAxNikgfSA6DQpmdW5jdGlvbiAoZywgaCkgeyByZXR1cm4gZyAhPT0gaCAmJiAoZy5jb250YWlucyA/IGcuY29udGFpbnMoaCkgOiB0cnVlKSB9LCB4ID0gZnVuY3Rpb24gKGcpIHsgcmV0dXJuIChnID0gKGcgPyBnLm93bmVyRG9jdW1lbnQgfHwgZyA6IDApLmRvY3VtZW50RWxlbWVudCkgPyBnLm5vZGVOYW1lICE9PSAiSFRNTCIgOiBmYWxzZSB9LCBnYSA9IGZ1bmN0aW9uIChnLCBoKSB7IHZhciBsID0gW10sIG0gPSAiIiwgcTsgZm9yIChoID0gaC5ub2RlVHlwZSA/IFtoXSA6IGg7IHEgPSBuLm1hdGNoLlBTRVVETy5leGVjKGcpOyApIHsgbSArPSBxWzBdOyBnID0gZy5yZXBsYWNlKG4ubWF0Y2guUFNFVURPLCAiIikgfSBnID0gbi5yZWxhdGl2ZVtnXSA/IGcgKyAiKiIgOiBnOyBxID0gMDsgZm9yICh2YXIgcCA9IGgubGVuZ3RoOyBxIDwgcDsgcSsrKSBrKGcsIGhbcV0sIGwpOyByZXR1cm4gay5maWx0ZXIobSwgbCkgfTsgYy5maW5kID0gazsgYy5leHByID0gay5zZWxlY3RvcnM7IGMuZXhwclsiOiJdID0gYy5leHByLmZpbHRlcnM7IGMudW5pcXVlID0gay51bmlxdWVTb3J0OyBjLnRleHQgPSBhOyBjLmlzWE1MRG9jID0geDsgYy5jb250YWlucyA9IEUNCn0pKCk7IHZhciBlYiA9IC9VbnRpbCQvLCBmYiA9IC9eKD86cGFyZW50c3xwcmV2VW50aWx8cHJldkFsbCkvLA0KZ2IgPSAvLC87IFIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7IHZhciBJYSA9IGZ1bmN0aW9uIChhLCBiLCBkKSB7IGlmIChjLmlzRnVuY3Rpb24oYikpIHJldHVybiBjLmdyZXAoYSwgZnVuY3Rpb24gKGUsIGopIHsgcmV0dXJuICEhYi5jYWxsKGUsIGosIGUpID09PSBkIH0pOyBlbHNlIGlmIChiLm5vZGVUeXBlKSByZXR1cm4gYy5ncmVwKGEsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlID09PSBiID09PSBkIH0pOyBlbHNlIGlmICh0eXBlb2YgYiA9PT0gInN0cmluZyIpIHsgdmFyIGYgPSBjLmdyZXAoYSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubm9kZVR5cGUgPT09IDEgfSk7IGlmIChVYS50ZXN0KGIpKSByZXR1cm4gYy5maWx0ZXIoYiwgZiwgIWQpOyBlbHNlIGIgPSBjLmZpbHRlcihiLCBmKSB9IHJldHVybiBjLmdyZXAoYSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGMuaW5BcnJheShlLCBiKSA+PSAwID09PSBkIH0pIH07IGMuZm4uZXh0ZW5kKHsgZmluZDogZnVuY3Rpb24gKGEpIHsNCiAgICBmb3IgKHZhciBiID0gdGhpcy5wdXNoU3RhY2soIiIsICJmaW5kIiwgYSksIGQgPSAwLCBmID0gMCwgZSA9IHRoaXMubGVuZ3RoOyBmIDwgZTsgZisrKSB7DQogICAgICAgIGQgPSBiLmxlbmd0aDsNCiAgICAgICAgYy5maW5kKGEsIHRoaXNbZl0sIGIpOyBpZiAoZiA+IDApIGZvciAodmFyIGogPSBkOyBqIDwgYi5sZW5ndGg7IGorKykgZm9yICh2YXIgaSA9IDA7IGkgPCBkOyBpKyspIGlmIChiW2ldID09PSBiW2pdKSB7IGIuc3BsaWNlKGotLSwgMSk7IGJyZWFrIH0gDQogICAgfSByZXR1cm4gYg0KfSwgaGFzOiBmdW5jdGlvbiAoYSkgeyB2YXIgYiA9IGMoYSk7IHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbiAoKSB7IGZvciAodmFyIGQgPSAwLCBmID0gYi5sZW5ndGg7IGQgPCBmOyBkKyspIGlmIChjLmNvbnRhaW5zKHRoaXMsIGJbZF0pKSByZXR1cm4gdHJ1ZSB9KSB9LCBub3Q6IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0aGlzLnB1c2hTdGFjayhJYSh0aGlzLCBhLCBmYWxzZSksICJub3QiLCBhKSB9LCBmaWx0ZXI6IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0aGlzLnB1c2hTdGFjayhJYSh0aGlzLCBhLCB0cnVlKSwgImZpbHRlciIsIGEpIH0sIGlzOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gISFhICYmIGMuZmlsdGVyKGEsIHRoaXMpLmxlbmd0aCA+IDAgfSwgY2xvc2VzdDogZnVuY3Rpb24gKGEsIGIpIHsNCiAgICBpZiAoYy5pc0FycmF5KGEpKSB7DQogICAgICAgIHZhciBkID0gW10sIGYgPSB0aGlzWzBdLCBlLCBqID0NCnt9LCBpOyBpZiAoZiAmJiBhLmxlbmd0aCkgeyBlID0gMDsgZm9yICh2YXIgbyA9IGEubGVuZ3RoOyBlIDwgbzsgZSsrKSB7IGkgPSBhW2VdOyBqW2ldIHx8IChqW2ldID0gYy5leHByLm1hdGNoLlBPUy50ZXN0KGkpID8gYyhpLCBiIHx8IHRoaXMuY29udGV4dCkgOiBpKSB9IGZvciAoOyBmICYmIGYub3duZXJEb2N1bWVudCAmJiBmICE9PSBiOyApIHsgZm9yIChpIGluIGopIHsgZSA9IGpbaV07IGlmIChlLmpxdWVyeSA/IGUuaW5kZXgoZikgPiAtMSA6IGMoZikuaXMoZSkpIHsgZC5wdXNoKHsgc2VsZWN0b3I6IGksIGVsZW06IGYgfSk7IGRlbGV0ZSBqW2ldIH0gfSBmID0gZi5wYXJlbnROb2RlIH0gfSByZXR1cm4gZA0KICAgIH0gdmFyIGsgPSBjLmV4cHIubWF0Y2guUE9TLnRlc3QoYSkgPyBjKGEsIGIgfHwgdGhpcy5jb250ZXh0KSA6IG51bGw7IHJldHVybiB0aGlzLm1hcChmdW5jdGlvbiAobiwgcikgeyBmb3IgKDsgciAmJiByLm93bmVyRG9jdW1lbnQgJiYgciAhPT0gYjsgKSB7IGlmIChrID8gay5pbmRleChyKSA+IC0xIDogYyhyKS5pcyhhKSkgcmV0dXJuIHI7IHIgPSByLnBhcmVudE5vZGUgfSByZXR1cm4gbnVsbCB9KQ0KfSwgaW5kZXg6IGZ1bmN0aW9uIChhKSB7DQogICAgaWYgKCFhIHx8IHR5cGVvZiBhID09PQ0KInN0cmluZyIpIHJldHVybiBjLmluQXJyYXkodGhpc1swXSwgYSA/IGMoYSkgOiB0aGlzLnBhcmVudCgpLmNoaWxkcmVuKCkpOyByZXR1cm4gYy5pbkFycmF5KGEuanF1ZXJ5ID8gYVswXSA6IGEsIHRoaXMpDQp9LCBhZGQ6IGZ1bmN0aW9uIChhLCBiKSB7IGEgPSB0eXBlb2YgYSA9PT0gInN0cmluZyIgPyBjKGEsIGIgfHwgdGhpcy5jb250ZXh0KSA6IGMubWFrZUFycmF5KGEpOyBiID0gYy5tZXJnZSh0aGlzLmdldCgpLCBhKTsgcmV0dXJuIHRoaXMucHVzaFN0YWNrKHFhKGFbMF0pIHx8IHFhKGJbMF0pID8gYiA6IGMudW5pcXVlKGIpKSB9LCBhbmRTZWxmOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmFkZCh0aGlzLnByZXZPYmplY3QpIH0gDQp9KTsgYy5lYWNoKHsgcGFyZW50OiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gKGEgPSBhLnBhcmVudE5vZGUpICYmIGEubm9kZVR5cGUgIT09IDExID8gYSA6IG51bGwgfSwgcGFyZW50czogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGMuZGlyKGEsICJwYXJlbnROb2RlIikgfSwgcGFyZW50c1VudGlsOiBmdW5jdGlvbiAoYSwgYiwgZCkgew0KICAgIHJldHVybiBjLmRpcihhLCAicGFyZW50Tm9kZSIsDQpkKQ0KfSwgbmV4dDogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGMubnRoKGEsIDIsICJuZXh0U2libGluZyIpIH0sIHByZXY6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBjLm50aChhLCAyLCAicHJldmlvdXNTaWJsaW5nIikgfSwgbmV4dEFsbDogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGMuZGlyKGEsICJuZXh0U2libGluZyIpIH0sIHByZXZBbGw6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBjLmRpcihhLCAicHJldmlvdXNTaWJsaW5nIikgfSwgbmV4dFVudGlsOiBmdW5jdGlvbiAoYSwgYiwgZCkgeyByZXR1cm4gYy5kaXIoYSwgIm5leHRTaWJsaW5nIiwgZCkgfSwgcHJldlVudGlsOiBmdW5jdGlvbiAoYSwgYiwgZCkgeyByZXR1cm4gYy5kaXIoYSwgInByZXZpb3VzU2libGluZyIsIGQpIH0sIHNpYmxpbmdzOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gYy5zaWJsaW5nKGEucGFyZW50Tm9kZS5maXJzdENoaWxkLCBhKSB9LCBjaGlsZHJlbjogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIGMuc2libGluZyhhLmZpcnN0Q2hpbGQpIH0sIGNvbnRlbnRzOiBmdW5jdGlvbiAoYSkgew0KICAgIHJldHVybiBjLm5vZGVOYW1lKGEsICJpZnJhbWUiKSA/DQphLmNvbnRlbnREb2N1bWVudCB8fCBhLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQgOiBjLm1ha2VBcnJheShhLmNoaWxkTm9kZXMpDQp9IA0KfSwgZnVuY3Rpb24gKGEsIGIpIHsgYy5mblthXSA9IGZ1bmN0aW9uIChkLCBmKSB7IHZhciBlID0gYy5tYXAodGhpcywgYiwgZCk7IGViLnRlc3QoYSkgfHwgKGYgPSBkKTsgaWYgKGYgJiYgdHlwZW9mIGYgPT09ICJzdHJpbmciKSBlID0gYy5maWx0ZXIoZiwgZSk7IGUgPSB0aGlzLmxlbmd0aCA+IDEgPyBjLnVuaXF1ZShlKSA6IGU7IGlmICgodGhpcy5sZW5ndGggPiAxIHx8IGdiLnRlc3QoZikpICYmIGZiLnRlc3QoYSkpIGUgPSBlLnJldmVyc2UoKTsgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGUsIGEsIFIuY2FsbChhcmd1bWVudHMpLmpvaW4oIiwiKSkgfSB9KTsgYy5leHRlbmQoeyBmaWx0ZXI6IGZ1bmN0aW9uIChhLCBiLCBkKSB7IGlmIChkKSBhID0gIjpub3QoIiArIGEgKyAiKSI7IHJldHVybiBjLmZpbmQubWF0Y2hlcyhhLCBiKSB9LCBkaXI6IGZ1bmN0aW9uIChhLCBiLCBkKSB7DQogICAgdmFyIGYgPSBbXTsgZm9yIChhID0gYVtiXTsgYSAmJiBhLm5vZGVUeXBlICE9PSA5ICYmIChkID09PSB3IHx8IGEubm9kZVR5cGUgIT09IDEgfHwgIWMoYSkuaXMoZCkpOyApIHsNCiAgICAgICAgYS5ub2RlVHlwZSA9PT0NCjEgJiYgZi5wdXNoKGEpOyBhID0gYVtiXQ0KICAgIH0gcmV0dXJuIGYNCn0sIG50aDogZnVuY3Rpb24gKGEsIGIsIGQpIHsgYiA9IGIgfHwgMTsgZm9yICh2YXIgZiA9IDA7IGE7IGEgPSBhW2RdKSBpZiAoYS5ub2RlVHlwZSA9PT0gMSAmJiArK2YgPT09IGIpIGJyZWFrOyByZXR1cm4gYSB9LCBzaWJsaW5nOiBmdW5jdGlvbiAoYSwgYikgeyBmb3IgKHZhciBkID0gW107IGE7IGEgPSBhLm5leHRTaWJsaW5nKSBhLm5vZGVUeXBlID09PSAxICYmIGEgIT09IGIgJiYgZC5wdXNoKGEpOyByZXR1cm4gZCB9IA0KfSk7IHZhciBKYSA9IC8galF1ZXJ5XGQrPSIoPzpcZCt8bnVsbCkiL2csIFYgPSAvXlxzKy8sIEthID0gLyg8KFtcdzpdKylbXj5dKj8pXC8+L2csIGhiID0gL14oPzphcmVhfGJyfGNvbHxlbWJlZHxocnxpbWd8aW5wdXR8bGlua3xtZXRhfHBhcmFtKSQvaSwgTGEgPSAvPChbXHc6XSspLywgaWIgPSAvPHRib2R5L2ksIGpiID0gLzx8JiM/XHcrOy8sIHRhID0gLzxzY3JpcHR8PG9iamVjdHw8ZW1iZWR8PG9wdGlvbnw8c3R5bGUvaSwgdWEgPSAvY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSwgTWEgPSBmdW5jdGlvbiAoYSwgYiwgZCkgew0KICAgIHJldHVybiBoYi50ZXN0KGQpID8NCmEgOiBiICsgIj48LyIgKyBkICsgIj4iDQp9LCBGID0geyBvcHRpb246IFsxLCAiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsICI8L3NlbGVjdD4iXSwgbGVnZW5kOiBbMSwgIjxmaWVsZHNldD4iLCAiPC9maWVsZHNldD4iXSwgdGhlYWQ6IFsxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiJdLCB0cjogWzIsICI8dGFibGU+PHRib2R5PiIsICI8L3Rib2R5PjwvdGFibGU+Il0sIHRkOiBbMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iXSwgY29sOiBbMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iXSwgYXJlYTogWzEsICI8bWFwPiIsICI8L21hcD4iXSwgX2RlZmF1bHQ6IFswLCAiIiwgIiJdIH07IEYub3B0Z3JvdXAgPSBGLm9wdGlvbjsgRi50Ym9keSA9IEYudGZvb3QgPSBGLmNvbGdyb3VwID0gRi5jYXB0aW9uID0gRi50aGVhZDsgRi50aCA9IEYudGQ7IGlmICghYy5zdXBwb3J0Lmh0bWxTZXJpYWxpemUpIEYuX2RlZmF1bHQgPSBbMSwgImRpdjxkaXY+IiwgIjwvZGl2PiJdOyBjLmZuLmV4dGVuZCh7IHRleHQ6IGZ1bmN0aW9uIChhKSB7DQogICAgaWYgKGMuaXNGdW5jdGlvbihhKSkgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoYikgew0KICAgICAgICB2YXIgZCA9DQpjKHRoaXMpOyBkLnRleHQoYS5jYWxsKHRoaXMsIGIsIGQudGV4dCgpKSkNCiAgICB9KTsgaWYgKHR5cGVvZiBhICE9PSAib2JqZWN0IiAmJiBhICE9PSB3KSByZXR1cm4gdGhpcy5lbXB0eSgpLmFwcGVuZCgodGhpc1swXSAmJiB0aGlzWzBdLm93bmVyRG9jdW1lbnQgfHwgcykuY3JlYXRlVGV4dE5vZGUoYSkpOyByZXR1cm4gYy50ZXh0KHRoaXMpDQp9LCB3cmFwQWxsOiBmdW5jdGlvbiAoYSkgeyBpZiAoYy5pc0Z1bmN0aW9uKGEpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChkKSB7IGModGhpcykud3JhcEFsbChhLmNhbGwodGhpcywgZCkpIH0pOyBpZiAodGhpc1swXSkgeyB2YXIgYiA9IGMoYSwgdGhpc1swXS5vd25lckRvY3VtZW50KS5lcSgwKS5jbG9uZSh0cnVlKTsgdGhpc1swXS5wYXJlbnROb2RlICYmIGIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pOyBiLm1hcChmdW5jdGlvbiAoKSB7IGZvciAodmFyIGQgPSB0aGlzOyBkLmZpcnN0Q2hpbGQgJiYgZC5maXJzdENoaWxkLm5vZGVUeXBlID09PSAxOyApIGQgPSBkLmZpcnN0Q2hpbGQ7IHJldHVybiBkIH0pLmFwcGVuZCh0aGlzKSB9IHJldHVybiB0aGlzIH0sDQogICAgd3JhcElubmVyOiBmdW5jdGlvbiAoYSkgeyBpZiAoYy5pc0Z1bmN0aW9uKGEpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChiKSB7IGModGhpcykud3JhcElubmVyKGEuY2FsbCh0aGlzLCBiKSkgfSk7IHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyB2YXIgYiA9IGModGhpcyksIGQgPSBiLmNvbnRlbnRzKCk7IGQubGVuZ3RoID8gZC53cmFwQWxsKGEpIDogYi5hcHBlbmQoYSkgfSkgfSwgd3JhcDogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7IGModGhpcykud3JhcEFsbChhKSB9KSB9LCB1bndyYXA6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMucGFyZW50KCkuZWFjaChmdW5jdGlvbiAoKSB7IGMubm9kZU5hbWUodGhpcywgImJvZHkiKSB8fCBjKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2RlcykgfSkuZW5kKCkgfSwgYXBwZW5kOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgdHJ1ZSwgZnVuY3Rpb24gKGEpIHsgdGhpcy5ub2RlVHlwZSA9PT0gMSAmJiB0aGlzLmFwcGVuZENoaWxkKGEpIH0pIH0sDQogICAgcHJlcGVuZDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIHRydWUsIGZ1bmN0aW9uIChhKSB7IHRoaXMubm9kZVR5cGUgPT09IDEgJiYgdGhpcy5pbnNlcnRCZWZvcmUoYSwgdGhpcy5maXJzdENoaWxkKSB9KSB9LCBiZWZvcmU6IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXNbMF0gJiYgdGhpc1swXS5wYXJlbnROb2RlKSByZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsIGZhbHNlLCBmdW5jdGlvbiAoYikgeyB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGIsIHRoaXMpIH0pOyBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7IHZhciBhID0gYyhhcmd1bWVudHNbMF0pOyBhLnB1c2guYXBwbHkoYSwgdGhpcy50b0FycmF5KCkpOyByZXR1cm4gdGhpcy5wdXNoU3RhY2soYSwgImJlZm9yZSIsIGFyZ3VtZW50cykgfSB9LCBhZnRlcjogZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAodGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUpIHJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywgZmFsc2UsIGZ1bmN0aW9uIChiKSB7DQogICAgICAgICAgICB0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGIsDQp0aGlzLm5leHRTaWJsaW5nKQ0KICAgICAgICB9KTsgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCkgeyB2YXIgYSA9IHRoaXMucHVzaFN0YWNrKHRoaXMsICJhZnRlciIsIGFyZ3VtZW50cyk7IGEucHVzaC5hcHBseShhLCBjKGFyZ3VtZW50c1swXSkudG9BcnJheSgpKTsgcmV0dXJuIGEgfSANCiAgICB9LCByZW1vdmU6IGZ1bmN0aW9uIChhLCBiKSB7IGZvciAodmFyIGQgPSAwLCBmOyAoZiA9IHRoaXNbZF0pICE9IG51bGw7IGQrKykgaWYgKCFhIHx8IGMuZmlsdGVyKGEsIFtmXSkubGVuZ3RoKSB7IGlmICghYiAmJiBmLm5vZGVUeXBlID09PSAxKSB7IGMuY2xlYW5EYXRhKGYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSk7IGMuY2xlYW5EYXRhKFtmXSkgfSBmLnBhcmVudE5vZGUgJiYgZi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGYpIH0gcmV0dXJuIHRoaXMgfSwgZW1wdHk6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZm9yICh2YXIgYSA9IDAsIGI7IChiID0gdGhpc1thXSkgIT0gbnVsbDsgYSsrKSBmb3IgKGIubm9kZVR5cGUgPT09IDEgJiYgYy5jbGVhbkRhdGEoYi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKTsgYi5maXJzdENoaWxkOyApIGIucmVtb3ZlQ2hpbGQoYi5maXJzdENoaWxkKTsNCiAgICAgICAgcmV0dXJuIHRoaXMNCiAgICB9LCBjbG9uZTogZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSB0aGlzLm1hcChmdW5jdGlvbiAoKSB7IGlmICghYy5zdXBwb3J0Lm5vQ2xvbmVFdmVudCAmJiAhYy5pc1hNTERvYyh0aGlzKSkgeyB2YXIgZCA9IHRoaXMub3V0ZXJIVE1MLCBmID0gdGhpcy5vd25lckRvY3VtZW50OyBpZiAoIWQpIHsgZCA9IGYuY3JlYXRlRWxlbWVudCgiZGl2Iik7IGQuYXBwZW5kQ2hpbGQodGhpcy5jbG9uZU5vZGUodHJ1ZSkpOyBkID0gZC5pbm5lckhUTUwgfSByZXR1cm4gYy5jbGVhbihbZC5yZXBsYWNlKEphLCAiIikucmVwbGFjZSgvPShbXj0iJz5cc10rXC8pPi9nLCAnPSIkMSI+JykucmVwbGFjZShWLCAiIildLCBmKVswXSB9IGVsc2UgcmV0dXJuIHRoaXMuY2xvbmVOb2RlKHRydWUpIH0pOyBpZiAoYSA9PT0gdHJ1ZSkgeyByYSh0aGlzLCBiKTsgcmEodGhpcy5maW5kKCIqIiksIGIuZmluZCgiKiIpKSB9IHJldHVybiBiIH0sIGh0bWw6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGlmIChhID09PSB3KSByZXR1cm4gdGhpc1swXSAmJiB0aGlzWzBdLm5vZGVUeXBlID09PSAxID8gdGhpc1swXS5pbm5lckhUTUwucmVwbGFjZShKYSwNCiIiKSA6IG51bGw7IGVsc2UgaWYgKHR5cGVvZiBhID09PSAic3RyaW5nIiAmJiAhdGEudGVzdChhKSAmJiAoYy5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlIHx8ICFWLnRlc3QoYSkpICYmICFGWyhMYS5leGVjKGEpIHx8IFsiIiwgIiJdKVsxXS50b0xvd2VyQ2FzZSgpXSkgeyBhID0gYS5yZXBsYWNlKEthLCBNYSk7IHRyeSB7IGZvciAodmFyIGIgPSAwLCBkID0gdGhpcy5sZW5ndGg7IGIgPCBkOyBiKyspIGlmICh0aGlzW2JdLm5vZGVUeXBlID09PSAxKSB7IGMuY2xlYW5EYXRhKHRoaXNbYl0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSk7IHRoaXNbYl0uaW5uZXJIVE1MID0gYSB9IH0gY2F0Y2ggKGYpIHsgdGhpcy5lbXB0eSgpLmFwcGVuZChhKSB9IH0gZWxzZSBjLmlzRnVuY3Rpb24oYSkgPyB0aGlzLmVhY2goZnVuY3Rpb24gKGUpIHsgdmFyIGogPSBjKHRoaXMpLCBpID0gai5odG1sKCk7IGouZW1wdHkoKS5hcHBlbmQoZnVuY3Rpb24gKCkgeyByZXR1cm4gYS5jYWxsKHRoaXMsIGUsIGkpIH0pIH0pIDogdGhpcy5lbXB0eSgpLmFwcGVuZChhKTsgcmV0dXJuIHRoaXMNCiAgICB9LCByZXBsYWNlV2l0aDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgaWYgKHRoaXNbMF0gJiYNCnRoaXNbMF0ucGFyZW50Tm9kZSkgeyBpZiAoYy5pc0Z1bmN0aW9uKGEpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChiKSB7IHZhciBkID0gYyh0aGlzKSwgZiA9IGQuaHRtbCgpOyBkLnJlcGxhY2VXaXRoKGEuY2FsbCh0aGlzLCBiLCBmKSkgfSk7IGlmICh0eXBlb2YgYSAhPT0gInN0cmluZyIpIGEgPSBjKGEpLmRldGFjaCgpOyByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGIgPSB0aGlzLm5leHRTaWJsaW5nLCBkID0gdGhpcy5wYXJlbnROb2RlOyBjKHRoaXMpLnJlbW92ZSgpOyBiID8gYyhiKS5iZWZvcmUoYSkgOiBjKGQpLmFwcGVuZChhKSB9KSB9IGVsc2UgcmV0dXJuIHRoaXMucHVzaFN0YWNrKGMoYy5pc0Z1bmN0aW9uKGEpID8gYSgpIDogYSksICJyZXBsYWNlV2l0aCIsIGEpDQogICAgfSwgZGV0YWNoOiBmdW5jdGlvbiAoYSkgeyByZXR1cm4gdGhpcy5yZW1vdmUoYSwgdHJ1ZSkgfSwgZG9tTWFuaXA6IGZ1bmN0aW9uIChhLCBiLCBkKSB7DQogICAgICAgIGZ1bmN0aW9uIGYodSkgew0KICAgICAgICAgICAgcmV0dXJuIGMubm9kZU5hbWUodSwgInRhYmxlIikgPyB1LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdIHx8DQp1LmFwcGVuZENoaWxkKHUub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpKSA6IHUNCiAgICAgICAgfSB2YXIgZSwgaiwgaSA9IGFbMF0sIG8gPSBbXSwgazsgaWYgKCFjLnN1cHBvcnQuY2hlY2tDbG9uZSAmJiBhcmd1bWVudHMubGVuZ3RoID09PSAzICYmIHR5cGVvZiBpID09PSAic3RyaW5nIiAmJiB1YS50ZXN0KGkpKSByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgYyh0aGlzKS5kb21NYW5pcChhLCBiLCBkLCB0cnVlKSB9KTsgaWYgKGMuaXNGdW5jdGlvbihpKSkgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAodSkgeyB2YXIgeiA9IGModGhpcyk7IGFbMF0gPSBpLmNhbGwodGhpcywgdSwgYiA/IHouaHRtbCgpIDogdyk7IHouZG9tTWFuaXAoYSwgYiwgZCkgfSk7IGlmICh0aGlzWzBdKSB7DQogICAgICAgICAgICBlID0gaSAmJiBpLnBhcmVudE5vZGU7IGUgPSBjLnN1cHBvcnQucGFyZW50Tm9kZSAmJiBlICYmIGUubm9kZVR5cGUgPT09IDExICYmIGUuY2hpbGROb2Rlcy5sZW5ndGggPT09IHRoaXMubGVuZ3RoID8geyBmcmFnbWVudDogZX0gOiBzYShhLCB0aGlzLCBvKTsgayA9IGUuZnJhZ21lbnQ7IGlmIChqID0gay5jaGlsZE5vZGVzLmxlbmd0aCA9PT0NCjEgPyAoayA9IGsuZmlyc3RDaGlsZCkgOiBrLmZpcnN0Q2hpbGQpIHsgYiA9IGIgJiYgYy5ub2RlTmFtZShqLCAidHIiKTsgZm9yICh2YXIgbiA9IDAsIHIgPSB0aGlzLmxlbmd0aDsgbiA8IHI7IG4rKykgZC5jYWxsKGIgPyBmKHRoaXNbbl0sIGopIDogdGhpc1tuXSwgbiA+IDAgfHwgZS5jYWNoZWFibGUgfHwgdGhpcy5sZW5ndGggPiAxID8gay5jbG9uZU5vZGUodHJ1ZSkgOiBrKSB9IG8ubGVuZ3RoICYmIGMuZWFjaChvLCBRYSkNCiAgICAgICAgfSByZXR1cm4gdGhpcw0KICAgIH0gDQp9KTsgYy5mcmFnbWVudHMgPSB7fTsgYy5lYWNoKHsgYXBwZW5kVG86ICJhcHBlbmQiLCBwcmVwZW5kVG86ICJwcmVwZW5kIiwgaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwgaW5zZXJ0QWZ0ZXI6ICJhZnRlciIsIHJlcGxhY2VBbGw6ICJyZXBsYWNlV2l0aCIgfSwgZnVuY3Rpb24gKGEsIGIpIHsNCiAgICBjLmZuW2FdID0gZnVuY3Rpb24gKGQpIHsNCiAgICAgICAgdmFyIGYgPSBbXTsgZCA9IGMoZCk7IHZhciBlID0gdGhpcy5sZW5ndGggPT09IDEgJiYgdGhpc1swXS5wYXJlbnROb2RlOyBpZiAoZSAmJiBlLm5vZGVUeXBlID09PSAxMSAmJiBlLmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICYmIGQubGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICBkW2JdKHRoaXNbMF0pOw0KICAgICAgICAgICAgcmV0dXJuIHRoaXMNCiAgICAgICAgfSBlbHNlIHsgZSA9IDA7IGZvciAodmFyIGogPSBkLmxlbmd0aDsgZSA8IGo7IGUrKykgeyB2YXIgaSA9IChlID4gMCA/IHRoaXMuY2xvbmUodHJ1ZSkgOiB0aGlzKS5nZXQoKTsgYy5mbltiXS5hcHBseShjKGRbZV0pLCBpKTsgZiA9IGYuY29uY2F0KGkpIH0gcmV0dXJuIHRoaXMucHVzaFN0YWNrKGYsIGEsIGQuc2VsZWN0b3IpIH0gDQogICAgfSANCn0pOyBjLmV4dGVuZCh7IGNsZWFuOiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgew0KICAgIGIgPSBiIHx8IHM7IGlmICh0eXBlb2YgYi5jcmVhdGVFbGVtZW50ID09PSAidW5kZWZpbmVkIikgYiA9IGIub3duZXJEb2N1bWVudCB8fCBiWzBdICYmIGJbMF0ub3duZXJEb2N1bWVudCB8fCBzOyBmb3IgKHZhciBlID0gW10sIGogPSAwLCBpOyAoaSA9IGFbal0pICE9IG51bGw7IGorKykgew0KICAgICAgICBpZiAodHlwZW9mIGkgPT09ICJudW1iZXIiKSBpICs9ICIiOyBpZiAoaSkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBpID09PSAic3RyaW5nIiAmJiAhamIudGVzdChpKSkgaSA9IGIuY3JlYXRlVGV4dE5vZGUoaSk7IGVsc2UgaWYgKHR5cGVvZiBpID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgIGkgPSBpLnJlcGxhY2UoS2EsIE1hKTsgdmFyIG8gPSAoTGEuZXhlYyhpKSB8fCBbIiIsDQoiIl0pWzFdLnRvTG93ZXJDYXNlKCksIGsgPSBGW29dIHx8IEYuX2RlZmF1bHQsIG4gPSBrWzBdLCByID0gYi5jcmVhdGVFbGVtZW50KCJkaXYiKTsgZm9yIChyLmlubmVySFRNTCA9IGtbMV0gKyBpICsga1syXTsgbi0tOyApIHIgPSByLmxhc3RDaGlsZDsgaWYgKCFjLnN1cHBvcnQudGJvZHkpIHsgbiA9IGliLnRlc3QoaSk7IG8gPSBvID09PSAidGFibGUiICYmICFuID8gci5maXJzdENoaWxkICYmIHIuZmlyc3RDaGlsZC5jaGlsZE5vZGVzIDoga1sxXSA9PT0gIjx0YWJsZT4iICYmICFuID8gci5jaGlsZE5vZGVzIDogW107IGZvciAoayA9IG8ubGVuZ3RoIC0gMTsgayA+PSAwOyAtLWspIGMubm9kZU5hbWUob1trXSwgInRib2R5IikgJiYgIW9ba10uY2hpbGROb2Rlcy5sZW5ndGggJiYgb1trXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9ba10pIH0gIWMuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSAmJiBWLnRlc3QoaSkgJiYgci5pbnNlcnRCZWZvcmUoYi5jcmVhdGVUZXh0Tm9kZShWLmV4ZWMoaSlbMF0pLCByLmZpcnN0Q2hpbGQpOyBpID0gci5jaGlsZE5vZGVzDQogICAgICAgICAgICB9IGlmIChpLm5vZGVUeXBlKSBlLnB1c2goaSk7IGVsc2UgZSA9DQpjLm1lcmdlKGUsIGkpDQogICAgICAgIH0gDQogICAgfSBpZiAoZCkgZm9yIChqID0gMDsgZVtqXTsgaisrKSBpZiAoZiAmJiBjLm5vZGVOYW1lKGVbal0sICJzY3JpcHQiKSAmJiAoIWVbal0udHlwZSB8fCBlW2pdLnR5cGUudG9Mb3dlckNhc2UoKSA9PT0gInRleHQvamF2YXNjcmlwdCIpKSBmLnB1c2goZVtqXS5wYXJlbnROb2RlID8gZVtqXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVbal0pIDogZVtqXSk7IGVsc2UgeyBlW2pdLm5vZGVUeXBlID09PSAxICYmIGUuc3BsaWNlLmFwcGx5KGUsIFtqICsgMSwgMF0uY29uY2F0KGMubWFrZUFycmF5KGVbal0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpKSkpOyBkLmFwcGVuZENoaWxkKGVbal0pIH0gcmV0dXJuIGUNCn0sIGNsZWFuRGF0YTogZnVuY3Rpb24gKGEpIHsNCiAgICBmb3IgKHZhciBiLCBkLCBmID0gYy5jYWNoZSwgZSA9IGMuZXZlbnQuc3BlY2lhbCwgaiA9IGMuc3VwcG9ydC5kZWxldGVFeHBhbmRvLCBpID0gMCwgbzsgKG8gPSBhW2ldKSAhPSBudWxsOyBpKyspIGlmIChkID0gb1tjLmV4cGFuZG9dKSB7DQogICAgICAgIGIgPSBmW2RdOyBpZiAoYi5ldmVudHMpIGZvciAodmFyIGsgaW4gYi5ldmVudHMpIGVba10gPw0KYy5ldmVudC5yZW1vdmUobywgaykgOiBDYShvLCBrLCBiLmhhbmRsZSk7IGlmIChqKSBkZWxldGUgb1tjLmV4cGFuZG9dOyBlbHNlIG8ucmVtb3ZlQXR0cmlidXRlICYmIG8ucmVtb3ZlQXR0cmlidXRlKGMuZXhwYW5kbyk7IGRlbGV0ZSBmW2RdDQogICAgfSANCn0gDQp9KTsgdmFyIGtiID0gL3otP2luZGV4fGZvbnQtP3dlaWdodHxvcGFjaXR5fHpvb218bGluZS0/aGVpZ2h0L2ksIE5hID0gL2FscGhhXChbXildKlwpLywgT2EgPSAvb3BhY2l0eT0oW14pXSopLywgaGEgPSAvZmxvYXQvaSwgaWEgPSAvLShbYS16XSkvaWcsIGxiID0gLyhbQS1aXSkvZywgbWIgPSAvXi0/XGQrKD86cHgpPyQvaSwgbmIgPSAvXi0/XGQvLCBvYiA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sIHBiID0gWyJMZWZ0IiwgIlJpZ2h0Il0sIHFiID0gWyJUb3AiLCAiQm90dG9tIl0sIHJiID0gcy5kZWZhdWx0VmlldyAmJiBzLmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUsIFBhID0gYy5zdXBwb3J0LmNzc0Zsb2F0ID8gImNzc0Zsb2F0IiA6ICJzdHlsZUZsb2F0IiwgamEgPQ0KZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGIudG9VcHBlckNhc2UoKSB9OyBjLmZuLmNzcyA9IGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBYKHRoaXMsIGEsIGIsIHRydWUsIGZ1bmN0aW9uIChkLCBmLCBlKSB7IGlmIChlID09PSB3KSByZXR1cm4gYy5jdXJDU1MoZCwgZik7IGlmICh0eXBlb2YgZSA9PT0gIm51bWJlciIgJiYgIWtiLnRlc3QoZikpIGUgKz0gInB4IjsgYy5zdHlsZShkLCBmLCBlKSB9KSB9OyBjLmV4dGVuZCh7IHN0eWxlOiBmdW5jdGlvbiAoYSwgYiwgZCkgew0KICAgIGlmICghYSB8fCBhLm5vZGVUeXBlID09PSAzIHx8IGEubm9kZVR5cGUgPT09IDgpIHJldHVybiB3OyBpZiAoKGIgPT09ICJ3aWR0aCIgfHwgYiA9PT0gImhlaWdodCIpICYmIHBhcnNlRmxvYXQoZCkgPCAwKSBkID0gdzsgdmFyIGYgPSBhLnN0eWxlIHx8IGEsIGUgPSBkICE9PSB3OyBpZiAoIWMuc3VwcG9ydC5vcGFjaXR5ICYmIGIgPT09ICJvcGFjaXR5Iikgew0KICAgICAgICBpZiAoZSkgew0KICAgICAgICAgICAgZi56b29tID0gMTsgYiA9IHBhcnNlSW50KGQsIDEwKSArICIiID09PSAiTmFOIiA/ICIiIDogImFscGhhKG9wYWNpdHk9IiArIGQgKiAxMDAgKyAiKSI7IGEgPSBmLmZpbHRlciB8fCBjLmN1ckNTUyhhLCAiZmlsdGVyIikgfHwgIiI7IGYuZmlsdGVyID0NCk5hLnRlc3QoYSkgPyBhLnJlcGxhY2UoTmEsIGIpIDogYg0KICAgICAgICB9IHJldHVybiBmLmZpbHRlciAmJiBmLmZpbHRlci5pbmRleE9mKCJvcGFjaXR5PSIpID49IDAgPyBwYXJzZUZsb2F0KE9hLmV4ZWMoZi5maWx0ZXIpWzFdKSAvIDEwMCArICIiIDogIiINCiAgICB9IGlmIChoYS50ZXN0KGIpKSBiID0gUGE7IGIgPSBiLnJlcGxhY2UoaWEsIGphKTsgaWYgKGUpIGZbYl0gPSBkOyByZXR1cm4gZltiXQ0KfSwgY3NzOiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgew0KICAgIGlmIChiID09PSAid2lkdGgiIHx8IGIgPT09ICJoZWlnaHQiKSB7DQogICAgICAgIHZhciBlLCBqID0gYiA9PT0gIndpZHRoIiA/IHBiIDogcWI7IGZ1bmN0aW9uIGkoKSB7DQogICAgICAgICAgICBlID0gYiA9PT0gIndpZHRoIiA/IGEub2Zmc2V0V2lkdGggOiBhLm9mZnNldEhlaWdodDsgZiAhPT0gImJvcmRlciIgJiYgYy5lYWNoKGosIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBmIHx8IChlIC09IHBhcnNlRmxvYXQoYy5jdXJDU1MoYSwgInBhZGRpbmciICsgdGhpcywgdHJ1ZSkpIHx8IDApOyBpZiAoZiA9PT0gIm1hcmdpbiIpIGUgKz0gcGFyc2VGbG9hdChjLmN1ckNTUyhhLCAibWFyZ2luIiArIHRoaXMsIHRydWUpKSB8fCAwOyBlbHNlIGUgLT0gcGFyc2VGbG9hdChjLmN1ckNTUyhhLA0KImJvcmRlciIgKyB0aGlzICsgIldpZHRoIiwgdHJ1ZSkpIHx8IDANCiAgICAgICAgICAgIH0pDQogICAgICAgIH0gYS5vZmZzZXRXaWR0aCAhPT0gMCA/IGkoKSA6IGMuc3dhcChhLCBvYiwgaSk7IHJldHVybiBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKGUpKQ0KICAgIH0gcmV0dXJuIGMuY3VyQ1NTKGEsIGIsIGQpDQp9LCBjdXJDU1M6IGZ1bmN0aW9uIChhLCBiLCBkKSB7DQogICAgdmFyIGYsIGUgPSBhLnN0eWxlOyBpZiAoIWMuc3VwcG9ydC5vcGFjaXR5ICYmIGIgPT09ICJvcGFjaXR5IiAmJiBhLmN1cnJlbnRTdHlsZSkgeyBmID0gT2EudGVzdChhLmN1cnJlbnRTdHlsZS5maWx0ZXIgfHwgIiIpID8gcGFyc2VGbG9hdChSZWdFeHAuJDEpIC8gMTAwICsgIiIgOiAiIjsgcmV0dXJuIGYgPT09ICIiID8gIjEiIDogZiB9IGlmIChoYS50ZXN0KGIpKSBiID0gUGE7IGlmICghZCAmJiBlICYmIGVbYl0pIGYgPSBlW2JdOyBlbHNlIGlmIChyYikgew0KICAgICAgICBpZiAoaGEudGVzdChiKSkgYiA9ICJmbG9hdCI7IGIgPSBiLnJlcGxhY2UobGIsICItJDEiKS50b0xvd2VyQ2FzZSgpOyBlID0gYS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3OyBpZiAoIWUpIHJldHVybiBudWxsOyBpZiAoYSA9IGUuZ2V0Q29tcHV0ZWRTdHlsZShhLCBudWxsKSkgZiA9DQphLmdldFByb3BlcnR5VmFsdWUoYik7IGlmIChiID09PSAib3BhY2l0eSIgJiYgZiA9PT0gIiIpIGYgPSAiMSINCiAgICB9IGVsc2UgaWYgKGEuY3VycmVudFN0eWxlKSB7IGQgPSBiLnJlcGxhY2UoaWEsIGphKTsgZiA9IGEuY3VycmVudFN0eWxlW2JdIHx8IGEuY3VycmVudFN0eWxlW2RdOyBpZiAoIW1iLnRlc3QoZikgJiYgbmIudGVzdChmKSkgeyBiID0gZS5sZWZ0OyB2YXIgaiA9IGEucnVudGltZVN0eWxlLmxlZnQ7IGEucnVudGltZVN0eWxlLmxlZnQgPSBhLmN1cnJlbnRTdHlsZS5sZWZ0OyBlLmxlZnQgPSBkID09PSAiZm9udFNpemUiID8gIjFlbSIgOiBmIHx8IDA7IGYgPSBlLnBpeGVsTGVmdCArICJweCI7IGUubGVmdCA9IGI7IGEucnVudGltZVN0eWxlLmxlZnQgPSBqIH0gfSByZXR1cm4gZg0KfSwgc3dhcDogZnVuY3Rpb24gKGEsIGIsIGQpIHsgdmFyIGYgPSB7fTsgZm9yICh2YXIgZSBpbiBiKSB7IGZbZV0gPSBhLnN0eWxlW2VdOyBhLnN0eWxlW2VdID0gYltlXSB9IGQuY2FsbChhKTsgZm9yIChlIGluIGIpIGEuc3R5bGVbZV0gPSBmW2VdIH0gDQp9KTsgaWYgKGMuZXhwciAmJiBjLmV4cHIuZmlsdGVycykgew0KICAgICAgICBjLmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgdmFyIGIgPQ0KYS5vZmZzZXRXaWR0aCwgZCA9IGEub2Zmc2V0SGVpZ2h0LCBmID0gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAidHIiOyByZXR1cm4gYiA9PT0gMCAmJiBkID09PSAwICYmICFmID8gdHJ1ZSA6IGIgPiAwICYmIGQgPiAwICYmICFmID8gZmFsc2UgOiBjLmN1ckNTUyhhLCAiZGlzcGxheSIpID09PSAibm9uZSINCiAgICAgICAgfTsgYy5leHByLmZpbHRlcnMudmlzaWJsZSA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiAhYy5leHByLmZpbHRlcnMuaGlkZGVuKGEpIH0gDQogICAgfSB2YXIgc2IgPSBKKCksIHRiID0gLzxzY3JpcHQoLnxccykqP1wvc2NyaXB0Pi9naSwgdWIgPSAvc2VsZWN0fHRleHRhcmVhL2ksIHZiID0gL2NvbG9yfGRhdGV8ZGF0ZXRpbWV8ZW1haWx8aGlkZGVufG1vbnRofG51bWJlcnxwYXNzd29yZHxyYW5nZXxzZWFyY2h8dGVsfHRleHR8dGltZXx1cmx8d2Vlay9pLCBOID0gLz1cPygmfCQpLywga2EgPSAvXD8vLCB3YiA9IC8oXD98JilfPS4qPygmfCQpLywgeGIgPSAvXihcdys6KT9cL1wvKFteXC8/I10rKS8sIHliID0gLyUyMC9nLCB6YiA9IGMuZm4ubG9hZDsgYy5mbi5leHRlbmQoeyBsb2FkOiBmdW5jdGlvbiAoYSwgYiwgZCkgew0KICAgICAgICBpZiAodHlwZW9mIGEgIT09DQoic3RyaW5nIikgcmV0dXJuIHpiLmNhbGwodGhpcywgYSk7IGVsc2UgaWYgKCF0aGlzLmxlbmd0aCkgcmV0dXJuIHRoaXM7IHZhciBmID0gYS5pbmRleE9mKCIgIik7IGlmIChmID49IDApIHsgdmFyIGUgPSBhLnNsaWNlKGYsIGEubGVuZ3RoKTsgYSA9IGEuc2xpY2UoMCwgZikgfSBmID0gIkdFVCI7IGlmIChiKSBpZiAoYy5pc0Z1bmN0aW9uKGIpKSB7IGQgPSBiOyBiID0gbnVsbCB9IGVsc2UgaWYgKHR5cGVvZiBiID09PSAib2JqZWN0IikgeyBiID0gYy5wYXJhbShiLCBjLmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbCk7IGYgPSAiUE9TVCIgfSB2YXIgaiA9IHRoaXM7IGMuYWpheCh7IHVybDogYSwgdHlwZTogZiwgZGF0YVR5cGU6ICJodG1sIiwgZGF0YTogYiwgY29tcGxldGU6IGZ1bmN0aW9uIChpLCBvKSB7IGlmIChvID09PSAic3VjY2VzcyIgfHwgbyA9PT0gIm5vdG1vZGlmaWVkIikgai5odG1sKGUgPyBjKCI8ZGl2IC8+IikuYXBwZW5kKGkucmVzcG9uc2VUZXh0LnJlcGxhY2UodGIsICIiKSkuZmluZChlKSA6IGkucmVzcG9uc2VUZXh0KTsgZCAmJiBqLmVhY2goZCwgW2kucmVzcG9uc2VUZXh0LCBvLCBpXSkgfSB9KTsgcmV0dXJuIHRoaXMNCiAgICB9LA0KICAgICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGMucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKSB9LCBzZXJpYWxpemVBcnJheTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5lbGVtZW50cyA/IGMubWFrZUFycmF5KHRoaXMuZWxlbWVudHMpIDogdGhpcyB9KS5maWx0ZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5uYW1lICYmICF0aGlzLmRpc2FibGVkICYmICh0aGlzLmNoZWNrZWQgfHwgdWIudGVzdCh0aGlzLm5vZGVOYW1lKSB8fCB2Yi50ZXN0KHRoaXMudHlwZSkpIH0pLm1hcChmdW5jdGlvbiAoYSwgYikgeyBhID0gYyh0aGlzKS52YWwoKTsgcmV0dXJuIGEgPT0gbnVsbCA/IG51bGwgOiBjLmlzQXJyYXkoYSkgPyBjLm1hcChhLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geyBuYW1lOiBiLm5hbWUsIHZhbHVlOiBkfSB9KSA6IHsgbmFtZTogYi5uYW1lLCB2YWx1ZTogYX0gfSkuZ2V0KCkgfSANCiAgICB9KTsgYy5lYWNoKCJhamF4U3RhcnQgYWpheFN0b3AgYWpheENvbXBsZXRlIGFqYXhFcnJvciBhamF4U3VjY2VzcyBhamF4U2VuZCIuc3BsaXQoIiAiKSwNCmZ1bmN0aW9uIChhLCBiKSB7IGMuZm5bYl0gPSBmdW5jdGlvbiAoZCkgeyByZXR1cm4gdGhpcy5iaW5kKGIsIGQpIH0gfSk7IGMuZXh0ZW5kKHsgZ2V0OiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgeyBpZiAoYy5pc0Z1bmN0aW9uKGIpKSB7IGYgPSBmIHx8IGQ7IGQgPSBiOyBiID0gbnVsbCB9IHJldHVybiBjLmFqYXgoeyB0eXBlOiAiR0VUIiwgdXJsOiBhLCBkYXRhOiBiLCBzdWNjZXNzOiBkLCBkYXRhVHlwZTogZiB9KSB9LCBnZXRTY3JpcHQ6IGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBjLmdldChhLCBudWxsLCBiLCAic2NyaXB0IikgfSwgZ2V0SlNPTjogZnVuY3Rpb24gKGEsIGIsIGQpIHsgcmV0dXJuIGMuZ2V0KGEsIGIsIGQsICJqc29uIikgfSwgcG9zdDogZnVuY3Rpb24gKGEsIGIsIGQsIGYpIHsgaWYgKGMuaXNGdW5jdGlvbihiKSkgeyBmID0gZiB8fCBkOyBkID0gYjsgYiA9IHt9IH0gcmV0dXJuIGMuYWpheCh7IHR5cGU6ICJQT1NUIiwgdXJsOiBhLCBkYXRhOiBiLCBzdWNjZXNzOiBkLCBkYXRhVHlwZTogZiB9KSB9LCBhamF4U2V0dXA6IGZ1bmN0aW9uIChhKSB7IGMuZXh0ZW5kKGMuYWpheFNldHRpbmdzLCBhKSB9LCBhamF4U2V0dGluZ3M6IHsgdXJsOiBsb2NhdGlvbi5ocmVmLA0KICAgIGdsb2JhbDogdHJ1ZSwgdHlwZTogIkdFVCIsIGNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwgcHJvY2Vzc0RhdGE6IHRydWUsIGFzeW5jOiB0cnVlLCB4aHI6IEEuWE1MSHR0cFJlcXVlc3QgJiYgKEEubG9jYXRpb24ucHJvdG9jb2wgIT09ICJmaWxlOiIgfHwgIUEuQWN0aXZlWE9iamVjdCkgPyBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgQS5YTUxIdHRwUmVxdWVzdCB9IDogZnVuY3Rpb24gKCkgeyB0cnkgeyByZXR1cm4gbmV3IEEuQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKSB9IGNhdGNoIChhKSB7IH0gfSwgYWNjZXB0czogeyB4bWw6ICJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIiwgaHRtbDogInRleHQvaHRtbCIsIHNjcmlwdDogInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCIsIGpzb246ICJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQiLCB0ZXh0OiAidGV4dC9wbGFpbiIsIF9kZWZhdWx0OiAiKi8qIn0NCn0sIGxhc3RNb2RpZmllZDoge30sIGV0YWc6IHt9LCBhamF4OiBmdW5jdGlvbiAoYSkgew0KICAgIGZ1bmN0aW9uIGIoKSB7DQogICAgICAgIGUuc3VjY2VzcyAmJg0KZS5zdWNjZXNzLmNhbGwoaywgbywgaSwgeCk7IGUuZ2xvYmFsICYmIGYoImFqYXhTdWNjZXNzIiwgW3gsIGVdKQ0KICAgIH0gZnVuY3Rpb24gZCgpIHsgZS5jb21wbGV0ZSAmJiBlLmNvbXBsZXRlLmNhbGwoaywgeCwgaSk7IGUuZ2xvYmFsICYmIGYoImFqYXhDb21wbGV0ZSIsIFt4LCBlXSk7IGUuZ2xvYmFsICYmICEgLS1jLmFjdGl2ZSAmJiBjLmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIikgfSBmdW5jdGlvbiBmKHEsIHApIHsgKGUuY29udGV4dCA/IGMoZS5jb250ZXh0KSA6IGMuZXZlbnQpLnRyaWdnZXIocSwgcCkgfSB2YXIgZSA9IGMuZXh0ZW5kKHRydWUsIHt9LCBjLmFqYXhTZXR0aW5ncywgYSksIGosIGksIG8sIGsgPSBhICYmIGEuY29udGV4dCB8fCBlLCBuID0gZS50eXBlLnRvVXBwZXJDYXNlKCk7IGlmIChlLmRhdGEgJiYgZS5wcm9jZXNzRGF0YSAmJiB0eXBlb2YgZS5kYXRhICE9PSAic3RyaW5nIikgZS5kYXRhID0gYy5wYXJhbShlLmRhdGEsIGUudHJhZGl0aW9uYWwpOyBpZiAoZS5kYXRhVHlwZSA9PT0gImpzb25wIikgew0KICAgICAgICBpZiAobiA9PT0gIkdFVCIpIE4udGVzdChlLnVybCkgfHwgKGUudXJsICs9IChrYS50ZXN0KGUudXJsKSA/DQoiJiIgOiAiPyIpICsgKGUuanNvbnAgfHwgImNhbGxiYWNrIikgKyAiPT8iKTsgZWxzZSBpZiAoIWUuZGF0YSB8fCAhTi50ZXN0KGUuZGF0YSkpIGUuZGF0YSA9IChlLmRhdGEgPyBlLmRhdGEgKyAiJiIgOiAiIikgKyAoZS5qc29ucCB8fCAiY2FsbGJhY2siKSArICI9PyI7IGUuZGF0YVR5cGUgPSAianNvbiINCiAgICB9IGlmIChlLmRhdGFUeXBlID09PSAianNvbiIgJiYgKGUuZGF0YSAmJiBOLnRlc3QoZS5kYXRhKSB8fCBOLnRlc3QoZS51cmwpKSkgeyBqID0gZS5qc29ucENhbGxiYWNrIHx8ICJqc29ucCIgKyBzYisrOyBpZiAoZS5kYXRhKSBlLmRhdGEgPSAoZS5kYXRhICsgIiIpLnJlcGxhY2UoTiwgIj0iICsgaiArICIkMSIpOyBlLnVybCA9IGUudXJsLnJlcGxhY2UoTiwgIj0iICsgaiArICIkMSIpOyBlLmRhdGFUeXBlID0gInNjcmlwdCI7IEFbal0gPSBBW2pdIHx8IGZ1bmN0aW9uIChxKSB7IG8gPSBxOyBiKCk7IGQoKTsgQVtqXSA9IHc7IHRyeSB7IGRlbGV0ZSBBW2pdIH0gY2F0Y2ggKHApIHsgfSB6ICYmIHoucmVtb3ZlQ2hpbGQoQykgfSB9IGlmIChlLmRhdGFUeXBlID09PSAic2NyaXB0IiAmJiBlLmNhY2hlID09PSBudWxsKSBlLmNhY2hlID0gZmFsc2U7IGlmIChlLmNhY2hlID09PQ0KZmFsc2UgJiYgbiA9PT0gIkdFVCIpIHsgdmFyIHIgPSBKKCksIHUgPSBlLnVybC5yZXBsYWNlKHdiLCAiJDFfPSIgKyByICsgIiQyIik7IGUudXJsID0gdSArICh1ID09PSBlLnVybCA/IChrYS50ZXN0KGUudXJsKSA/ICImIiA6ICI/IikgKyAiXz0iICsgciA6ICIiKSB9IGlmIChlLmRhdGEgJiYgbiA9PT0gIkdFVCIpIGUudXJsICs9IChrYS50ZXN0KGUudXJsKSA/ICImIiA6ICI/IikgKyBlLmRhdGE7IGUuZ2xvYmFsICYmICFjLmFjdGl2ZSsrICYmIGMuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7IHIgPSAociA9IHhiLmV4ZWMoZS51cmwpKSAmJiAoclsxXSAmJiByWzFdICE9PSBsb2NhdGlvbi5wcm90b2NvbCB8fCByWzJdICE9PSBsb2NhdGlvbi5ob3N0KTsgaWYgKGUuZGF0YVR5cGUgPT09ICJzY3JpcHQiICYmIG4gPT09ICJHRVQiICYmIHIpIHsNCiAgICAgICAgdmFyIHogPSBzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF0gfHwgcy5kb2N1bWVudEVsZW1lbnQsIEMgPSBzLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOyBDLnNyYyA9IGUudXJsOyBpZiAoZS5zY3JpcHRDaGFyc2V0KSBDLmNoYXJzZXQgPSBlLnNjcmlwdENoYXJzZXQ7IGlmICghaikgew0KICAgICAgICAgICAgdmFyIEIgPQ0KZmFsc2U7IEMub25sb2FkID0gQy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7IGlmICghQiAmJiAoIXRoaXMucmVhZHlTdGF0ZSB8fCB0aGlzLnJlYWR5U3RhdGUgPT09ICJsb2FkZWQiIHx8IHRoaXMucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIikpIHsgQiA9IHRydWU7IGIoKTsgZCgpOyBDLm9ubG9hZCA9IEMub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsgeiAmJiBDLnBhcmVudE5vZGUgJiYgei5yZW1vdmVDaGlsZChDKSB9IH0gDQogICAgICAgIH0gei5pbnNlcnRCZWZvcmUoQywgei5maXJzdENoaWxkKTsgcmV0dXJuIHcNCiAgICB9IHZhciBFID0gZmFsc2UsIHggPSBlLnhocigpOyBpZiAoeCkgew0KICAgICAgICBlLnVzZXJuYW1lID8geC5vcGVuKG4sIGUudXJsLCBlLmFzeW5jLCBlLnVzZXJuYW1lLCBlLnBhc3N3b3JkKSA6IHgub3BlbihuLCBlLnVybCwgZS5hc3luYyk7IHRyeSB7DQogICAgICAgICAgICBpZiAoZS5kYXRhIHx8IGEgJiYgYS5jb250ZW50VHlwZSkgeC5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCBlLmNvbnRlbnRUeXBlKTsgaWYgKGUuaWZNb2RpZmllZCkgew0KICAgICAgICAgICAgICAgIGMubGFzdE1vZGlmaWVkW2UudXJsXSAmJiB4LnNldFJlcXVlc3RIZWFkZXIoIklmLU1vZGlmaWVkLVNpbmNlIiwNCmMubGFzdE1vZGlmaWVkW2UudXJsXSk7IGMuZXRhZ1tlLnVybF0gJiYgeC5zZXRSZXF1ZXN0SGVhZGVyKCJJZi1Ob25lLU1hdGNoIiwgYy5ldGFnW2UudXJsXSkNCiAgICAgICAgICAgIH0gciB8fCB4LnNldFJlcXVlc3RIZWFkZXIoIlgtUmVxdWVzdGVkLVdpdGgiLCAiWE1MSHR0cFJlcXVlc3QiKTsgeC5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLCBlLmRhdGFUeXBlICYmIGUuYWNjZXB0c1tlLmRhdGFUeXBlXSA/IGUuYWNjZXB0c1tlLmRhdGFUeXBlXSArICIsICovKiIgOiBlLmFjY2VwdHMuX2RlZmF1bHQpDQogICAgICAgIH0gY2F0Y2ggKGdhKSB7IH0gaWYgKGUuYmVmb3JlU2VuZCAmJiBlLmJlZm9yZVNlbmQuY2FsbChrLCB4LCBlKSA9PT0gZmFsc2UpIHsgZS5nbG9iYWwgJiYgISAtLWMuYWN0aXZlICYmIGMuZXZlbnQudHJpZ2dlcigiYWpheFN0b3AiKTsgeC5hYm9ydCgpOyByZXR1cm4gZmFsc2UgfSBlLmdsb2JhbCAmJiBmKCJhamF4U2VuZCIsIFt4LCBlXSk7IHZhciBnID0geC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAocSkgew0KICAgICAgICAgICAgaWYgKCF4IHx8IHgucmVhZHlTdGF0ZSA9PT0gMCB8fCBxID09PSAiYWJvcnQiKSB7DQogICAgICAgICAgICAgICAgRSB8fA0KZCgpOyBFID0gdHJ1ZTsgaWYgKHgpIHgub25yZWFkeXN0YXRlY2hhbmdlID0gYy5ub29wDQogICAgICAgICAgICB9IGVsc2UgaWYgKCFFICYmIHggJiYgKHgucmVhZHlTdGF0ZSA9PT0gNCB8fCBxID09PSAidGltZW91dCIpKSB7IEUgPSB0cnVlOyB4Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGMubm9vcDsgaSA9IHEgPT09ICJ0aW1lb3V0IiA/ICJ0aW1lb3V0IiA6ICFjLmh0dHBTdWNjZXNzKHgpID8gImVycm9yIiA6IGUuaWZNb2RpZmllZCAmJiBjLmh0dHBOb3RNb2RpZmllZCh4LCBlLnVybCkgPyAibm90bW9kaWZpZWQiIDogInN1Y2Nlc3MiOyB2YXIgcDsgaWYgKGkgPT09ICJzdWNjZXNzIikgdHJ5IHsgbyA9IGMuaHR0cERhdGEoeCwgZS5kYXRhVHlwZSwgZSkgfSBjYXRjaCAodikgeyBpID0gInBhcnNlcmVycm9yIjsgcCA9IHYgfSBpZiAoaSA9PT0gInN1Y2Nlc3MiIHx8IGkgPT09ICJub3Rtb2RpZmllZCIpIGogfHwgYigpOyBlbHNlIGMuaGFuZGxlRXJyb3IoZSwgeCwgaSwgcCk7IGQoKTsgcSA9PT0gInRpbWVvdXQiICYmIHguYWJvcnQoKTsgaWYgKGUuYXN5bmMpIHggPSBudWxsIH0gDQogICAgICAgIH07IHRyeSB7DQogICAgICAgICAgICB2YXIgaCA9IHguYWJvcnQ7IHguYWJvcnQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgeCAmJiBoLmNhbGwoeCk7DQogICAgICAgICAgICAgICAgZygiYWJvcnQiKQ0KICAgICAgICAgICAgfSANCiAgICAgICAgfSBjYXRjaCAobCkgeyB9IGUuYXN5bmMgJiYgZS50aW1lb3V0ID4gMCAmJiBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgeCAmJiAhRSAmJiBnKCJ0aW1lb3V0IikgfSwgZS50aW1lb3V0KTsgdHJ5IHsgeC5zZW5kKG4gPT09ICJQT1NUIiB8fCBuID09PSAiUFVUIiB8fCBuID09PSAiREVMRVRFIiA/IGUuZGF0YSA6IG51bGwpIH0gY2F0Y2ggKG0pIHsgYy5oYW5kbGVFcnJvcihlLCB4LCBudWxsLCBtKTsgZCgpIH0gZS5hc3luYyB8fCBnKCk7IHJldHVybiB4DQogICAgfSANCn0sIGhhbmRsZUVycm9yOiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgeyBpZiAoYS5lcnJvcikgYS5lcnJvci5jYWxsKGEuY29udGV4dCB8fCBhLCBiLCBkLCBmKTsgaWYgKGEuZ2xvYmFsKSAoYS5jb250ZXh0ID8gYyhhLmNvbnRleHQpIDogYy5ldmVudCkudHJpZ2dlcigiYWpheEVycm9yIiwgW2IsIGEsIGZdKSB9LCBhY3RpdmU6IDAsIGh0dHBTdWNjZXNzOiBmdW5jdGlvbiAoYSkgew0KICAgIHRyeSB7DQogICAgICAgIHJldHVybiAhYS5zdGF0dXMgJiYgbG9jYXRpb24ucHJvdG9jb2wgPT09ICJmaWxlOiIgfHwgYS5zdGF0dXMgPj0gMjAwICYmIGEuc3RhdHVzIDwgMzAwIHx8IGEuc3RhdHVzID09PSAzMDQgfHwgYS5zdGF0dXMgPT09DQoxMjIzIHx8IGEuc3RhdHVzID09PSAwDQogICAgfSBjYXRjaCAoYikgeyB9IHJldHVybiBmYWxzZQ0KfSwgaHR0cE5vdE1vZGlmaWVkOiBmdW5jdGlvbiAoYSwgYikgeyB2YXIgZCA9IGEuZ2V0UmVzcG9uc2VIZWFkZXIoIkxhc3QtTW9kaWZpZWQiKSwgZiA9IGEuZ2V0UmVzcG9uc2VIZWFkZXIoIkV0YWciKTsgaWYgKGQpIGMubGFzdE1vZGlmaWVkW2JdID0gZDsgaWYgKGYpIGMuZXRhZ1tiXSA9IGY7IHJldHVybiBhLnN0YXR1cyA9PT0gMzA0IHx8IGEuc3RhdHVzID09PSAwIH0sIGh0dHBEYXRhOiBmdW5jdGlvbiAoYSwgYiwgZCkgew0KICAgIHZhciBmID0gYS5nZXRSZXNwb25zZUhlYWRlcigiY29udGVudC10eXBlIikgfHwgIiIsIGUgPSBiID09PSAieG1sIiB8fCAhYiAmJiBmLmluZGV4T2YoInhtbCIpID49IDA7IGEgPSBlID8gYS5yZXNwb25zZVhNTCA6IGEucmVzcG9uc2VUZXh0OyBlICYmIGEuZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lID09PSAicGFyc2VyZXJyb3IiICYmIGMuZXJyb3IoInBhcnNlcmVycm9yIik7IGlmIChkICYmIGQuZGF0YUZpbHRlcikgYSA9IGQuZGF0YUZpbHRlcihhLCBiKTsgaWYgKHR5cGVvZiBhID09PSAic3RyaW5nIikgaWYgKGIgPT09DQoianNvbiIgfHwgIWIgJiYgZi5pbmRleE9mKCJqc29uIikgPj0gMCkgYSA9IGMucGFyc2VKU09OKGEpOyBlbHNlIGlmIChiID09PSAic2NyaXB0IiB8fCAhYiAmJiBmLmluZGV4T2YoImphdmFzY3JpcHQiKSA+PSAwKSBjLmdsb2JhbEV2YWwoYSk7IHJldHVybiBhDQp9LCBwYXJhbTogZnVuY3Rpb24gKGEsIGIpIHsNCiAgICBmdW5jdGlvbiBkKGksIG8pIHsgaWYgKGMuaXNBcnJheShvKSkgYy5lYWNoKG8sIGZ1bmN0aW9uIChrLCBuKSB7IGIgfHwgL1xbXF0kLy50ZXN0KGkpID8gZihpLCBuKSA6IGQoaSArICJbIiArICh0eXBlb2YgbiA9PT0gIm9iamVjdCIgfHwgYy5pc0FycmF5KG4pID8gayA6ICIiKSArICJdIiwgbikgfSk7IGVsc2UgIWIgJiYgbyAhPSBudWxsICYmIHR5cGVvZiBvID09PSAib2JqZWN0IiA/IGMuZWFjaChvLCBmdW5jdGlvbiAoaywgbikgeyBkKGkgKyAiWyIgKyBrICsgIl0iLCBuKSB9KSA6IGYoaSwgbykgfSBmdW5jdGlvbiBmKGksIG8pIHsgbyA9IGMuaXNGdW5jdGlvbihvKSA/IG8oKSA6IG87IGVbZS5sZW5ndGhdID0gZW5jb2RlVVJJQ29tcG9uZW50KGkpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KG8pIH0gdmFyIGUgPSBbXTsgaWYgKGIgPT09IHcpIGIgPSBjLmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsNCiAgICBpZiAoYy5pc0FycmF5KGEpIHx8IGEuanF1ZXJ5KSBjLmVhY2goYSwgZnVuY3Rpb24gKCkgeyBmKHRoaXMubmFtZSwgdGhpcy52YWx1ZSkgfSk7IGVsc2UgZm9yICh2YXIgaiBpbiBhKSBkKGosIGFbal0pOyByZXR1cm4gZS5qb2luKCImIikucmVwbGFjZSh5YiwgIisiKQ0KfSANCn0pOyB2YXIgbGEgPSB7fSwgQWIgPSAvdG9nZ2xlfHNob3d8aGlkZS8sIEJiID0gL14oWystXT0pPyhbXGQrLS5dKykoLiopJC8sIFcsIHZhID0gW1siaGVpZ2h0IiwgIm1hcmdpblRvcCIsICJtYXJnaW5Cb3R0b20iLCAicGFkZGluZ1RvcCIsICJwYWRkaW5nQm90dG9tIl0sIFsid2lkdGgiLCAibWFyZ2luTGVmdCIsICJtYXJnaW5SaWdodCIsICJwYWRkaW5nTGVmdCIsICJwYWRkaW5nUmlnaHQiXSwgWyJvcGFjaXR5Il1dOyBjLmZuLmV4dGVuZCh7IHNob3c6IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgaWYgKGEgfHwgYSA9PT0gMCkgcmV0dXJuIHRoaXMuYW5pbWF0ZShLKCJzaG93IiwgMyksIGEsIGIpOyBlbHNlIHsNCiAgICAgICAgYSA9IDA7IGZvciAoYiA9IHRoaXMubGVuZ3RoOyBhIDwgYjsgYSsrKSB7DQogICAgICAgICAgICB2YXIgZCA9IGMuZGF0YSh0aGlzW2FdLCAib2xkZGlzcGxheSIpOw0KICAgICAgICAgICAgdGhpc1thXS5zdHlsZS5kaXNwbGF5ID0gZCB8fCAiIjsgaWYgKGMuY3NzKHRoaXNbYV0sICJkaXNwbGF5IikgPT09ICJub25lIikgeyBkID0gdGhpc1thXS5ub2RlTmFtZTsgdmFyIGY7IGlmIChsYVtkXSkgZiA9IGxhW2RdOyBlbHNlIHsgdmFyIGUgPSBjKCI8IiArIGQgKyAiIC8+IikuYXBwZW5kVG8oImJvZHkiKTsgZiA9IGUuY3NzKCJkaXNwbGF5Iik7IGlmIChmID09PSAibm9uZSIpIGYgPSAiYmxvY2siOyBlLnJlbW92ZSgpOyBsYVtkXSA9IGYgfSBjLmRhdGEodGhpc1thXSwgIm9sZGRpc3BsYXkiLCBmKSB9IA0KICAgICAgICB9IGEgPSAwOyBmb3IgKGIgPSB0aGlzLmxlbmd0aDsgYSA8IGI7IGErKykgdGhpc1thXS5zdHlsZS5kaXNwbGF5ID0gYy5kYXRhKHRoaXNbYV0sICJvbGRkaXNwbGF5IikgfHwgIiI7IHJldHVybiB0aGlzDQogICAgfSANCn0sIGhpZGU6IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgaWYgKGEgfHwgYSA9PT0gMCkgcmV0dXJuIHRoaXMuYW5pbWF0ZShLKCJoaWRlIiwgMyksIGEsIGIpOyBlbHNlIHsNCiAgICAgICAgYSA9IDA7IGZvciAoYiA9IHRoaXMubGVuZ3RoOyBhIDwgYjsgYSsrKSB7DQogICAgICAgICAgICB2YXIgZCA9IGMuZGF0YSh0aGlzW2FdLCAib2xkZGlzcGxheSIpOyAhZCAmJiBkICE9PSAibm9uZSIgJiYgYy5kYXRhKHRoaXNbYV0sDQoib2xkZGlzcGxheSIsIGMuY3NzKHRoaXNbYV0sICJkaXNwbGF5IikpDQogICAgICAgIH0gYSA9IDA7IGZvciAoYiA9IHRoaXMubGVuZ3RoOyBhIDwgYjsgYSsrKSB0aGlzW2FdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7IHJldHVybiB0aGlzDQogICAgfSANCn0sIF90b2dnbGU6IGMuZm4udG9nZ2xlLCB0b2dnbGU6IGZ1bmN0aW9uIChhLCBiKSB7IHZhciBkID0gdHlwZW9mIGEgPT09ICJib29sZWFuIjsgaWYgKGMuaXNGdW5jdGlvbihhKSAmJiBjLmlzRnVuY3Rpb24oYikpIHRoaXMuX3RvZ2dsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyBlbHNlIGEgPT0gbnVsbCB8fCBkID8gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsgdmFyIGYgPSBkID8gYSA6IGModGhpcykuaXMoIjpoaWRkZW4iKTsgYyh0aGlzKVtmID8gInNob3ciIDogImhpZGUiXSgpIH0pIDogdGhpcy5hbmltYXRlKEsoInRvZ2dsZSIsIDMpLCBhLCBiKTsgcmV0dXJuIHRoaXMgfSwgZmFkZVRvOiBmdW5jdGlvbiAoYSwgYiwgZCkgeyByZXR1cm4gdGhpcy5maWx0ZXIoIjpoaWRkZW4iKS5jc3MoIm9wYWNpdHkiLCAwKS5zaG93KCkuZW5kKCkuYW5pbWF0ZSh7IG9wYWNpdHk6IGIgfSwgYSwgZCkgfSwNCiAgICBhbmltYXRlOiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgew0KICAgICAgICB2YXIgZSA9IGMuc3BlZWQoYiwgZCwgZik7IGlmIChjLmlzRW1wdHlPYmplY3QoYSkpIHJldHVybiB0aGlzLmVhY2goZS5jb21wbGV0ZSk7IHJldHVybiB0aGlzW2UucXVldWUgPT09IGZhbHNlID8gImVhY2giIDogInF1ZXVlIl0oZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGogPSBjLmV4dGVuZCh7fSwgZSksIGksIG8gPSB0aGlzLm5vZGVUeXBlID09PSAxICYmIGModGhpcykuaXMoIjpoaWRkZW4iKSwgayA9IHRoaXM7IGZvciAoaSBpbiBhKSB7DQogICAgICAgICAgICAgICAgdmFyIG4gPSBpLnJlcGxhY2UoaWEsIGphKTsgaWYgKGkgIT09IG4pIHsgYVtuXSA9IGFbaV07IGRlbGV0ZSBhW2ldOyBpID0gbiB9IGlmIChhW2ldID09PSAiaGlkZSIgJiYgbyB8fCBhW2ldID09PSAic2hvdyIgJiYgIW8pIHJldHVybiBqLmNvbXBsZXRlLmNhbGwodGhpcyk7IGlmICgoaSA9PT0gImhlaWdodCIgfHwgaSA9PT0gIndpZHRoIikgJiYgdGhpcy5zdHlsZSkgeyBqLmRpc3BsYXkgPSBjLmNzcyh0aGlzLCAiZGlzcGxheSIpOyBqLm92ZXJmbG93ID0gdGhpcy5zdHlsZS5vdmVyZmxvdyB9IGlmIChjLmlzQXJyYXkoYVtpXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgKGouc3BlY2lhbEVhc2luZyA9DQpqLnNwZWNpYWxFYXNpbmcgfHwge30pW2ldID0gYVtpXVsxXTsgYVtpXSA9IGFbaV1bMF0NCiAgICAgICAgICAgICAgICB9IA0KICAgICAgICAgICAgfSBpZiAoai5vdmVyZmxvdyAhPSBudWxsKSB0aGlzLnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7IGouY3VyQW5pbSA9IGMuZXh0ZW5kKHt9LCBhKTsgYy5lYWNoKGEsIGZ1bmN0aW9uIChyLCB1KSB7IHZhciB6ID0gbmV3IGMuZngoaywgaiwgcik7IGlmIChBYi50ZXN0KHUpKSB6W3UgPT09ICJ0b2dnbGUiID8gbyA/ICJzaG93IiA6ICJoaWRlIiA6IHVdKGEpOyBlbHNlIHsgdmFyIEMgPSBCYi5leGVjKHUpLCBCID0gei5jdXIodHJ1ZSkgfHwgMDsgaWYgKEMpIHsgdSA9IHBhcnNlRmxvYXQoQ1syXSk7IHZhciBFID0gQ1szXSB8fCAicHgiOyBpZiAoRSAhPT0gInB4IikgeyBrLnN0eWxlW3JdID0gKHUgfHwgMSkgKyBFOyBCID0gKHUgfHwgMSkgLyB6LmN1cih0cnVlKSAqIEI7IGsuc3R5bGVbcl0gPSBCICsgRSB9IGlmIChDWzFdKSB1ID0gKENbMV0gPT09ICItPSIgPyAtMSA6IDEpICogdSArIEI7IHouY3VzdG9tKEIsIHUsIEUpIH0gZWxzZSB6LmN1c3RvbShCLCB1LCAiIikgfSB9KTsgcmV0dXJuIHRydWUNCiAgICAgICAgfSkNCiAgICB9LCBzdG9wOiBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICB2YXIgZCA9IGMudGltZXJzOyBhICYmIHRoaXMucXVldWUoW10pOw0KICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBmID0gZC5sZW5ndGggLSAxOyBmID49IDA7IGYtLSkgaWYgKGRbZl0uZWxlbSA9PT0gdGhpcykgeyBiICYmIGRbZl0odHJ1ZSk7IGQuc3BsaWNlKGYsIDEpIH0gfSk7IGIgfHwgdGhpcy5kZXF1ZXVlKCk7IHJldHVybiB0aGlzDQogICAgfSANCn0pOyBjLmVhY2goeyBzbGlkZURvd246IEsoInNob3ciLCAxKSwgc2xpZGVVcDogSygiaGlkZSIsIDEpLCBzbGlkZVRvZ2dsZTogSygidG9nZ2xlIiwgMSksIGZhZGVJbjogeyBvcGFjaXR5OiAic2hvdyIgfSwgZmFkZU91dDogeyBvcGFjaXR5OiAiaGlkZSJ9IH0sIGZ1bmN0aW9uIChhLCBiKSB7IGMuZm5bYV0gPSBmdW5jdGlvbiAoZCwgZikgeyByZXR1cm4gdGhpcy5hbmltYXRlKGIsIGQsIGYpIH0gfSk7IGMuZXh0ZW5kKHsgc3BlZWQ6IGZ1bmN0aW9uIChhLCBiLCBkKSB7DQogICAgdmFyIGYgPSBhICYmIHR5cGVvZiBhID09PSAib2JqZWN0IiA/IGEgOiB7IGNvbXBsZXRlOiBkIHx8ICFkICYmIGIgfHwgYy5pc0Z1bmN0aW9uKGEpICYmIGEsIGR1cmF0aW9uOiBhLCBlYXNpbmc6IGQgJiYgYiB8fCBiICYmICFjLmlzRnVuY3Rpb24oYikgJiYgYiB9OyBmLmR1cmF0aW9uID0gYy5meC5vZmYgPyAwIDogdHlwZW9mIGYuZHVyYXRpb24gPT09DQoibnVtYmVyIiA/IGYuZHVyYXRpb24gOiBjLmZ4LnNwZWVkc1tmLmR1cmF0aW9uXSB8fCBjLmZ4LnNwZWVkcy5fZGVmYXVsdDsgZi5vbGQgPSBmLmNvbXBsZXRlOyBmLmNvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyBmLnF1ZXVlICE9PSBmYWxzZSAmJiBjKHRoaXMpLmRlcXVldWUoKTsgYy5pc0Z1bmN0aW9uKGYub2xkKSAmJiBmLm9sZC5jYWxsKHRoaXMpIH07IHJldHVybiBmDQp9LCBlYXNpbmc6IHsgbGluZWFyOiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgeyByZXR1cm4gZCArIGYgKiBhIH0sIHN3aW5nOiBmdW5jdGlvbiAoYSwgYiwgZCwgZikgeyByZXR1cm4gKC1NYXRoLmNvcyhhICogTWF0aC5QSSkgLyAyICsgMC41KSAqIGYgKyBkIH0gfSwgdGltZXJzOiBbXSwgZng6IGZ1bmN0aW9uIChhLCBiLCBkKSB7IHRoaXMub3B0aW9ucyA9IGI7IHRoaXMuZWxlbSA9IGE7IHRoaXMucHJvcCA9IGQ7IGlmICghYi5vcmlnKSBiLm9yaWcgPSB7fSB9IA0KfSk7IGMuZngucHJvdG90eXBlID0geyB1cGRhdGU6IGZ1bmN0aW9uICgpIHsNCiAgICB0aGlzLm9wdGlvbnMuc3RlcCAmJiB0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMpOyAoYy5meC5zdGVwW3RoaXMucHJvcF0gfHwNCmMuZnguc3RlcC5fZGVmYXVsdCkodGhpcyk7IGlmICgodGhpcy5wcm9wID09PSAiaGVpZ2h0IiB8fCB0aGlzLnByb3AgPT09ICJ3aWR0aCIpICYmIHRoaXMuZWxlbS5zdHlsZSkgdGhpcy5lbGVtLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siDQp9LCBjdXI6IGZ1bmN0aW9uIChhKSB7IGlmICh0aGlzLmVsZW1bdGhpcy5wcm9wXSAhPSBudWxsICYmICghdGhpcy5lbGVtLnN0eWxlIHx8IHRoaXMuZWxlbS5zdHlsZVt0aGlzLnByb3BdID09IG51bGwpKSByZXR1cm4gdGhpcy5lbGVtW3RoaXMucHJvcF07IHJldHVybiAoYSA9IHBhcnNlRmxvYXQoYy5jc3ModGhpcy5lbGVtLCB0aGlzLnByb3AsIGEpKSkgJiYgYSA+IC0xMDAwMCA/IGEgOiBwYXJzZUZsb2F0KGMuY3VyQ1NTKHRoaXMuZWxlbSwgdGhpcy5wcm9wKSkgfHwgMCB9LCBjdXN0b206IGZ1bmN0aW9uIChhLCBiLCBkKSB7DQogICAgZnVuY3Rpb24gZihqKSB7IHJldHVybiBlLnN0ZXAoaikgfSB0aGlzLnN0YXJ0VGltZSA9IEooKTsgdGhpcy5zdGFydCA9IGE7IHRoaXMuZW5kID0gYjsgdGhpcy51bml0ID0gZCB8fCB0aGlzLnVuaXQgfHwgInB4IjsgdGhpcy5ub3cgPSB0aGlzLnN0YXJ0Ow0KICAgIHRoaXMucG9zID0gdGhpcy5zdGF0ZSA9IDA7IHZhciBlID0gdGhpczsgZi5lbGVtID0gdGhpcy5lbGVtOyBpZiAoZigpICYmIGMudGltZXJzLnB1c2goZikgJiYgIVcpIFcgPSBzZXRJbnRlcnZhbChjLmZ4LnRpY2ssIDEzKQ0KfSwgc2hvdzogZnVuY3Rpb24gKCkgeyB0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdID0gYy5zdHlsZSh0aGlzLmVsZW0sIHRoaXMucHJvcCk7IHRoaXMub3B0aW9ucy5zaG93ID0gdHJ1ZTsgdGhpcy5jdXN0b20odGhpcy5wcm9wID09PSAid2lkdGgiIHx8IHRoaXMucHJvcCA9PT0gImhlaWdodCIgPyAxIDogMCwgdGhpcy5jdXIoKSk7IGModGhpcy5lbGVtKS5zaG93KCkgfSwgaGlkZTogZnVuY3Rpb24gKCkgeyB0aGlzLm9wdGlvbnMub3JpZ1t0aGlzLnByb3BdID0gYy5zdHlsZSh0aGlzLmVsZW0sIHRoaXMucHJvcCk7IHRoaXMub3B0aW9ucy5oaWRlID0gdHJ1ZTsgdGhpcy5jdXN0b20odGhpcy5jdXIoKSwgMCkgfSwgc3RlcDogZnVuY3Rpb24gKGEpIHsNCiAgICB2YXIgYiA9IEooKSwgZCA9IHRydWU7IGlmIChhIHx8IGIgPj0gdGhpcy5vcHRpb25zLmR1cmF0aW9uICsgdGhpcy5zdGFydFRpbWUpIHsNCiAgICAgICAgdGhpcy5ub3cgPQ0KdGhpcy5lbmQ7IHRoaXMucG9zID0gdGhpcy5zdGF0ZSA9IDE7IHRoaXMudXBkYXRlKCk7IHRoaXMub3B0aW9ucy5jdXJBbmltW3RoaXMucHJvcF0gPSB0cnVlOyBmb3IgKHZhciBmIGluIHRoaXMub3B0aW9ucy5jdXJBbmltKSBpZiAodGhpcy5vcHRpb25zLmN1ckFuaW1bZl0gIT09IHRydWUpIGQgPSBmYWxzZTsgaWYgKGQpIHsNCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzcGxheSAhPSBudWxsKSB7IHRoaXMuZWxlbS5zdHlsZS5vdmVyZmxvdyA9IHRoaXMub3B0aW9ucy5vdmVyZmxvdzsgYSA9IGMuZGF0YSh0aGlzLmVsZW0sICJvbGRkaXNwbGF5Iik7IHRoaXMuZWxlbS5zdHlsZS5kaXNwbGF5ID0gYSA/IGEgOiB0aGlzLm9wdGlvbnMuZGlzcGxheTsgaWYgKGMuY3NzKHRoaXMuZWxlbSwgImRpc3BsYXkiKSA9PT0gIm5vbmUiKSB0aGlzLmVsZW0uc3R5bGUuZGlzcGxheSA9ICJibG9jayIgfSB0aGlzLm9wdGlvbnMuaGlkZSAmJiBjKHRoaXMuZWxlbSkuaGlkZSgpOyBpZiAodGhpcy5vcHRpb25zLmhpZGUgfHwgdGhpcy5vcHRpb25zLnNob3cpIGZvciAodmFyIGUgaW4gdGhpcy5vcHRpb25zLmN1ckFuaW0pIGMuc3R5bGUodGhpcy5lbGVtLA0KZSwgdGhpcy5vcHRpb25zLm9yaWdbZV0pOyB0aGlzLm9wdGlvbnMuY29tcGxldGUuY2FsbCh0aGlzLmVsZW0pDQogICAgICAgIH0gcmV0dXJuIGZhbHNlDQogICAgfSBlbHNlIHsgZSA9IGIgLSB0aGlzLnN0YXJ0VGltZTsgdGhpcy5zdGF0ZSA9IGUgLyB0aGlzLm9wdGlvbnMuZHVyYXRpb247IGEgPSB0aGlzLm9wdGlvbnMuZWFzaW5nIHx8IChjLmVhc2luZy5zd2luZyA/ICJzd2luZyIgOiAibGluZWFyIik7IHRoaXMucG9zID0gYy5lYXNpbmdbdGhpcy5vcHRpb25zLnNwZWNpYWxFYXNpbmcgJiYgdGhpcy5vcHRpb25zLnNwZWNpYWxFYXNpbmdbdGhpcy5wcm9wXSB8fCBhXSh0aGlzLnN0YXRlLCBlLCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24pOyB0aGlzLm5vdyA9IHRoaXMuc3RhcnQgKyAodGhpcy5lbmQgLSB0aGlzLnN0YXJ0KSAqIHRoaXMucG9zOyB0aGlzLnVwZGF0ZSgpIH0gcmV0dXJuIHRydWUNCn0gDQp9OyBjLmV4dGVuZChjLmZ4LCB7IHRpY2s6IGZ1bmN0aW9uICgpIHsNCiAgICBmb3IgKHZhciBhID0gYy50aW1lcnMsIGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKykgYVtiXSgpIHx8IGEuc3BsaWNlKGItLSwgMSk7IGEubGVuZ3RoIHx8DQpjLmZ4LnN0b3AoKQ0KfSwgc3RvcDogZnVuY3Rpb24gKCkgeyBjbGVhckludGVydmFsKFcpOyBXID0gbnVsbCB9LCBzcGVlZHM6IHsgc2xvdzogNjAwLCBmYXN0OiAyMDAsIF9kZWZhdWx0OiA0MDAgfSwgc3RlcDogeyBvcGFjaXR5OiBmdW5jdGlvbiAoYSkgeyBjLnN0eWxlKGEuZWxlbSwgIm9wYWNpdHkiLCBhLm5vdykgfSwgX2RlZmF1bHQ6IGZ1bmN0aW9uIChhKSB7IGlmIChhLmVsZW0uc3R5bGUgJiYgYS5lbGVtLnN0eWxlW2EucHJvcF0gIT0gbnVsbCkgYS5lbGVtLnN0eWxlW2EucHJvcF0gPSAoYS5wcm9wID09PSAid2lkdGgiIHx8IGEucHJvcCA9PT0gImhlaWdodCIgPyBNYXRoLm1heCgwLCBhLm5vdykgOiBhLm5vdykgKyBhLnVuaXQ7IGVsc2UgYS5lbGVtW2EucHJvcF0gPSBhLm5vdyB9IH0NCn0pOyBpZiAoYy5leHByICYmIGMuZXhwci5maWx0ZXJzKSBjLmV4cHIuZmlsdGVycy5hbmltYXRlZCA9IGZ1bmN0aW9uIChhKSB7IHJldHVybiBjLmdyZXAoYy50aW1lcnMsIGZ1bmN0aW9uIChiKSB7IHJldHVybiBhID09PSBiLmVsZW0gfSkubGVuZ3RoIH07IGMuZm4ub2Zmc2V0ID0gImdldEJvdW5kaW5nQ2xpZW50UmVjdCIgaW4gcy5kb2N1bWVudEVsZW1lbnQgPw0KZnVuY3Rpb24gKGEpIHsgdmFyIGIgPSB0aGlzWzBdOyBpZiAoYSkgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoZSkgeyBjLm9mZnNldC5zZXRPZmZzZXQodGhpcywgYSwgZSkgfSk7IGlmICghYiB8fCAhYi5vd25lckRvY3VtZW50KSByZXR1cm4gbnVsbDsgaWYgKGIgPT09IGIub3duZXJEb2N1bWVudC5ib2R5KSByZXR1cm4gYy5vZmZzZXQuYm9keU9mZnNldChiKTsgdmFyIGQgPSBiLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBmID0gYi5vd25lckRvY3VtZW50OyBiID0gZi5ib2R5OyBmID0gZi5kb2N1bWVudEVsZW1lbnQ7IHJldHVybiB7IHRvcDogZC50b3AgKyAoc2VsZi5wYWdlWU9mZnNldCB8fCBjLnN1cHBvcnQuYm94TW9kZWwgJiYgZi5zY3JvbGxUb3AgfHwgYi5zY3JvbGxUb3ApIC0gKGYuY2xpZW50VG9wIHx8IGIuY2xpZW50VG9wIHx8IDApLCBsZWZ0OiBkLmxlZnQgKyAoc2VsZi5wYWdlWE9mZnNldCB8fCBjLnN1cHBvcnQuYm94TW9kZWwgJiYgZi5zY3JvbGxMZWZ0IHx8IGIuc2Nyb2xsTGVmdCkgLSAoZi5jbGllbnRMZWZ0IHx8IGIuY2xpZW50TGVmdCB8fCAwKX0gfSA6IGZ1bmN0aW9uIChhKSB7DQogICAgdmFyIGIgPQ0KdGhpc1swXTsgaWYgKGEpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKHIpIHsgYy5vZmZzZXQuc2V0T2Zmc2V0KHRoaXMsIGEsIHIpIH0pOyBpZiAoIWIgfHwgIWIub3duZXJEb2N1bWVudCkgcmV0dXJuIG51bGw7IGlmIChiID09PSBiLm93bmVyRG9jdW1lbnQuYm9keSkgcmV0dXJuIGMub2Zmc2V0LmJvZHlPZmZzZXQoYik7IGMub2Zmc2V0LmluaXRpYWxpemUoKTsgdmFyIGQgPSBiLm9mZnNldFBhcmVudCwgZiA9IGIsIGUgPSBiLm93bmVyRG9jdW1lbnQsIGosIGkgPSBlLmRvY3VtZW50RWxlbWVudCwgbyA9IGUuYm9keTsgZiA9IChlID0gZS5kZWZhdWx0VmlldykgPyBlLmdldENvbXB1dGVkU3R5bGUoYiwgbnVsbCkgOiBiLmN1cnJlbnRTdHlsZTsgZm9yICh2YXIgayA9IGIub2Zmc2V0VG9wLCBuID0gYi5vZmZzZXRMZWZ0OyAoYiA9IGIucGFyZW50Tm9kZSkgJiYgYiAhPT0gbyAmJiBiICE9PSBpOyApIHsNCiAgICAgICAgaWYgKGMub2Zmc2V0LnN1cHBvcnRzRml4ZWRQb3NpdGlvbiAmJiBmLnBvc2l0aW9uID09PSAiZml4ZWQiKSBicmVhazsgaiA9IGUgPyBlLmdldENvbXB1dGVkU3R5bGUoYiwgbnVsbCkgOiBiLmN1cnJlbnRTdHlsZTsNCiAgICAgICAgayAtPSBiLnNjcm9sbFRvcDsgbiAtPSBiLnNjcm9sbExlZnQ7IGlmIChiID09PSBkKSB7IGsgKz0gYi5vZmZzZXRUb3A7IG4gKz0gYi5vZmZzZXRMZWZ0OyBpZiAoYy5vZmZzZXQuZG9lc05vdEFkZEJvcmRlciAmJiAhKGMub2Zmc2V0LmRvZXNBZGRCb3JkZXJGb3JUYWJsZUFuZENlbGxzICYmIC9edChhYmxlfGR8aCkkL2kudGVzdChiLm5vZGVOYW1lKSkpIHsgayArPSBwYXJzZUZsb2F0KGouYm9yZGVyVG9wV2lkdGgpIHx8IDA7IG4gKz0gcGFyc2VGbG9hdChqLmJvcmRlckxlZnRXaWR0aCkgfHwgMCB9IGYgPSBkOyBkID0gYi5vZmZzZXRQYXJlbnQgfSBpZiAoYy5vZmZzZXQuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlICYmIGoub3ZlcmZsb3cgIT09ICJ2aXNpYmxlIikgeyBrICs9IHBhcnNlRmxvYXQoai5ib3JkZXJUb3BXaWR0aCkgfHwgMDsgbiArPSBwYXJzZUZsb2F0KGouYm9yZGVyTGVmdFdpZHRoKSB8fCAwIH0gZiA9IGoNCiAgICB9IGlmIChmLnBvc2l0aW9uID09PSAicmVsYXRpdmUiIHx8IGYucG9zaXRpb24gPT09ICJzdGF0aWMiKSB7IGsgKz0gby5vZmZzZXRUb3A7IG4gKz0gby5vZmZzZXRMZWZ0IH0gaWYgKGMub2Zmc2V0LnN1cHBvcnRzRml4ZWRQb3NpdGlvbiAmJg0KZi5wb3NpdGlvbiA9PT0gImZpeGVkIikgeyBrICs9IE1hdGgubWF4KGkuc2Nyb2xsVG9wLCBvLnNjcm9sbFRvcCk7IG4gKz0gTWF0aC5tYXgoaS5zY3JvbGxMZWZ0LCBvLnNjcm9sbExlZnQpIH0gcmV0dXJuIHsgdG9wOiBrLCBsZWZ0OiBufQ0KfTsgYy5vZmZzZXQgPSB7IGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgYSA9IHMuYm9keSwgYiA9IHMuY3JlYXRlRWxlbWVudCgiZGl2IiksIGQsIGYsIGUsIGogPSBwYXJzZUZsb2F0KGMuY3VyQ1NTKGEsICJtYXJnaW5Ub3AiLCB0cnVlKSkgfHwgMDsgYy5leHRlbmQoYi5zdHlsZSwgeyBwb3NpdGlvbjogImFic29sdXRlIiwgdG9wOiAwLCBsZWZ0OiAwLCBtYXJnaW46IDAsIGJvcmRlcjogMCwgd2lkdGg6ICIxcHgiLCBoZWlnaHQ6ICIxcHgiLCB2aXNpYmlsaXR5OiAiaGlkZGVuIiB9KTsgYi5pbm5lckhUTUwgPSAiPGRpdiBzdHlsZT0ncG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO21hcmdpbjowO2JvcmRlcjo1cHggc29saWQgIzAwMDtwYWRkaW5nOjA7d2lkdGg6MXB4O2hlaWdodDoxcHg7Jz48ZGl2PjwvZGl2PjwvZGl2Pjx0YWJsZSBzdHlsZT0ncG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO21hcmdpbjowO2JvcmRlcjo1cHggc29saWQgIzAwMDtwYWRkaW5nOjA7d2lkdGg6MXB4O2hlaWdodDoxcHg7JyBjZWxscGFkZGluZz0nMCcgY2VsbHNwYWNpbmc9JzAnPjx0cj48dGQ+PC90ZD48L3RyPjwvdGFibGU+IjsNCiAgICBhLmluc2VydEJlZm9yZShiLCBhLmZpcnN0Q2hpbGQpOyBkID0gYi5maXJzdENoaWxkOyBmID0gZC5maXJzdENoaWxkOyBlID0gZC5uZXh0U2libGluZy5maXJzdENoaWxkLmZpcnN0Q2hpbGQ7IHRoaXMuZG9lc05vdEFkZEJvcmRlciA9IGYub2Zmc2V0VG9wICE9PSA1OyB0aGlzLmRvZXNBZGRCb3JkZXJGb3JUYWJsZUFuZENlbGxzID0gZS5vZmZzZXRUb3AgPT09IDU7IGYuc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOyBmLnN0eWxlLnRvcCA9ICIyMHB4IjsgdGhpcy5zdXBwb3J0c0ZpeGVkUG9zaXRpb24gPSBmLm9mZnNldFRvcCA9PT0gMjAgfHwgZi5vZmZzZXRUb3AgPT09IDE1OyBmLnN0eWxlLnBvc2l0aW9uID0gZi5zdHlsZS50b3AgPSAiIjsgZC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOyBkLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsgdGhpcy5zdWJ0cmFjdHNCb3JkZXJGb3JPdmVyZmxvd05vdFZpc2libGUgPSBmLm9mZnNldFRvcCA9PT0gLTU7IHRoaXMuZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQgPSBhLm9mZnNldFRvcCAhPT0gajsgYS5yZW1vdmVDaGlsZChiKTsNCiAgICBjLm9mZnNldC5pbml0aWFsaXplID0gYy5ub29wDQp9LCBib2R5T2Zmc2V0OiBmdW5jdGlvbiAoYSkgeyB2YXIgYiA9IGEub2Zmc2V0VG9wLCBkID0gYS5vZmZzZXRMZWZ0OyBjLm9mZnNldC5pbml0aWFsaXplKCk7IGlmIChjLm9mZnNldC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCkgeyBiICs9IHBhcnNlRmxvYXQoYy5jdXJDU1MoYSwgIm1hcmdpblRvcCIsIHRydWUpKSB8fCAwOyBkICs9IHBhcnNlRmxvYXQoYy5jdXJDU1MoYSwgIm1hcmdpbkxlZnQiLCB0cnVlKSkgfHwgMCB9IHJldHVybiB7IHRvcDogYiwgbGVmdDogZH0gfSwgc2V0T2Zmc2V0OiBmdW5jdGlvbiAoYSwgYiwgZCkgew0KICAgIGlmICgvc3RhdGljLy50ZXN0KGMuY3VyQ1NTKGEsICJwb3NpdGlvbiIpKSkgYS5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7IHZhciBmID0gYyhhKSwgZSA9IGYub2Zmc2V0KCksIGogPSBwYXJzZUludChjLmN1ckNTUyhhLCAidG9wIiwgdHJ1ZSksIDEwKSB8fCAwLCBpID0gcGFyc2VJbnQoYy5jdXJDU1MoYSwgImxlZnQiLCB0cnVlKSwgMTApIHx8IDA7IGlmIChjLmlzRnVuY3Rpb24oYikpIGIgPSBiLmNhbGwoYSwNCmQsIGUpOyBkID0geyB0b3A6IGIudG9wIC0gZS50b3AgKyBqLCBsZWZ0OiBiLmxlZnQgLSBlLmxlZnQgKyBpIH07ICJ1c2luZyIgaW4gYiA/IGIudXNpbmcuY2FsbChhLCBkKSA6IGYuY3NzKGQpDQp9IA0KfTsgYy5mbi5leHRlbmQoeyBwb3NpdGlvbjogZnVuY3Rpb24gKCkgew0KICAgIGlmICghdGhpc1swXSkgcmV0dXJuIG51bGw7IHZhciBhID0gdGhpc1swXSwgYiA9IHRoaXMub2Zmc2V0UGFyZW50KCksIGQgPSB0aGlzLm9mZnNldCgpLCBmID0gL15ib2R5fGh0bWwkL2kudGVzdChiWzBdLm5vZGVOYW1lKSA/IHsgdG9wOiAwLCBsZWZ0OiAwfSA6IGIub2Zmc2V0KCk7IGQudG9wIC09IHBhcnNlRmxvYXQoYy5jdXJDU1MoYSwgIm1hcmdpblRvcCIsIHRydWUpKSB8fCAwOyBkLmxlZnQgLT0gcGFyc2VGbG9hdChjLmN1ckNTUyhhLCAibWFyZ2luTGVmdCIsIHRydWUpKSB8fCAwOyBmLnRvcCArPSBwYXJzZUZsb2F0KGMuY3VyQ1NTKGJbMF0sICJib3JkZXJUb3BXaWR0aCIsIHRydWUpKSB8fCAwOyBmLmxlZnQgKz0gcGFyc2VGbG9hdChjLmN1ckNTUyhiWzBdLCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSkpIHx8IDA7IHJldHVybiB7IHRvcDogZC50b3AgLQ0KZi50b3AsIGxlZnQ6IGQubGVmdCAtIGYubGVmdA0KICAgIH0NCn0sIG9mZnNldFBhcmVudDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBhID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgcy5ib2R5OyBhICYmICEvXmJvZHl8aHRtbCQvaS50ZXN0KGEubm9kZU5hbWUpICYmIGMuY3NzKGEsICJwb3NpdGlvbiIpID09PSAic3RhdGljIjsgKSBhID0gYS5vZmZzZXRQYXJlbnQ7IHJldHVybiBhIH0pIH0gDQp9KTsgYy5lYWNoKFsiTGVmdCIsICJUb3AiXSwgZnVuY3Rpb24gKGEsIGIpIHsNCiAgICB2YXIgZCA9ICJzY3JvbGwiICsgYjsgYy5mbltkXSA9IGZ1bmN0aW9uIChmKSB7DQogICAgICAgIHZhciBlID0gdGhpc1swXSwgajsgaWYgKCFlKSByZXR1cm4gbnVsbDsgaWYgKGYgIT09IHcpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgeyBpZiAoaiA9IHdhKHRoaXMpKSBqLnNjcm9sbFRvKCFhID8gZiA6IGMoaikuc2Nyb2xsTGVmdCgpLCBhID8gZiA6IGMoaikuc2Nyb2xsVG9wKCkpOyBlbHNlIHRoaXNbZF0gPSBmIH0pOyBlbHNlIHJldHVybiAoaiA9IHdhKGUpKSA/ICJwYWdlWE9mZnNldCIgaW4gaiA/IGpbYSA/ICJwYWdlWU9mZnNldCIgOg0KInBhZ2VYT2Zmc2V0Il0gOiBjLnN1cHBvcnQuYm94TW9kZWwgJiYgai5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbZF0gfHwgai5kb2N1bWVudC5ib2R5W2RdIDogZVtkXQ0KICAgIH0gDQp9KTsgYy5lYWNoKFsiSGVpZ2h0IiwgIldpZHRoIl0sIGZ1bmN0aW9uIChhLCBiKSB7DQogICAgdmFyIGQgPSBiLnRvTG93ZXJDYXNlKCk7IGMuZm5bImlubmVyIiArIGJdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpc1swXSA/IGMuY3NzKHRoaXNbMF0sIGQsIGZhbHNlLCAicGFkZGluZyIpIDogbnVsbCB9OyBjLmZuWyJvdXRlciIgKyBiXSA9IGZ1bmN0aW9uIChmKSB7IHJldHVybiB0aGlzWzBdID8gYy5jc3ModGhpc1swXSwgZCwgZmFsc2UsIGYgPyAibWFyZ2luIiA6ICJib3JkZXIiKSA6IG51bGwgfTsgYy5mbltkXSA9IGZ1bmN0aW9uIChmKSB7DQogICAgICAgIHZhciBlID0gdGhpc1swXTsgaWYgKCFlKSByZXR1cm4gZiA9PSBudWxsID8gbnVsbCA6IHRoaXM7IGlmIChjLmlzRnVuY3Rpb24oZikpIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGopIHsgdmFyIGkgPSBjKHRoaXMpOyBpW2RdKGYuY2FsbCh0aGlzLCBqLCBpW2RdKCkpKSB9KTsgcmV0dXJuICJzY3JvbGxUbyIgaW4NCmUgJiYgZS5kb2N1bWVudCA/IGUuZG9jdW1lbnQuY29tcGF0TW9kZSA9PT0gIkNTUzFDb21wYXQiICYmIGUuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyJjbGllbnQiICsgYl0gfHwgZS5kb2N1bWVudC5ib2R5WyJjbGllbnQiICsgYl0gOiBlLm5vZGVUeXBlID09PSA5ID8gTWF0aC5tYXgoZS5kb2N1bWVudEVsZW1lbnRbImNsaWVudCIgKyBiXSwgZS5ib2R5WyJzY3JvbGwiICsgYl0sIGUuZG9jdW1lbnRFbGVtZW50WyJzY3JvbGwiICsgYl0sIGUuYm9keVsib2Zmc2V0IiArIGJdLCBlLmRvY3VtZW50RWxlbWVudFsib2Zmc2V0IiArIGJdKSA6IGYgPT09IHcgPyBjLmNzcyhlLCBkKSA6IHRoaXMuY3NzKGQsIHR5cGVvZiBmID09PSAic3RyaW5nIiA/IGYgOiBmICsgInB4IikNCiAgICB9IA0KfSk7IEEualF1ZXJ5ID0gQS4kID0gYw0KfSkod2luZG93KTs="

#endif
